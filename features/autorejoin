local Config = _G.UniversalUtility.Config
local LocalPlayer = _G.UniversalUtility.LocalPlayer
local CoreGui = _G.UniversalUtility.Services.CoreGui
local TeleportService = _G.UniversalUtility.Services.TeleportService
local TweenService = _G.UniversalUtility.Services.TweenService
local TweenPresets = _G.UniversalUtility.TweenPresets
local UI = _G.UniversalUtility.UI

local teleporting = false

function _G.UniversalUtility.SetupAutoRejoin()
    if Config.AutoRejoinEnabled then
        local PromptGui = CoreGui:WaitForChild("RobloxPromptGui")
        local PromptOverlay = PromptGui:WaitForChild("promptOverlay")
        PromptOverlay.ChildAdded:Connect(function(child)
            if child.Name == "ErrorPrompt" and Config.AutoRejoinEnabled and not teleporting then
                teleporting = true
                task.spawn(function()
                    while Config.AutoRejoinEnabled and teleporting do
                        TeleportService:Teleport(game.PlaceId, LocalPlayer)
                        task.wait(2)
                    end
                end)
            end
        end)
    end
end

function _G.UniversalUtility.ToggleAutoRejoin()
    if not _G.UniversalUtility.SetDebounce("Rejoin", 0.3) then return end
    Config.AutoRejoinEnabled = not Config.AutoRejoinEnabled
    TweenService:Create(UI.AutoRejoinToggle, TweenPresets.Medium, {
        BackgroundColor3 = Config.AutoRejoinEnabled and Color3.fromRGB(50, 220, 100) or Color3.fromRGB(220, 50, 50)
    }):Play()
    
    UI.AutoRejoinToggle.Text = "Auto Rejoin: " .. (Config.AutoRejoinEnabled and "ON" or "OFF")
    UI.AutoRejoinStatus.Text = "Status: " .. (Config.AutoRejoinEnabled and "Enabled" or "Disabled") .. "\n\nAutomatically rejoins the game when you get disconnected.\nUseful for preventing AFK kicks."
    UI.AutoRejoinStatus.TextColor3 = Config.AutoRejoinEnabled and Color3.fromRGB(50, 220, 100) or Color3.fromRGB(180, 180, 180)
    
    if Config.AutoRejoinEnabled then
        _G.UniversalUtility.SetupAutoRejoin()
    else
        teleporting = false
    end
    _G.UniversalUtility.SaveConfig()
end

print("âœ“ Features/AutoRejoin loaded")
