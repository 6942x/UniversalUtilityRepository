local Config = _G.UniversalUtility.Config
local LocalPlayer = _G.UniversalUtility.LocalPlayer
local ActiveThreads = _G.UniversalUtility.ActiveThreads
local UserInputService = _G.UniversalUtility.Services.UserInputService
local VirtualInputManager = _G.UniversalUtility.Services.VirtualInputManager
local UI = _G.UniversalUtility.UI

function _G.UniversalUtility.StopJumpThread()
    _G.UniversalUtility.StopThread("Jump")
end

function _G.UniversalUtility.StopClickThread()
    _G.UniversalUtility.StopThread("Click")
end

function _G.UniversalUtility.StartJumpThread()
    _G.UniversalUtility.StopJumpThread()
    ActiveThreads.Jump = task.spawn(function()
        while Config.JumpEnabled do
            task.wait(Config.JumpDelay)
            if Config.JumpEnabled and LocalPlayer.Character then
                local humanoid = LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
                if humanoid then
                    humanoid:ChangeState(Enum.HumanoidStateType.Jumping)
                end
            end
        end
        ActiveThreads.Jump = nil
    end)
end

function _G.UniversalUtility.StartClickThread()
    _G.UniversalUtility.StopClickThread()
    ActiveThreads.Click = task.spawn(function()
        while Config.ClickEnabled do
            task.wait(Config.ClickDelay)
            if Config.ClickEnabled then
                local x, y
                if Config.ClickType == "Current" then
                    local mousePos = UserInputService:GetMouseLocation()
                    x, y = mousePos.X, mousePos.Y
                elseif Config.ClickType == "Center" then
                    local viewport = workspace.CurrentCamera.ViewportSize
                    x, y = viewport.X/2, viewport.Y/2
                else
                    local viewport = workspace.CurrentCamera.ViewportSize
                    x, y = math.random(100, viewport.X - 100), math.random(100, viewport.Y - 100)
                end
                VirtualInputManager:SendMouseButtonEvent(x, y, 0, true, game, 0)
                task.wait(0.05)
                VirtualInputManager:SendMouseButtonEvent(x, y, 0, false, game, 0)
            end
        end
        ActiveThreads.Click = nil
    end)
end

function _G.UniversalUtility.UpdateAntiAFKStatus()
    if Config.JumpEnabled and Config.ClickEnabled then
        UI.AntiAFKStatus.Text = "Status: Jump & Click Active"
        UI.AntiAFKStatus.TextColor3 = Color3.fromRGB(50, 220, 100)
    elseif Config.JumpEnabled then
        UI.AntiAFKStatus.Text = "Status: Jump Active"
        UI.AntiAFKStatus.TextColor3 = Color3.fromRGB(100, 200, 255)
    elseif Config.ClickEnabled then
        UI.AntiAFKStatus.Text = "Status: Click Active"
        UI.AntiAFKStatus.TextColor3 = Color3.fromRGB(255, 200, 100)
    else
        UI.AntiAFKStatus.Text = "Status: All Inactive"
        UI.AntiAFKStatus.TextColor3 = Color3.fromRGB(180, 180, 180)
    end
end

function _G.UniversalUtility.UpdateClickTypeButtons()
    local TweenService = _G.UniversalUtility.Services.TweenService
    local TweenPresets = _G.UniversalUtility.TweenPresets
    
    local buttons = {
        Current = UI.ClickTypeCurrent,
        Center = UI.ClickTypeCenter,
        Random = UI.ClickTypeRandom
    }
    for type, btn in pairs(buttons) do
        TweenService:Create(btn, TweenPresets.Fast, {
            BackgroundColor3 = (Config.ClickType == type) and Color3.fromRGB(100, 150, 255) or Color3.fromRGB(45, 45, 52)
        }):Play()
    end
end

print("âœ“ Features/AntiAFK loaded")
