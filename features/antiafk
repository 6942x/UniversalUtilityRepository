local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local VirtualInputManager = game:GetService("VirtualInputManager")

local LocalPlayer = Players.LocalPlayer
local ActiveThreads = {}

local AntiAFK = {}

local function StopThread(threadType)
    if ActiveThreads[threadType] then
        local thread = ActiveThreads[threadType]
        ActiveThreads[threadType] = nil
        if coroutine.status(thread) ~= "dead" then
            task.cancel(thread)
        end
    end
end

function AntiAFK.StartJumpThread(config)
    StopThread("Jump")
    ActiveThreads.Jump = task.spawn(function()
        while config.JumpEnabled do
            task.wait(config.JumpDelay)
            if config.JumpEnabled and LocalPlayer.Character then
                local humanoid = LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
                if humanoid then
                    humanoid:ChangeState(Enum.HumanoidStateType.Jumping)
                end
            end
        end
        ActiveThreads.Jump = nil
    end)
end

function AntiAFK.StopJumpThread()
    StopThread("Jump")
end

function AntiAFK.StartClickThread(config)
    StopThread("Click")
    ActiveThreads.Click = task.spawn(function()
        while config.ClickEnabled do
            task.wait(config.ClickDelay)
            if config.ClickEnabled then
                local x, y
                if config.ClickType == "Current" then
                    local mousePos = UserInputService:GetMouseLocation()
                    x, y = mousePos.X, mousePos.Y
                elseif config.ClickType == "Center" then
                    local viewport = workspace.CurrentCamera.ViewportSize
                    x, y = viewport.X/2, viewport.Y/2
                else
                    local viewport = workspace.CurrentCamera.ViewportSize
                    x, y = math.random(100, viewport.X - 100), math.random(100, viewport.Y - 100)
                end
                VirtualInputManager:SendMouseButtonEvent(x, y, 0, true, game, 0)
                task.wait(0.05)
                VirtualInputManager:SendMouseButtonEvent(x, y, 0, false, game, 0)
            end
        end
        ActiveThreads.Click = nil
    end)
end

function AntiAFK.StopClickThread()
    StopThread("Click")
end

function AntiAFK.CleanupAll()
    AntiAFK.StopJumpThread()
    AntiAFK.StopClickThread()
end

return AntiAFK
