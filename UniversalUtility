local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local CoreGui = game:GetService("CoreGui")
local VirtualInputManager = game:GetService("VirtualInputManager")
local MarketplaceService = game:GetService("MarketplaceService")
local TeleportService = game:GetService("TeleportService")

local FPS_SUPPORTED = typeof(setfpscap) == "function"
local LocalPlayer = Players.LocalPlayer

local oldGui = CoreGui:FindFirstChild("UniversalUtility") or (gethui and gethui():FindFirstChild("UniversalUtility"))
if oldGui then
    oldGui:Destroy()
end

local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "UniversalUtility"
ScreenGui.ResetOnSpawn = false
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

local function ProtectGui()
    if syn and syn.protect_gui then
        syn.protect_gui(ScreenGui)
        ScreenGui.Parent = CoreGui
    elseif gethui then
        ScreenGui.Parent = gethui()
    else
        ScreenGui.Parent = CoreGui
    end
end

ProtectGui()

local KeyCodeNames, KeyCodeMap = {}, {}
for i = 65, 90 do
    local char = string.char(i)
    KeyCodeNames[Enum.KeyCode[char]] = char
    KeyCodeMap[char] = Enum.KeyCode[char]
end

local numNames = {"One","Two","Three","Four","Five","Six","Seven","Eight","Nine"}
for i = 0, 9 do
    local keyName = i == 0 and "Zero" or numNames[i]
    KeyCodeNames[Enum.KeyCode[keyName]] = tostring(i)
    KeyCodeMap[tostring(i)] = Enum.KeyCode[keyName]
end

for i = 1, 12 do
    KeyCodeNames[Enum.KeyCode["F" .. i]] = "F" .. i
    KeyCodeMap["F" .. i] = Enum.KeyCode["F" .. i]
end

local specialKeys = {
    LeftControl = "Left Ctrl",
    RightControl = "Right Ctrl",
    LeftShift = "Left Shift",
    RightShift = "Right Shift",
    LeftAlt = "Left Alt",
    RightAlt = "Right Alt",
    Tab = "Tab",
    CapsLock = "Caps Lock",
    Space = "Space",
    Return = "Enter",
    Backspace = "Backspace",
    Delete = "Delete",
    Insert = "Insert",
    Home = "Home",
    End = "End",
    PageUp = "Page Up",
    PageDown = "Page Down"
}

for k, v in pairs(specialKeys) do
    KeyCodeNames[Enum.KeyCode[k]] = v
end

local Config = {
    Keybind = Enum.KeyCode.G,
    ClickType = "Current",
    JumpEnabled = false,
    ClickEnabled = false,
    AutoSpamEnabled = false,
    IsChangingKeybind = false,
    FPSUnlockEnabled = false,
    AutoRejoinEnabled = false,
    TargetFPS = 60,
    JumpDelay = 10.0,
    ClickDelay = 3.0,
    SpamDelay = 0.1,
    SpamKey = "Q",
    SavedCode = ""
}

local ActiveThreads = {
    Jump = nil,
    Click = nil,
    Spam = nil
}

local function SaveConfig()
    if writefile then
        local configData = game:GetService("HttpService"):JSONEncode({
            Keybind = Config.Keybind.Name,
            ClickType = Config.ClickType,
            JumpEnabled = Config.JumpEnabled,
            ClickEnabled = Config.ClickEnabled,
            AutoRejoinEnabled = Config.AutoRejoinEnabled,
            FPSUnlockEnabled = Config.FPSUnlockEnabled,
            AutoSpamEnabled = Config.AutoSpamEnabled,
            TargetFPS = Config.TargetFPS,
            JumpDelay = Config.JumpDelay,
            ClickDelay = Config.ClickDelay,
            SpamDelay = Config.SpamDelay,
            SpamKey = Config.SpamKey,
            SavedCode = Config.SavedCode
        })
        writefile("UniversalUtilityConfig.json", configData)
    end
end

local function LoadConfig()
    if readfile and isfile and isfile("UniversalUtilityConfig.json") then
        local success, data = pcall(function()
            return game:GetService("HttpService"):JSONDecode(readfile("UniversalUtilityConfig.json"))
        end)
        if success and data then
            Config.Keybind = Enum.KeyCode[data.Keybind] or Enum.KeyCode.G
            Config.ClickType = data.ClickType or "Current"
            Config.JumpEnabled = data.JumpEnabled or false
            Config.ClickEnabled = data.ClickEnabled or false
            Config.AutoRejoinEnabled = data.AutoRejoinEnabled or false
            Config.FPSUnlockEnabled = data.FPSUnlockEnabled or false
            Config.AutoSpamEnabled = data.AutoSpamEnabled or false
            Config.TargetFPS = data.TargetFPS or 60
            Config.JumpDelay = data.JumpDelay or 10.0
            Config.ClickDelay = data.ClickDelay or 3.0
            Config.SpamDelay = data.SpamDelay or 0.1
            Config.SpamKey = data.SpamKey or "Q"
            Config.SavedCode = data.SavedCode or ""
            return true
        end
    end
    return false
end

local TweenPresets = {
    Fast = TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
    Medium = TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
    Slow = TweenInfo.new(0.4, Enum.EasingStyle.Quad, Enum.EasingDirection.In),
    Back = TweenInfo.new(0.6, Enum.EasingStyle.Back, Enum.EasingDirection.Out),
    BackIn = TweenInfo.new(0.4, Enum.EasingStyle.Back, Enum.EasingDirection.In)
}

local Debounces = {
    UI = false,
    Jump = false,
    Click = false,
    Spam = false,
    FPS = false,
    Rejoin = false,
    Execute = false,
    Keybind = false
}

local function SetDebounce(key, duration)
    if Debounces[key] then
        return false
    end
    Debounces[key] = true
    task.delay(duration or 0.3, function()
        Debounces[key] = false
    end)
    return true
end

local ReopenButton = Instance.new("ImageButton", ScreenGui)
ReopenButton.Name = "ReopenButton"
ReopenButton.Size = UDim2.new(0, 0, 0, 0)
ReopenButton.Position = UDim2.new(0.5, 0, 0, 30)
ReopenButton.BackgroundColor3 = Color3.fromRGB(100, 150, 255)
ReopenButton.BorderSizePixel = 0
ReopenButton.Visible = false
ReopenButton.ZIndex = 10

local ReopenCorner = Instance.new("UICorner", ReopenButton)
ReopenCorner.CornerRadius = UDim.new(1, 0)

local ReopenIcon = Instance.new("TextLabel", ReopenButton)
ReopenIcon.Size = UDim2.new(1, 0, 1, 0)
ReopenIcon.BackgroundTransparency = 1
ReopenIcon.Text = "‚ö°"
ReopenIcon.Font = Enum.Font.GothamBold
ReopenIcon.TextSize = 24
ReopenIcon.TextColor3 = Color3.fromRGB(255, 255, 255)

local MainFrame = Instance.new("Frame", ScreenGui)
MainFrame.Name = "MainFrame"
MainFrame.Size = UDim2.new(0, 0, 0, 0)
MainFrame.Position = UDim2.new(0.5, 0, 0.5, 0)
MainFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 30)
MainFrame.BorderSizePixel = 0
MainFrame.Active = true
MainFrame.Draggable = true
MainFrame.ClipsDescendants = true
MainFrame.Visible = false

local UICorner = Instance.new("UICorner", MainFrame)
UICorner.CornerRadius = UDim.new(0, 16)

local TopBar = Instance.new("Frame", MainFrame)
TopBar.Name = "TopBar"
TopBar.Size = UDim2.new(1, 0, 0, 40)
TopBar.BackgroundColor3 = Color3.fromRGB(35, 35, 42)
TopBar.BorderSizePixel = 0

local TopBarCorner = Instance.new("UICorner", TopBar)
TopBarCorner.CornerRadius = UDim.new(0, 16)

local Title = Instance.new("TextLabel", TopBar)
Title.Size = UDim2.new(1, -80, 1, 0)
Title.Position = UDim2.new(0, 15, 0, 0)
Title.BackgroundTransparency = 1
Title.Text = "‚ö° Universal Utility"
Title.Font = Enum.Font.GothamBold
Title.TextSize = 18
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.TextXAlignment = Enum.TextXAlignment.Left

local CloseButton = Instance.new("ImageButton", TopBar)
CloseButton.Size = UDim2.new(0, 30, 0, 30)
CloseButton.Position = UDim2.new(1, -27.5, 0.5, 0)
CloseButton.BackgroundColor3 = Color3.fromRGB(220, 50, 50)
CloseButton.BorderSizePixel = 0
CloseButton.Image = "rbxassetid://3926305904"
CloseButton.ImageRectOffset = Vector2.new(284, 4)
CloseButton.ImageRectSize = Vector2.new(24, 24)
CloseButton.ImageColor3 = Color3.fromRGB(255, 255, 255)

local CloseButtonCorner = Instance.new("UICorner", CloseButton)
CloseButtonCorner.CornerRadius = UDim.new(0, 8)

local ScrollFrame = Instance.new("ScrollingFrame", MainFrame)
ScrollFrame.Size = UDim2.new(1, -20, 1, 60)
ScrollFrame.Position = UDim2.new(0, 10, 0, 50)
ScrollFrame.BackgroundTransparency = 1
ScrollFrame.BorderSizePixel = 0
ScrollFrame.ScrollBarThickness = 3
ScrollFrame.ScrollBarImageColor3 = Color3.fromRGB(100, 150, 255)
ScrollFrame.ScrollBarImageTransparency = 0.7
ScrollFrame.CanvasSize = UDim2.new(0, 0, 0, 1600)

local ContentFrame = Instance.new("Frame", ScrollFrame)
ContentFrame.Size = UDim2.new(1, 0, 0, 1600)
ContentFrame.BackgroundTransparency = 1

local function CreateSection(name, position, height)
    local section = Instance.new("Frame", ContentFrame)
    section.Size = UDim2.new(1, 0, 0, height)
    section.Position = position
    section.BackgroundColor3 = Color3.fromRGB(35, 35, 42)
    section.BorderSizePixel = 0

    local corner = Instance.new("UICorner", section)
    corner.CornerRadius = UDim.new(0, 10)

    local title = Instance.new("TextLabel", section)
    title.Size = UDim2.new(1, -20, 0, 24)
    title.Position = UDim2.new(0, 10, 0, 8)
    title.BackgroundTransparency = 1
    title.Text = name
    title.Font = Enum.Font.GothamBold
    title.TextSize = 15
    title.TextColor3 = Color3.fromRGB(255, 255, 255)
    title.TextXAlignment = Enum.TextXAlignment.Left

    return section
end

local function CreateButton(parent, size, position, text)
    local button = Instance.new("TextButton", parent)
    button.Size = size
    button.Position = position
    button.AnchorPoint = Vector2.new(0.5, 0.5)
    button.BackgroundColor3 = Color3.fromRGB(45, 45, 52)
    button.Text = text
    button.Font = Enum.Font.GothamBold
    button.TextSize = 13
    button.TextColor3 = Color3.fromRGB(255, 255, 255)
    button.BorderSizePixel = 0

    local corner = Instance.new("UICorner", button)
    corner.CornerRadius = UDim.new(0, 8)

    local originalSize = size
    local isHovering = false

    button.MouseEnter:Connect(function()
        isHovering = true
        TweenService:Create(button, TweenPresets.Fast, {
            Size = UDim2.new(originalSize.X.Scale, originalSize.X.Offset + 6, originalSize.Y.Scale, originalSize.Y.Offset + 4)
        }):Play()
    end)

    button.MouseLeave:Connect(function()
        isHovering = false
        TweenService:Create(button, TweenPresets.Fast, {
            Size = originalSize
        }):Play()
    end)

    button.MouseButton1Down:Connect(function()
        if isHovering then
            TweenService:Create(button, TweenInfo.new(0.1, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
                Size = UDim2.new(originalSize.X.Scale, originalSize.X.Offset - 4, originalSize.Y.Scale, originalSize.Y.Offset - 3)
            }):Play()
        end
    end)

    button.MouseButton1Up:Connect(function()
        if isHovering then
            TweenService:Create(button, TweenPresets.Fast, {
                Size = UDim2.new(originalSize.X.Scale, originalSize.X.Offset + 6, originalSize.Y.Scale, originalSize.Y.Offset + 4)
            }):Play()
        else
            TweenService:Create(button, TweenPresets.Fast, {
                Size = originalSize
            }):Play()
        end
    end)

    return button
end

local function CreateSlider(parent, size, position, minValue, maxValue, currentValue, labelText)
    local sliderFrame = Instance.new("Frame", parent)
    sliderFrame.Size = UDim2.new(size.X.Scale, size.X.Offset, 0, 36)
    sliderFrame.Position = position
    sliderFrame.BackgroundTransparency = 1

    local valueLabel = Instance.new("TextLabel", sliderFrame)
    valueLabel.Size = UDim2.new(1, 0, 0, 16)
    valueLabel.BackgroundTransparency = 1
    valueLabel.Text = labelText
    valueLabel.Font = Enum.Font.Gotham
    valueLabel.TextSize = 12
    valueLabel.TextColor3 = Color3.fromRGB(180, 180, 180)
    valueLabel.TextXAlignment = Enum.TextXAlignment.Left

    local slider = Instance.new("Frame", sliderFrame)
    slider.Size = UDim2.new(1, 0, 0, 6)
    slider.Position = UDim2.new(0, 0, 0, 18)
    slider.BackgroundColor3 = Color3.fromRGB(45, 45, 52)
    slider.BorderSizePixel = 0

    local sliderCorner = Instance.new("UICorner", slider)
    sliderCorner.CornerRadius = UDim.new(0, 3)

    local fill = Instance.new("Frame", slider)
    fill.Size = UDim2.new(0.5, 0, 1, 0)
    fill.BackgroundColor3 = Color3.fromRGB(100, 150, 255)
    fill.BorderSizePixel = 0

    local fillCorner = Instance.new("UICorner", fill)
    fillCorner.CornerRadius = UDim.new(0, 3)

    local button = Instance.new("TextButton", slider)
    button.Size = UDim2.new(1, 0, 1, 0)
    button.BackgroundTransparency = 1
    button.Text = ""

    local valueBox = Instance.new("TextBox", sliderFrame)
    valueBox.Size = UDim2.new(0, 50, 0, 24)
    valueBox.Position = UDim2.new(1, -50, 0, 26)
    valueBox.BackgroundColor3 = Color3.fromRGB(45, 45, 52)
    valueBox.Text = tostring(currentValue)
    valueBox.Font = Enum.Font.Gotham
    valueBox.TextScaled = true
    valueBox.TextColor3 = Color3.fromRGB(255, 255, 255)
    valueBox.ClearTextOnFocus = false

    local valueCorner = Instance.new("UICorner", valueBox)
    valueCorner.CornerRadius = UDim.new(0, 5)

    return sliderFrame, slider, fill, button, valueBox, valueLabel
end

local HomeSection = CreateSection("üè† Home", UDim2.new(0, 0, 0, 0), 260)

local PlayerInfoFrame = Instance.new("Frame", HomeSection)
PlayerInfoFrame.Size = UDim2.new(0, 140, 0, 200)
PlayerInfoFrame.Position = UDim2.new(1, -150, 0, 40)
PlayerInfoFrame.BackgroundTransparency = 1

local PlayerImage = Instance.new("ImageLabel", PlayerInfoFrame)
PlayerImage.Size = UDim2.new(1, 0, 0, 140)
PlayerImage.BackgroundColor3 = Color3.fromRGB(45, 45, 52)
PlayerImage.BorderSizePixel = 0
PlayerImage.Image = "rbxasset://textures/ui/GuiImagePlaceholder.png"

local PlayerImageCorner = Instance.new("UICorner", PlayerImage)
PlayerImageCorner.CornerRadius = UDim.new(0, 10)

local PlayerName = Instance.new("TextLabel", PlayerInfoFrame)
PlayerName.Size = UDim2.new(1, 0, 0, 18)
PlayerName.Position = UDim2.new(0, 0, 0, 145)
PlayerName.BackgroundTransparency = 1
PlayerName.Text = LocalPlayer.Name
PlayerName.Font = Enum.Font.GothamBold
PlayerName.TextSize = 13
PlayerName.TextColor3 = Color3.fromRGB(255, 255, 255)
PlayerName.TextXAlignment = Enum.TextXAlignment.Center

local FPSLabel = Instance.new("TextLabel", PlayerInfoFrame)
FPSLabel.Size = UDim2.new(1, 0, 0, 18)
FPSLabel.Position = UDim2.new(0, 0, 0, 165)
FPSLabel.BackgroundTransparency = 1
FPSLabel.Text = "FPS: 60"
FPSLabel.Font = Enum.Font.Gotham
FPSLabel.TextSize = 12
FPSLabel.TextColor3 = Color3.fromRGB(180, 180, 180)
FPSLabel.TextXAlignment = Enum.TextXAlignment.Center

local PingLabel = Instance.new("TextLabel", PlayerInfoFrame)
PingLabel.Size = UDim2.new(1, 0, 0, 18)
PingLabel.Position = UDim2.new(0, 0, 0, 183)
PingLabel.BackgroundTransparency = 1
PingLabel.Text = "Ping: 0 ms"
PingLabel.Font = Enum.Font.Gotham
PingLabel.TextSize = 12
PingLabel.TextColor3 = Color3.fromRGB(0, 255, 0)
PingLabel.TextXAlignment = Enum.TextXAlignment.Center

local GameInfoFrame = Instance.new("Frame", HomeSection)
GameInfoFrame.Size = UDim2.new(0, 280, 0, 200)
GameInfoFrame.Position = UDim2.new(0, 10, 0, 40)
GameInfoFrame.BackgroundTransparency = 1

local GameImage = Instance.new("ImageLabel", GameInfoFrame)
GameImage.Size = UDim2.new(1, 0, 0, 140)
GameImage.BackgroundColor3 = Color3.fromRGB(45, 45, 52)
GameImage.BorderSizePixel = 0
GameImage.Image = "rbxasset://textures/ui/GuiImagePlaceholder.png"

local GameImageCorner = Instance.new("UICorner", GameImage)
GameImageCorner.CornerRadius = UDim.new(0, 10)

local GameName = Instance.new("TextLabel", GameInfoFrame)
GameName.Size = UDim2.new(1, 0, 0, 30)
GameName.Position = UDim2.new(0, 0, 0, 145)
GameName.BackgroundTransparency = 1
GameName.Text = "Loading..."
GameName.Font = Enum.Font.GothamBold
GameName.TextSize = 14
GameName.TextColor3 = Color3.fromRGB(255, 255, 255)
GameName.TextXAlignment = Enum.TextXAlignment.Center
GameName.TextWrapped = true

local GameId = Instance.new("TextLabel", GameInfoFrame)
GameId.Size = UDim2.new(1, 0, 0, 18)
GameId.Position = UDim2.new(0, 0, 0, 177)
GameId.BackgroundTransparency = 1
GameId.Text = "Gmae ID: " .. game.PlaceId
GameId.Font = Enum.Font.Gotham
GameId.TextSize = 12
GameId.TextColor3 = Color3.fromRGB(180, 180, 180)
GameId.TextXAlignment = Enum.TextXAlignment.Center

local AntiAFKSection = CreateSection("üõ°Ô∏è Anti-AFK System", UDim2.new(0, 0, 0, 275), 240)

local JumpToggle = CreateButton(AntiAFKSection, UDim2.new(0, 200, 0, 32), UDim2.new(0, 110, 0, 56), "Auto Jump: OFF")
local ClickToggle = CreateButton(AntiAFKSection, UDim2.new(0, 200, 0, 32), UDim2.new(1, -110, 0, 56), "Auto Click: OFF")

local ClickTypeLabel = Instance.new("TextLabel", AntiAFKSection)
ClickTypeLabel.Size = UDim2.new(1, -20, 0, 18)
ClickTypeLabel.Position = UDim2.new(0, 10, 0, 78)
ClickTypeLabel.BackgroundTransparency = 1
ClickTypeLabel.Text = "Click Type:"
ClickTypeLabel.Font = Enum.Font.Gotham
ClickTypeLabel.TextSize = 12
ClickTypeLabel.TextColor3 = Color3.fromRGB(180, 180, 180)
ClickTypeLabel.TextXAlignment = Enum.TextXAlignment.Left

local ClickTypeCurrent = CreateButton(AntiAFKSection, UDim2.new(0, 120, 0, 26), UDim2.new(0, 70, 0, 113), "Current")
local ClickTypeCenter = CreateButton(AntiAFKSection, UDim2.new(0, 120, 0, 26), UDim2.new(0.5, 0, 0, 113), "Center")
local ClickTypeRandom = CreateButton(AntiAFKSection, UDim2.new(0, 120, 0, 26), UDim2.new(1, -70, 0, 113), "Random")

local JumpDelayFrame, JumpDelaySlider, JumpSliderFill, JumpSliderButton, JumpDelayBox, JumpDelayLabel = CreateSlider(AntiAFKSection, UDim2.new(0, 200, 0, 36), UDim2.new(0, 10, 0, 132), 5, 30, 10, "Jump Delay:")
local ClickDelayFrame, ClickDelaySlider, ClickSliderFill, ClickSliderButton, ClickDelayBox, ClickDelayLabel = CreateSlider(AntiAFKSection, UDim2.new(0, 200, 0, 36), UDim2.new(1, -210, 0, 132), 1, 10, 3, "Click Delay:")

local AntiAFKStatus = Instance.new("TextLabel", AntiAFKSection)
AntiAFKStatus.Size = UDim2.new(1, -20, 0, 28)
AntiAFKStatus.Position = UDim2.new(0, 10, 0, 200)
AntiAFKStatus.BackgroundTransparency = 1
AntiAFKStatus.Text = "Status: All Inactive"
AntiAFKStatus.Font = Enum.Font.Gotham
AntiAFKStatus.TextSize = 12
AntiAFKStatus.TextColor3 = Color3.fromRGB(180, 180, 180)
AntiAFKStatus.TextXAlignment = Enum.TextXAlignment.Center

local AutoSpamSection = CreateSection("‚å®Ô∏è Auto Key Spam", UDim2.new(0, 0, 0, 523), 170)

local SpamInput = Instance.new("TextBox", AutoSpamSection)
SpamInput.Size = UDim2.new(1, -20, 0, 36)
SpamInput.Position = UDim2.new(0, 10, 0, 40)
SpamInput.BackgroundColor3 = Color3.fromRGB(45, 45, 52)
SpamInput.Text = Config.SpamKey
SpamInput.PlaceholderText = "Enter key (A-Z, 0-9, F1-F12)"
SpamInput.Font = Enum.Font.Gotham
SpamInput.TextSize = 13
SpamInput.TextColor3 = Color3.fromRGB(255, 255, 255)
SpamInput.PlaceholderColor3 = Color3.fromRGB(120, 120, 120)
SpamInput.BorderSizePixel = 0
SpamInput.ClearTextOnFocus = false

local InputCorner = Instance.new("UICorner", SpamInput)
InputCorner.CornerRadius = UDim.new(0, 8)

local SpamDelayFrame, SpamDelaySlider, SpamSliderFill, SpamSliderButton, SpamDelayBox, SpamDelayLabel = CreateSlider(AutoSpamSection, UDim2.new(1, -20, 0, 36), UDim2.new(0, 10, 0, 82), 0.05, 5, 0.1, "Delay:")

local AutoSpamToggle = CreateButton(AutoSpamSection, UDim2.new(0, 90, 0, 32), UDim2.new(0, 55, 0, 140), "OFF")

local AutoSpamStatus = Instance.new("TextLabel", AutoSpamSection)
AutoSpamStatus.Size = UDim2.new(1, -110, 0, 32)
AutoSpamStatus.Position = UDim2.new(0, 106, 0, 124)
AutoSpamStatus.BackgroundTransparency = 1
AutoSpamStatus.Text = "Status: Inactive"
AutoSpamStatus.Font = Enum.Font.Gotham
AutoSpamStatus.TextSize = 12
AutoSpamStatus.TextColor3 = Color3.fromRGB(180, 180, 180)
AutoSpamStatus.TextXAlignment = Enum.TextXAlignment.Left

local FPSAnalyticsSection = CreateSection("üìä FPS & Ping Analytics", UDim2.new(0, 0, 0, 705), 300)

local FPSUnlockToggle = CreateButton(FPSAnalyticsSection, UDim2.new(0, 140, 0, 32), UDim2.new(0, 80, 0, 56), "FPS Unlock: OFF")

local FPSUnlockStatus = Instance.new("TextLabel", FPSAnalyticsSection)
FPSUnlockStatus.Size = UDim2.new(1, -160, 0, 32)
FPSUnlockStatus.Position = UDim2.new(0, 156, 0, 40)
FPSUnlockStatus.BackgroundTransparency = 1
FPSUnlockStatus.Text = "Target: 60 FPS"
FPSUnlockStatus.Font = Enum.Font.Gotham
FPSUnlockStatus.TextSize = 12
FPSUnlockStatus.TextColor3 = Color3.fromRGB(180, 180, 180)
FPSUnlockStatus.TextXAlignment = Enum.TextXAlignment.Left

local FPSValueFrame, FPSSlider, FPSFill, FPSButton, FPSValueBox, FPSValueLabel = CreateSlider(FPSAnalyticsSection, UDim2.new(1, -20, 0, 36), UDim2.new(0, 10, 0, 78), 15, 360, 60, "Target FPS:")

local FPSStatsFrame = Instance.new("Frame", FPSAnalyticsSection)
FPSStatsFrame.Size = UDim2.new(1, -20, 0, 40)
FPSStatsFrame.Position = UDim2.new(0, 10, 0, 150)
FPSStatsFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 35)
FPSStatsFrame.BorderSizePixel = 0

local StatsCorner = Instance.new("UICorner", FPSStatsFrame)
StatsCorner.CornerRadius = UDim.new(0, 8)

local CurrentFPSLabel = Instance.new("TextLabel", FPSStatsFrame)
CurrentFPSLabel.Size = UDim2.new(0.33, 0, 1, 0)
CurrentFPSLabel.Position = UDim2.new(0, 0, 0, 0)
CurrentFPSLabel.BackgroundTransparency = 1
CurrentFPSLabel.Text = "Current: 60"
CurrentFPSLabel.Font = Enum.Font.GothamBold
CurrentFPSLabel.TextSize = 12
CurrentFPSLabel.TextColor3 = Color3.fromRGB(100, 200, 255)
CurrentFPSLabel.TextXAlignment = Enum.TextXAlignment.Center

local AvgFPSLabel = Instance.new("TextLabel", FPSStatsFrame)
AvgFPSLabel.Size = UDim2.new(0.33, 0, 1, 0)
AvgFPSLabel.Position = UDim2.new(0.33, 0, 0, 0)
AvgFPSLabel.BackgroundTransparency = 1
AvgFPSLabel.Text = "Average: 60"
AvgFPSLabel.Font = Enum.Font.GothamBold
AvgFPSLabel.TextSize = 12
AvgFPSLabel.TextColor3 = Color3.fromRGB(50, 220, 100)
AvgFPSLabel.TextXAlignment = Enum.TextXAlignment.Center

local MinMaxFPSLabel = Instance.new("TextLabel", FPSStatsFrame)
MinMaxFPSLabel.Size = UDim2.new(0.34, 0, 1, 0)
MinMaxFPSLabel.Position = UDim2.new(0.66, 0, 0, 0)
MinMaxFPSLabel.BackgroundTransparency = 1
MinMaxFPSLabel.Text = "Min: 60 | Max: 60"
MinMaxFPSLabel.Font = Enum.Font.GothamBold
MinMaxFPSLabel.TextSize = 12
MinMaxFPSLabel.TextColor3 = Color3.fromRGB(255, 200, 100)
MinMaxFPSLabel.TextXAlignment = Enum.TextXAlignment.Center

local PingStatsFrame = Instance.new("Frame", FPSAnalyticsSection)
PingStatsFrame.Size = UDim2.new(1, -20, 0, 40)
PingStatsFrame.Position = UDim2.new(0, 10, 0, 200)
PingStatsFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 35)
PingStatsFrame.BorderSizePixel = 0

local PingStatsCorner = Instance.new("UICorner", PingStatsFrame)
PingStatsCorner.CornerRadius = UDim.new(0, 8)

local CurrentPingLabel = Instance.new("TextLabel", PingStatsFrame)
CurrentPingLabel.Size = UDim2.new(0.33, 0, 1, 0)
CurrentPingLabel.Position = UDim2.new(0, 0, 0, 0)
CurrentPingLabel.BackgroundTransparency = 1
CurrentPingLabel.Text = "Current: 0ms"
CurrentPingLabel.Font = Enum.Font.GothamBold
CurrentPingLabel.TextSize = 12
CurrentPingLabel.TextColor3 = Color3.fromRGB(100, 200, 255)
CurrentPingLabel.TextXAlignment = Enum.TextXAlignment.Center

local AvgPingLabel = Instance.new("TextLabel", PingStatsFrame)
AvgPingLabel.Size = UDim2.new(0.33, 0, 1, 0)
AvgPingLabel.Position = UDim2.new(0.33, 0, 0, 0)
AvgPingLabel.BackgroundTransparency = 1
AvgPingLabel.Text = "Average: 0ms"
AvgPingLabel.Font = Enum.Font.GothamBold
AvgPingLabel.TextSize = 12
AvgPingLabel.TextColor3 = Color3.fromRGB(50, 220, 100)
AvgPingLabel.TextXAlignment = Enum.TextXAlignment.Center

local MinMaxPingLabel = Instance.new("TextLabel", PingStatsFrame)
MinMaxPingLabel.Size = UDim2.new(0.34, 0, 1, 0)
MinMaxPingLabel.Position = UDim2.new(0.66, 0, 0, 0)
MinMaxPingLabel.BackgroundTransparency = 1
MinMaxPingLabel.Text = "Min: 0ms | Max: 0ms"
MinMaxPingLabel.Font = Enum.Font.GothamBold
MinMaxPingLabel.TextSize = 12
MinMaxPingLabel.TextColor3 = Color3.fromRGB(255, 200, 100)
MinMaxPingLabel.TextXAlignment = Enum.TextXAlignment.Center

local NetworkStatusFrame = Instance.new("Frame", FPSAnalyticsSection)
NetworkStatusFrame.Size = UDim2.new(1, -20, 0, 40)
NetworkStatusFrame.Position = UDim2.new(0, 10, 0, 250)
NetworkStatusFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 35)
NetworkStatusFrame.BorderSizePixel = 0

local NetworkStatusCorner = Instance.new("UICorner", NetworkStatusFrame)
NetworkStatusCorner.CornerRadius = UDim.new(0, 8)

local NetworkStatusLabel = Instance.new("TextLabel", NetworkStatusFrame)
NetworkStatusLabel.Size = UDim2.new(0.5, 0, 1, 0)
NetworkStatusLabel.Position = UDim2.new(0, 0, 0, 0)
NetworkStatusLabel.BackgroundTransparency = 1
NetworkStatusLabel.Text = "Network Status:"
NetworkStatusLabel.Font = Enum.Font.GothamBold
NetworkStatusLabel.TextSize = 12
NetworkStatusLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
NetworkStatusLabel.TextXAlignment = Enum.TextXAlignment.Center

local NetworkQualityLabel = Instance.new("TextLabel", NetworkStatusFrame)
NetworkQualityLabel.Size = UDim2.new(0.5, 0, 1, 0)
NetworkQualityLabel.Position = UDim2.new(0.5, 0, 0, 0)
NetworkQualityLabel.BackgroundTransparency = 1
NetworkQualityLabel.Text = "Excellent"
NetworkQualityLabel.Font = Enum.Font.GothamBold
NetworkQualityLabel.TextSize = 12
NetworkQualityLabel.TextColor3 = Color3.fromRGB(50, 220, 100)
NetworkQualityLabel.TextXAlignment = Enum.TextXAlignment.Center

local FPSHistory = {}
local PingHistory = {}
local MAX_POINTS = 60
for i = 1, MAX_POINTS do
    table.insert(FPSHistory, 60)
    table.insert(PingHistory, 0)
end

local function UpdateFPSStats(fps)
    table.remove(FPSHistory, 1)
    table.insert(FPSHistory, fps)
    local minFPS, maxFPS, totalFPS = math.huge, 0, 0
    for _, fpsVal in ipairs(FPSHistory) do
        minFPS = math.min(minFPS, fpsVal)
        maxFPS = math.max(maxFPS, fpsVal)
        totalFPS = totalFPS + fpsVal
    end
    local avgFPS = math.floor(totalFPS / #FPSHistory)
    CurrentFPSLabel.Text = "Current: " .. fps
    AvgFPSLabel.Text = "Average: " .. avgFPS
    MinMaxFPSLabel.Text = string.format("Min: %d | Max: %d", minFPS, maxFPS)
end

local function UpdatePingStats(ping)
    table.remove(PingHistory, 1)
    table.insert(PingHistory, ping)
    local minPing, maxPing, totalPing = math.huge, 0, 0
    for _, pingVal in ipairs(PingHistory) do
        minPing = math.min(minPing, pingVal)
        maxPing = math.max(maxPing, pingVal)
        totalPing = totalPing + pingVal
    end
    local avgPing = math.floor(totalPing / #PingHistory)
    CurrentPingLabel.Text = "Current: " .. ping .. "ms"
    AvgPingLabel.Text = "Average: " .. avgPing .. "ms"
    MinMaxPingLabel.Text = string.format("Min: %dms | Max: %dms", minPing, maxPing)
    
    local qualityText, qualityColor
    if ping < 50 then
        qualityText, qualityColor = "Excellent", Color3.fromRGB(50, 220, 100)
    elseif ping < 100 then
        qualityText, qualityColor = "Good", Color3.fromRGB(100, 200, 255)
    elseif ping < 200 then
        qualityText, qualityColor = "Fair", Color3.fromRGB(255, 200, 100)
    elseif ping < 300 then
        qualityText, qualityColor = "Poor", Color3.fromRGB(255, 150, 50)
    else
        qualityText, qualityColor = "Very Poor", Color3.fromRGB(220, 50, 50)
    end
    NetworkQualityLabel.Text = qualityText
    NetworkQualityLabel.TextColor3 = qualityColor
end

local AutoRejoinSection = CreateSection("üîÑ Auto Rejoin", UDim2.new(0, 0, 0, 1015), 130)

local AutoRejoinToggle = CreateButton(AutoRejoinSection, UDim2.new(1, -20, 0, 36), UDim2.new(0.5, 0, 0, 58), "Auto Rejoin: OFF")

local AutoRejoinStatus = Instance.new("TextLabel", AutoRejoinSection)
AutoRejoinStatus.Size = UDim2.new(1, -20, 0, 50)
AutoRejoinStatus.Position = UDim2.new(0, 10, 0, 74)
AutoRejoinStatus.BackgroundTransparency = 1
AutoRejoinStatus.Text = "Status: Disabled\n\nAutomatically rejoins when disconnected"
AutoRejoinStatus.Font = Enum.Font.Gotham
AutoRejoinStatus.TextSize = 11
AutoRejoinStatus.TextColor3 = Color3.fromRGB(180, 180, 180)
AutoRejoinStatus.TextXAlignment = Enum.TextXAlignment.Center
AutoRejoinStatus.TextWrapped = true

local LoadStringSection = CreateSection("üíæ Code Loader (Works for mostly scripts - Depends on executor)", UDim2.new(0, 0, 0, 1155), 200)

local LoadStringBox = Instance.new("TextBox", LoadStringSection)
LoadStringBox.Size = UDim2.new(1, -20, 0, 80)
LoadStringBox.Position = UDim2.new(0, 10, 0, 40)
LoadStringBox.BackgroundColor3 = Color3.fromRGB(45, 45, 52)
LoadStringBox.Text = Config.SavedCode
LoadStringBox.PlaceholderText = "Paste your code here..."
LoadStringBox.Font = Enum.Font.Gotham
LoadStringBox.TextSize = 12
LoadStringBox.TextColor3 = Color3.fromRGB(255, 255, 255)
LoadStringBox.PlaceholderColor3 = Color3.fromRGB(120, 120, 120)
LoadStringBox.BorderSizePixel = 0
LoadStringBox.TextWrapped = true
LoadStringBox.MultiLine = true
LoadStringBox.ClearTextOnFocus = false

local LoadStringCorner = Instance.new("UICorner", LoadStringBox)
LoadStringCorner.CornerRadius = UDim.new(0, 8)

local ExecuteButton = CreateButton(LoadStringSection, UDim2.new(1, -20, 0, 36), UDim2.new(0.5, 0, 0, 144), "Execute your code")

local LoadStringStatus = Instance.new("TextLabel", LoadStringSection)
LoadStringStatus.Size = UDim2.new(1, -20, 0, 24)
LoadStringStatus.Position = UDim2.new(0, 10, 0, 168)
LoadStringStatus.BackgroundTransparency = 1
LoadStringStatus.Text = "Status: Ready"
LoadStringStatus.Font = Enum.Font.Gotham
LoadStringStatus.TextSize = 11
LoadStringStatus.TextColor3 = Color3.fromRGB(180, 180, 180)
LoadStringStatus.TextXAlignment = Enum.TextXAlignment.Center

local SaveCodeTimer = nil
local SaveCodeDelay = 1.0

local function SaveCodeAutomatically()
    if SaveCodeTimer then
        task.cancel(SaveCodeTimer)
    end
    SaveCodeTimer = task.delay(SaveCodeDelay, function()
        Config.SavedCode = LoadStringBox.Text
        SaveConfig()
        LoadStringStatus.Text = "Status: Code auto-saved"
        LoadStringStatus.TextColor3 = Color3.fromRGB(100, 200, 255)
        task.wait(2)
        if LoadStringStatus.Text == "Status: Code auto-saved" then
            LoadStringStatus.Text = "Status: Ready"
            LoadStringStatus.TextColor3 = Color3.fromRGB(180, 180, 180)
        end
    end)
end

LoadStringBox:GetPropertyChangedSignal("Text"):Connect(SaveCodeAutomatically)

local UIConfigSection = CreateSection("‚öôÔ∏è UI Configuration", UDim2.new(0, 0, 0, 1365), 120)

local KeybindButton = CreateButton(UIConfigSection, UDim2.new(1, -20, 0, 36), UDim2.new(0.5, 0, 0, 58), "Toggle Keybind: G")

local KeybindStatus = Instance.new("TextLabel", UIConfigSection)
KeybindStatus.Size = UDim2.new(1, -20, 0, 24)
KeybindStatus.Position = UDim2.new(0, 10, 0, 82)
KeybindStatus.BackgroundTransparency = 1
KeybindStatus.Text = "Click button above to change keybind"
KeybindStatus.Font = Enum.Font.Gotham
KeybindStatus.TextSize = 11
KeybindStatus.TextColor3 = Color3.fromRGB(150, 150, 150)
KeybindStatus.TextXAlignment = Enum.TextXAlignment.Center

local function UpdateSlider(fill, valueBox, labelElement, value, min, max, format)
    local percentage = (value - min) / (max - min)
    TweenService:Create(fill, TweenPresets.Fast, {Size = UDim2.new(percentage, 0, 1, 0)}):Play()
    valueBox.Text = string.format(format, value)
    if labelElement then
        local labelBase = labelElement.Text:match("(.+):")
        labelElement.Text = labelBase .. ": " .. string.format(format, value) .. (labelElement.Text:match("s$") and "s" or "")
    end
end

local function UpdateJumpSlider(percentage)
    Config.JumpDelay = 5 + (percentage * 25)
    UpdateSlider(JumpSliderFill, JumpDelayBox, JumpDelayLabel, Config.JumpDelay, 5, 30, "%.1f")
    SaveConfig()
end

local function UpdateClickSlider(percentage)
    Config.ClickDelay = 1 + (percentage * 9)
    UpdateSlider(ClickSliderFill, ClickDelayBox, ClickDelayLabel, Config.ClickDelay, 1, 10, "%.1f")
    SaveConfig()
end

local function UpdateSpamSlider(percentage)
    Config.SpamDelay = 0.05 + (percentage * 4.95)
    UpdateSlider(SpamSliderFill, SpamDelayBox, SpamDelayLabel, Config.SpamDelay, 0.05, 5, "%.2f")
    SaveConfig()
end

local function UpdateFPSSlider(percentage)
    Config.TargetFPS = math.floor(15 + (percentage * 345))
    UpdateSlider(FPSFill, FPSValueBox, FPSValueLabel, Config.TargetFPS, 15, 360, "%d")
    if Config.FPSUnlockEnabled and FPS_SUPPORTED then
        setfpscap(Config.TargetFPS)
        FPSUnlockStatus.Text = "Your target: " .. Config.TargetFPS .. " FPS"
    end
    SaveConfig()
end

JumpDelayBox.FocusLost:Connect(function()
    local value = math.clamp(tonumber(JumpDelayBox.Text) or Config.JumpDelay, 5, 30)
    Config.JumpDelay = value
    UpdateJumpSlider((value - 5) / 25)
end)

ClickDelayBox.FocusLost:Connect(function()
    local value = math.clamp(tonumber(ClickDelayBox.Text) or Config.ClickDelay, 1, 10)
    Config.ClickDelay = value
    UpdateClickSlider((value - 1) / 9)
end)

SpamDelayBox.FocusLost:Connect(function()
    local value = math.clamp(tonumber(SpamDelayBox.Text) or Config.SpamDelay, 0.05, 5)
    Config.SpamDelay = value
    UpdateSpamSlider((value - 0.05) / 4.95)
end)

FPSValueBox.FocusLost:Connect(function()
    local value = math.clamp(tonumber(FPSValueBox.Text) or Config.TargetFPS, 15, 360)
    Config.TargetFPS = value
    UpdateFPSSlider((value - 15) / 345)
end)

SpamInput.FocusLost:Connect(function()
    Config.SpamKey = SpamInput.Text:upper()
    SaveConfig()
end)

local dragging = {jump = false, click = false, spam = false, fps = false}

JumpSliderButton.MouseButton1Down:Connect(function()
    dragging.jump = true
end)

ClickSliderButton.MouseButton1Down:Connect(function()
    dragging.click = true
end)

SpamSliderButton.MouseButton1Down:Connect(function()
    dragging.spam = true
end)

FPSButton.MouseButton1Down:Connect(function()
    dragging.fps = true
end)

UserInputService.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging.jump, dragging.click, dragging.spam, dragging.fps = false, false, false, false
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement then
        local mouseX = UserInputService:GetMouseLocation().X
        if dragging.jump then
            UpdateJumpSlider(math.clamp((mouseX - JumpDelaySlider.AbsolutePosition.X) / JumpDelaySlider.AbsoluteSize.X, 0, 1))
        elseif dragging.click then
            UpdateClickSlider(math.clamp((mouseX - ClickDelaySlider.AbsolutePosition.X) / ClickDelaySlider.AbsoluteSize.X, 0, 1))
        elseif dragging.spam then
            UpdateSpamSlider(math.clamp((mouseX - SpamDelaySlider.AbsolutePosition.X) / SpamDelaySlider.AbsoluteSize.X, 0, 1))
        elseif dragging.fps then
            UpdateFPSSlider(math.clamp((mouseX - FPSSlider.AbsolutePosition.X) / FPSSlider.AbsoluteSize.X, 0, 1))
        end
    end
end)

local function CleanupAllThreads()
    for threadType, thread in pairs(ActiveThreads) do
        if thread then
            if coroutine.status(thread) ~= "dead" then
                task.cancel(thread)
            end
            ActiveThreads[threadType] = nil
        end
    end
end

local function StopThread(threadType)
    if ActiveThreads[threadType] then
        local thread = ActiveThreads[threadType]
        ActiveThreads[threadType] = nil
        if coroutine.status(thread) ~= "dead" then
            task.cancel(thread)
        end
    end
end

local function StopJumpThread()
    StopThread("Jump")
end

local function StopClickThread()
    StopThread("Click")
end

local function StopSpamThread()
    StopThread("Spam")
end

local function StartJumpThread()
    StopJumpThread()
    ActiveThreads.Jump = task.spawn(function()
        while Config.JumpEnabled do
            task.wait(Config.JumpDelay)
            if Config.JumpEnabled and LocalPlayer.Character then
                local humanoid = LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
                if humanoid then
                    humanoid:ChangeState(Enum.HumanoidStateType.Jumping)
                end
            end
        end
        ActiveThreads.Jump = nil
    end)
end

local function StartClickThread()
    StopClickThread()
    ActiveThreads.Click = task.spawn(function()
        while Config.ClickEnabled do
            task.wait(Config.ClickDelay)
            if Config.ClickEnabled then
                local x, y
                if Config.ClickType == "Current" then
                    local mousePos = UserInputService:GetMouseLocation()
                    x, y = mousePos.X, mousePos.Y
                elseif Config.ClickType == "Center" then
                    local viewport = workspace.CurrentCamera.ViewportSize
                    x, y = viewport.X/2, viewport.Y/2
                else
                    local viewport = workspace.CurrentCamera.ViewportSize
                    x, y = math.random(100, viewport.X - 100), math.random(100, viewport.Y - 100)
                end
                VirtualInputManager:SendMouseButtonEvent(x, y, 0, true, game, 0)
                task.wait(0.05)
                VirtualInputManager:SendMouseButtonEvent(x, y, 0, false, game, 0)
            end
        end
        ActiveThreads.Click = nil
    end)
end

local function StartSpamThread()
    StopSpamThread()
    local keyText = SpamInput.Text:upper()
    local keyCode = KeyCodeMap[keyText]
    if not keyCode then return end
    
    ActiveThreads.Spam = task.spawn(function()
        while Config.AutoSpamEnabled do
            task.wait(Config.SpamDelay)
            if Config.AutoSpamEnabled then
                VirtualInputManager:SendKeyEvent(true, keyCode, false, game)
                task.wait(0.05)
                VirtualInputManager:SendKeyEvent(false, keyCode, false, game)
            end
        end
        ActiveThreads.Spam = nil
    end)
end

local function UpdateAntiAFKStatus()
    if Config.JumpEnabled and Config.ClickEnabled then
        AntiAFKStatus.Text = "Status: Jump & Click Active"
        AntiAFKStatus.TextColor3 = Color3.fromRGB(50, 220, 100)
    elseif Config.JumpEnabled then
        AntiAFKStatus.Text = "Status: Jump Active"
        AntiAFKStatus.TextColor3 = Color3.fromRGB(100, 200, 255)
    elseif Config.ClickEnabled then
        AntiAFKStatus.Text = "Status: Click Active"
        AntiAFKStatus.TextColor3 = Color3.fromRGB(255, 200, 100)
    else
        AntiAFKStatus.Text = "Status: All Inactive"
        AntiAFKStatus.TextColor3 = Color3.fromRGB(180, 180, 180)
    end
end

local function UpdateClickTypeButtons()
    local buttons = {Current = ClickTypeCurrent, Center = ClickTypeCenter, Random = ClickTypeRandom}
    for type, btn in pairs(buttons) do
        TweenService:Create(btn, TweenPresets.Fast, {
            BackgroundColor3 = (Config.ClickType == type) and Color3.fromRGB(100, 150, 255) or Color3.fromRGB(45, 45, 52)
        }):Play()
    end
end

local function ToggleFPSUnlock()
    if not SetDebounce("FPS", 0.3) then return end
    if not FPS_SUPPORTED then
        FPSUnlockStatus.Text = "FPS Unlock not supported"
        FPSUnlockStatus.TextColor3 = Color3.fromRGB(220, 50, 50)
        return
    end
    
    Config.FPSUnlockEnabled = not Config.FPSUnlockEnabled
    TweenService:Create(FPSUnlockToggle, TweenPresets.Medium, {
        BackgroundColor3 = Config.FPSUnlockEnabled and Color3.fromRGB(50, 220, 100) or Color3.fromRGB(220, 50, 50)
    }):Play()
    
    FPSUnlockToggle.Text = "FPS Unlock: " .. (Config.FPSUnlockEnabled and "ON" or "OFF")
    if Config.FPSUnlockEnabled then
        setfpscap(Config.TargetFPS)
        FPSUnlockStatus.Text = "Your target: " .. Config.TargetFPS .. " FPS"
        FPSUnlockStatus.TextColor3 = Color3.fromRGB(50, 220, 100)
    else
        setfpscap(60)
        FPSUnlockStatus.Text = "Default FPS"
        FPSUnlockStatus.TextColor3 = Color3.fromRGB(180, 180, 180)
    end
    SaveConfig()
end

local teleporting = false

local function SetupAutoRejoin()
    if Config.AutoRejoinEnabled then
        local PromptGui = CoreGui:WaitForChild("RobloxPromptGui")
        local PromptOverlay = PromptGui:WaitForChild("promptOverlay")
        PromptOverlay.ChildAdded:Connect(function(child)
            if child.Name == "ErrorPrompt" and Config.AutoRejoinEnabled and not teleporting then
                teleporting = true
                task.spawn(function()
                    while Config.AutoRejoinEnabled and teleporting do
                        TeleportService:Teleport(game.PlaceId, LocalPlayer)
                        task.wait(2)
                    end
                end)
            end
        end)
    end
end

local function ToggleAutoRejoin()
    if not SetDebounce("Rejoin", 0.3) then return end
    Config.AutoRejoinEnabled = not Config.AutoRejoinEnabled
    TweenService:Create(AutoRejoinToggle, TweenPresets.Medium, {
        BackgroundColor3 = Config.AutoRejoinEnabled and Color3.fromRGB(50, 220, 100) or Color3.fromRGB(220, 50, 50)
    }):Play()
    
    AutoRejoinToggle.Text = "Auto Rejoin: " .. (Config.AutoRejoinEnabled and "ON" or "OFF")
    AutoRejoinStatus.Text = "Status: " .. (Config.AutoRejoinEnabled and "Enabled" or "Disabled") .. "\n\nAutomatically rejoins when disconnected"
    AutoRejoinStatus.TextColor3 = Config.AutoRejoinEnabled and Color3.fromRGB(50, 220, 100) or Color3.fromRGB(180, 180, 180)
    
    if Config.AutoRejoinEnabled then
        SetupAutoRejoin()
    else
        teleporting = false
    end
    SaveConfig()
end

local function ExecuteLoadString()
    if not SetDebounce("Execute", 0.5) then return end
    local loadstringText = LoadStringBox.Text
    if loadstringText == "" or loadstringText == nil then
        LoadStringStatus.Text = "Status: Empty loadstring"
        LoadStringStatus.TextColor3 = Color3.fromRGB(255, 200, 100)
        return
    end
    
    LoadStringStatus.Text = "Status: Executing..."
    LoadStringStatus.TextColor3 = Color3.fromRGB(255, 200, 100)
    TweenService:Create(ExecuteButton, TweenPresets.Medium, {BackgroundColor3 = Color3.fromRGB(255, 200, 100)}):Play()
    
    local success, errorMessage = pcall(function()
        local func, err = loadstring(loadstringText)
        if not func then
            error(err)
        end
        func()
    end)
    
    if success then
        LoadStringStatus.Text = "Status: Executed successfully!"
        LoadStringStatus.TextColor3 = Color3.fromRGB(50, 220, 100)
        TweenService:Create(ExecuteButton, TweenPresets.Medium, {BackgroundColor3 = Color3.fromRGB(50, 220, 100)}):Play()
    else
        LoadStringStatus.Text = "Status: Error - " .. tostring(errorMessage):sub(1, 50) .. "..."
        LoadStringStatus.TextColor3 = Color3.fromRGB(220, 50, 50)
        TweenService:Create(ExecuteButton, TweenPresets.Medium, {BackgroundColor3 = Color3.fromRGB(220, 50, 50)}):Play()
        warn("Loadstring Error: " .. tostring(errorMessage))
    end
    
    task.wait(2)
    if LoadStringStatus.Text:match("Error") or LoadStringStatus.Text:match("successfully") then
        LoadStringStatus.Text = "Status: Ready"
        LoadStringStatus.TextColor3 = Color3.fromRGB(180, 180, 180)
        TweenService:Create(ExecuteButton, TweenPresets.Medium, {BackgroundColor3 = Color3.fromRGB(45, 45, 52)}):Play()
    end
end

local function ChangeKeybind()
    if not SetDebounce("Keybind", 0.5) or Config.IsChangingKeybind then return end
    Config.IsChangingKeybind = true
    KeybindButton.Text = "Press any key..."
    KeybindStatus.Text = "Waiting for input..."
    KeybindStatus.TextColor3 = Color3.fromRGB(255, 200, 100)
    
    local connection
    connection = UserInputService.InputBegan:Connect(function(input, gameProcessed)
        if input.UserInputType == Enum.UserInputType.Keyboard and not gameProcessed then
            Config.Keybind = input.KeyCode
            local keyName = KeyCodeNames[input.KeyCode] or input.KeyCode.Name
            KeybindButton.Text = "Toggle Keybind: " .. keyName
            KeybindStatus.Text = "Keybind changed successfully!"
            KeybindStatus.TextColor3 = Color3.fromRGB(50, 220, 100)
            SaveConfig()
            task.wait(1.5)
            if KeybindStatus.Text == "Keybind changed successfully!" then
                KeybindStatus.Text = "Click button above to change keybind"
                KeybindStatus.TextColor3 = Color3.fromRGB(150, 150, 150)
            end
            Config.IsChangingKeybind = false
            connection:Disconnect()
        end
    end)
end

CleanupAllThreads()

KeybindButton.MouseButton1Click:Connect(ChangeKeybind)
AutoRejoinToggle.MouseButton1Click:Connect(ToggleAutoRejoin)
FPSUnlockToggle.MouseButton1Click:Connect(ToggleFPSUnlock)
ExecuteButton.MouseButton1Click:Connect(ExecuteLoadString)

ClickTypeCurrent.MouseButton1Click:Connect(function()
    if not SetDebounce("Click", 0.2) then return end
    Config.ClickType = "Current"
    UpdateClickTypeButtons()
    SaveConfig()
end)

ClickTypeCenter.MouseButton1Click:Connect(function()
    if not SetDebounce("Click", 0.2) then return end
    Config.ClickType = "Center"
    UpdateClickTypeButtons()
    SaveConfig()
end)

ClickTypeRandom.MouseButton1Click:Connect(function()
    if not SetDebounce("Click", 0.2) then return end
    Config.ClickType = "Random"
    UpdateClickTypeButtons()
    SaveConfig()
end)

JumpToggle.MouseButton1Click:Connect(function()
    if not SetDebounce("Jump", 0.3) then return end
    Config.JumpEnabled = not Config.JumpEnabled
    TweenService:Create(JumpToggle, TweenPresets.Medium, {
        BackgroundColor3 = Config.JumpEnabled and Color3.fromRGB(50, 220, 100) or Color3.fromRGB(220, 50, 50)
    }):Play()
    
    JumpToggle.Text = "Auto Jump: " .. (Config.JumpEnabled and "ON" or "OFF")
    if Config.JumpEnabled then
        task.wait(0.05)
        StartJumpThread()
    else
        StopJumpThread()
    end
    UpdateAntiAFKStatus()
    SaveConfig()
end)

ClickToggle.MouseButton1Click:Connect(function()
    if not SetDebounce("Click", 0.3) then return end
    Config.ClickEnabled = not Config.ClickEnabled
    TweenService:Create(ClickToggle, TweenPresets.Medium, {
        BackgroundColor3 = Config.ClickEnabled and Color3.fromRGB(50, 220, 100) or Color3.fromRGB(220, 50, 50)
    }):Play()
    
    ClickToggle.Text = "Auto Click: " .. (Config.ClickEnabled and "ON" or "OFF")
    if Config.ClickEnabled then
        task.wait(0.05)
        StartClickThread()
    else
        StopClickThread()
    end
    UpdateAntiAFKStatus()
    SaveConfig()
end)

AutoSpamToggle.MouseButton1Click:Connect(function()
    if not SetDebounce("Spam", 0.3) then return end
    Config.AutoSpamEnabled = not Config.AutoSpamEnabled
    if Config.AutoSpamEnabled then
        local keyText = SpamInput.Text:upper()
        local keyCode = KeyCodeMap[keyText]
        if not keyCode then
            Config.AutoSpamEnabled = false
            AutoSpamStatus.Text = "Status: Invalid key"
            AutoSpamStatus.TextColor3 = Color3.fromRGB(220, 50, 50)
            return
        end
        
        if keyCode == Enum.KeyCode.P or keyCode == Enum.KeyCode.G then
            Config.AutoSpamEnabled = false
            AutoSpamStatus.Text = "Status: Key reserved"
            AutoSpamStatus.TextColor3 = Color3.fromRGB(220, 50, 50)
            return
        end
        
        Config.SpamKey = keyText
        TweenService:Create(AutoSpamToggle, TweenPresets.Medium, {BackgroundColor3 = Color3.fromRGB(50, 220, 100)}):Play()
        AutoSpamToggle.Text = "ON"
        AutoSpamStatus.Text = "Status: Spamming " .. keyText
        AutoSpamStatus.TextColor3 = Color3.fromRGB(50, 220, 100)
        task.wait(0.05)
        StartSpamThread()
    else
        TweenService:Create(AutoSpamToggle, TweenPresets.Medium, {BackgroundColor3 = Color3.fromRGB(220, 50, 50)}):Play()
        AutoSpamToggle.Text = "OFF"
        AutoSpamStatus.Text = "Status: Inactive"
        AutoSpamStatus.TextColor3 = Color3.fromRGB(180, 180, 180)
        StopSpamThread()
    end
    SaveConfig()
end)

local function ToggleUI()
    if not SetDebounce("UI", 0.8) then return end
    if MainFrame.Visible then
        TweenService:Create(MainFrame, TweenPresets.BackIn, {
            Size = UDim2.new(0, 0, 0, 0),
            Position = UDim2.new(0.5, 0, 0.5, 0)
        }):Play()
        task.wait(0.45)
        MainFrame.Visible = false
        ReopenButton.Visible = true
        ReopenButton.Size = UDim2.new(0, 0, 0, 0)
        ReopenButton.Position = UDim2.new(0.5, 0, 0, 30)
        TweenService:Create(ReopenButton, TweenPresets.Back, {
            Size = UDim2.new(0, 60, 0, 60),
            Position = UDim2.new(0.5, -30, 0, 30)
        }):Play()
    else
        TweenService:Create(ReopenButton, TweenPresets.BackIn, {
            Size = UDim2.new(0, 0, 0, 0),
            Position = UDim2.new(0.5, 0, 0, 30)
        }):Play()
        task.wait(0.35)
        ReopenButton.Visible = false
        MainFrame.Visible = true
        MainFrame.Size = UDim2.new(0, 0, 0, 0)
        MainFrame.Position = UDim2.new(0.5, 0, 0.5, 0)
        TweenService:Create(MainFrame, TweenPresets.Back, {
            Size = UDim2.new(0, 500, 0, 650),
            Position = UDim2.new(0.5, -250, 0.5, -325)
        }):Play()
    end
end

local closeButtonOriginalSize = UDim2.new(0, 30, 0, 30)
local closeButtonOriginalPos = UDim2.new(1, -40, 0.5, -15)
local closeButtonIsHovering = false

CloseButton.AnchorPoint = Vector2.new(0.5, 0.5)
CloseButton.MouseEnter:Connect(function()
    closeButtonIsHovering = true
    TweenService:Create(CloseButton, TweenPresets.Fast, {
        Size = UDim2.new(0, 36, 0, 34),
        BackgroundColor3 = Color3.fromRGB(255, 70, 70)
    }):Play()
end)

CloseButton.MouseLeave:Connect(function()
    closeButtonIsHovering = false
    TweenService:Create(CloseButton, TweenPresets.Fast, {
        Size = closeButtonOriginalSize,
        BackgroundColor3 = Color3.fromRGB(220, 50, 50)
    }):Play()
end)

CloseButton.MouseButton1Down:Connect(function()
    if closeButtonIsHovering then
        TweenService:Create(CloseButton, TweenInfo.new(0.1, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
            Size = UDim2.new(0, 26, 0, 27)
        }):Play()
    end
end)

CloseButton.MouseButton1Up:Connect(function()
    if closeButtonIsHovering then
        TweenService:Create(CloseButton, TweenPresets.Fast, {
            Size = UDim2.new(0, 36, 0, 34)
        }):Play()
    else
        TweenService:Create(CloseButton, TweenPresets.Fast, {
            Size = closeButtonOriginalSize
        }):Play()
    end
end)

CloseButton.MouseButton1Click:Connect(ToggleUI)
ReopenButton.MouseButton1Click:Connect(ToggleUI)

ReopenButton.MouseEnter:Connect(function()
    TweenService:Create(ReopenButton, TweenPresets.Medium, {
        Size = UDim2.new(0, 70, 0, 70),
        Position = UDim2.new(0.5, -35, 0, 25)
    }):Play()
end)

ReopenButton.MouseLeave:Connect(function()
    TweenService:Create(ReopenButton, TweenPresets.Medium, {
        Size = UDim2.new(0, 60, 0, 60),
        Position = UDim2.new(0.5, -30, 0, 30)
    }):Play()
end)

UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if not gameProcessed and input.KeyCode == Config.Keybind and not Config.IsChangingKeybind then
        ToggleUI()
    end
end)

local lastTime, frameCount, currentFPS = tick(), 0, 60
local updateInterval = 1

RunService.RenderStepped:Connect(function()
    frameCount = frameCount + 1
    local currentTime = tick()
    if currentTime - lastTime >= updateInterval then
        currentFPS = math.floor(frameCount / (currentTime - lastTime))
        frameCount = 0
        lastTime = currentTime
        FPSLabel.Text = "FPS: " .. currentFPS
        UpdateFPSStats(currentFPS)
    end
    
    if frameCount % 30 == 0 then
        local ping = math.floor(LocalPlayer:GetNetworkPing() * 1000)
        PingLabel.Text = "Ping: " .. ping .. " ms"
        UpdatePingStats(ping)
        if ping < 100 then
            PingLabel.TextColor3 = Color3.fromRGB(0, 255, 0)
        elseif ping < 200 then
            PingLabel.TextColor3 = Color3.fromRGB(255, 255, 0)
        else
            PingLabel.TextColor3 = Color3.fromRGB(255, 0, 0)
        end
    end
end)

task.spawn(function()
    pcall(function()
        PlayerImage.Image = "rbxthumb://type=AvatarHeadShot&id=" .. LocalPlayer.UserId .. "&w=420&h=420"
        local gameInfo = MarketplaceService:GetProductInfo(game.PlaceId)
        GameName.Text = gameInfo.Name
        if gameInfo.IconImageAssetId and gameInfo.IconImageAssetId ~= 0 then
            GameImage.Image = "rbxthumb://type=Asset&id=" .. gameInfo.IconImageAssetId .. "&w=420&h=420"
        end
    end)
end)

ScreenGui.Destroying:Connect(function()
    CleanupAllThreads()
end)

local configLoaded = LoadConfig()

if configLoaded then
    local keyName = KeyCodeNames[Config.Keybind] or Config.Keybind.Name
    KeybindButton.Text = "Toggle Keybind: " .. keyName
    SpamInput.Text = Config.SpamKey
    LoadStringBox.Text = Config.SavedCode
    
    UpdateJumpSlider((Config.JumpDelay - 5) / 25)
    UpdateClickSlider((Config.ClickDelay - 1) / 9)
    UpdateSpamSlider((Config.SpamDelay - 0.05) / 4.95)
    UpdateFPSSlider((Config.TargetFPS - 15) / 345)
    UpdateClickTypeButtons()
    
    if Config.AutoRejoinEnabled then
        AutoRejoinToggle.BackgroundColor3 = Color3.fromRGB(50, 220, 100)
        AutoRejoinToggle.Text = "Auto Rejoin: ON"
        AutoRejoinStatus.Text = "Status: Enabled\n\nAutomatically rejoins when disconnected"
        AutoRejoinStatus.TextColor3 = Color3.fromRGB(50, 220, 100)
        SetupAutoRejoin()
    else
        AutoRejoinToggle.BackgroundColor3 = Color3.fromRGB(220, 50, 50)
        AutoRejoinToggle.Text = "Auto Rejoin: OFF"
        AutoRejoinStatus.Text = "Status: Disabled\n\nAutomatically rejoins when disconnected"
        AutoRejoinStatus.TextColor3 = Color3.fromRGB(180, 180, 180)
    end
    
    if Config.FPSUnlockEnabled and FPS_SUPPORTED then
        FPSUnlockToggle.BackgroundColor3 = Color3.fromRGB(50, 220, 100)
        FPSUnlockToggle.Text = "FPS Unlock: ON"
        FPSUnlockStatus.TextColor3 = Color3.fromRGB(50, 220, 100)
        FPSUnlockStatus.Text = "Your target: " .. Config.TargetFPS .. " FPS"
        setfpscap(Config.TargetFPS)
    else
        FPSUnlockToggle.BackgroundColor3 = Color3.fromRGB(220, 50, 50)
        FPSUnlockToggle.Text = "FPS Unlock: OFF"
        FPSUnlockStatus.TextColor3 = Color3.fromRGB(180, 180, 180)
        FPSUnlockStatus.Text = "Default FPS"
    end
    
    StopJumpThread()
    StopClickThread()
    StopSpamThread()
    
    if Config.JumpEnabled then
        task.wait(0.1)
        JumpToggle.BackgroundColor3 = Color3.fromRGB(50, 220, 100)
        JumpToggle.Text = "Auto Jump: ON"
        StartJumpThread()
    else
        JumpToggle.BackgroundColor3 = Color3.fromRGB(220, 50, 50)
        JumpToggle.Text = "Auto Jump: OFF"
    end
    
    if Config.ClickEnabled then
        task.wait(0.1)
        ClickToggle.BackgroundColor3 = Color3.fromRGB(50, 220, 100)
        ClickToggle.Text = "Auto Click: ON"
        StartClickThread()
    else
        ClickToggle.BackgroundColor3 = Color3.fromRGB(220, 50, 50)
        ClickToggle.Text = "Auto Click: OFF"
    end
    
    if Config.AutoSpamEnabled then
        local keyCode = KeyCodeMap[Config.SpamKey]
        if keyCode then
            task.wait(0.1)
            AutoSpamToggle.BackgroundColor3 = Color3.fromRGB(50, 220, 100)
            AutoSpamToggle.Text = "ON"
            AutoSpamStatus.Text = "Status: Spamming " .. Config.SpamKey
            AutoSpamStatus.TextColor3 = Color3.fromRGB(50, 220, 100)
            StartSpamThread()
        else
            Config.AutoSpamEnabled = false
            AutoSpamToggle.BackgroundColor3 = Color3.fromRGB(220, 50, 50)
            AutoSpamToggle.Text = "OFF"
            AutoSpamStatus.Text = "Status: Inactive"
            AutoSpamStatus.TextColor3 = Color3.fromRGB(180, 180, 180)
        end
    else
        AutoSpamToggle.BackgroundColor3 = Color3.fromRGB(220, 50, 50)
        AutoSpamToggle.Text = "OFF"
        AutoSpamStatus.Text = "Status: Inactive"
        AutoSpamStatus.TextColor3 = Color3.fromRGB(180, 180, 180)
    end
    
    UpdateAntiAFKStatus()
else
    UpdateJumpSlider(0.2)
    UpdateClickSlider(0.22)
    UpdateSpamSlider(0.01)
    UpdateFPSSlider(0.13)
    UpdateClickTypeButtons()
    
    JumpToggle.BackgroundColor3 = Color3.fromRGB(220, 50, 50)
    JumpToggle.Text = "Auto Jump: OFF"
    
    ClickToggle.BackgroundColor3 = Color3.fromRGB(220, 50, 50)
    ClickToggle.Text = "Auto Click: OFF"
    
    AutoSpamToggle.BackgroundColor3 = Color3.fromRGB(220, 50, 50)
    AutoSpamToggle.Text = "OFF"
    AutoSpamStatus.Text = "Status: Inactive"
    AutoSpamStatus.TextColor3 = Color3.fromRGB(180, 180, 180)
    
    FPSUnlockToggle.BackgroundColor3 = Color3.fromRGB(220, 50, 50)
    FPSUnlockToggle.Text = "FPS Unlock: OFF"
    FPSUnlockStatus.TextColor3 = Color3.fromRGB(180, 180, 180)
    FPSUnlockStatus.Text = "Default FPS"
    
    AutoRejoinToggle.BackgroundColor3 = Color3.fromRGB(220, 50, 50)
    AutoRejoinToggle.Text = "Auto Rejoin: OFF"
    AutoRejoinStatus.TextColor3 = Color3.fromRGB(180, 180, 180)
end

MainFrame.Visible = true
MainFrame.Size = UDim2.new(0, 0, 0, 0)
MainFrame.Position = UDim2.new(0.5, 0, 0.5, 0)
ReopenButton.Visible = false

TweenService:Create(MainFrame, TweenInfo.new(0.8, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
    Size = UDim2.new(0, 500, 0, 650),
    Position = UDim2.new(0.5, -250, 0.5, -325)
}):Play()
