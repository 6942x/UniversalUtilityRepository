local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")

local Interactions = {}

local ButtonStates = {}
local TweenPresets = {
    Fast = TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
    Medium = TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
    Back = TweenInfo.new(0.6, Enum.EasingStyle.Back, Enum.EasingDirection.Out),
    BackIn = TweenInfo.new(0.4, Enum.EasingStyle.Back, Enum.EasingDirection.In)
}

function Interactions.SetupButtonHover(button, size)
    local originalSize = size
    local isHovering = false
    
    ButtonStates[button] = {
        OriginalSize = originalSize,
        IsHovering = false
    }

    button.MouseEnter:Connect(function()
        isHovering = true
        ButtonStates[button].IsHovering = true
        TweenService:Create(button, TweenPresets.Fast, {
            Size = UDim2.new(originalSize.X.Scale, originalSize.X.Offset + 6, originalSize.Y.Scale, originalSize.Y.Offset + 4)
        }):Play()
    end)

    button.MouseLeave:Connect(function()
        isHovering = false
        ButtonStates[button].IsHovering = false
        local currentColor = button.BackgroundColor3
        TweenService:Create(button, TweenPresets.Fast, {
            Size = originalSize,
            BackgroundColor3 = currentColor
        }):Play()
    end)

    button.MouseButton1Down:Connect(function()
        if isHovering then
            TweenService:Create(button, TweenInfo.new(0.1, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
                Size = UDim2.new(originalSize.X.Scale, originalSize.X.Offset - 4, originalSize.Y.Scale, originalSize.Y.Offset - 3)
            }):Play()
        end
    end)

    button.MouseButton1Up:Connect(function()
        if isHovering then
            TweenService:Create(button, TweenPresets.Fast, {
                Size = UDim2.new(originalSize.X.Scale, originalSize.X.Offset + 6, originalSize.Y.Scale, originalSize.Y.Offset + 4)
            }):Play()
        else
            TweenService:Create(button, TweenPresets.Fast, {
                Size = originalSize
            }):Play()
        end
    end)
end

function Interactions.SetupCloseButtonHover(closeButton)
    closeButton.MouseEnter:Connect(function()
        TweenService:Create(closeButton, TweenPresets.Fast, {
            BackgroundColor3 = Color3.fromRGB(240, 70, 70),
            Size = UDim2.new(0, 32, 0, 32)
        }):Play()
    end)

    closeButton.MouseLeave:Connect(function()
        TweenService:Create(closeButton, TweenPresets.Fast, {
            BackgroundColor3 = Color3.fromRGB(220, 50, 50),
            Size = UDim2.new(0, 30, 0, 30)
        }):Play()
    end)

    closeButton.MouseButton1Down:Connect(function()
        TweenService:Create(closeButton, TweenInfo.new(0.1, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
            Size = UDim2.new(0, 28, 0, 28)
        }):Play()
    end)

    closeButton.MouseButton1Up:Connect(function()
        TweenService:Create(closeButton, TweenPresets.Fast, {
            Size = UDim2.new(0, 30, 0, 30)
        }):Play()
    end)
end

function Interactions.SetupReopenButtonHover(reopenButton)
    reopenButton.MouseEnter:Connect(function()
        TweenService:Create(reopenButton, TweenPresets.Medium, {
            Size = UDim2.new(0, 70, 0, 70),
            Position = UDim2.new(0.5, -35, 0, 25)
        }):Play()
    end)

    reopenButton.MouseLeave:Connect(function()
        TweenService:Create(reopenButton, TweenPresets.Medium, {
            Size = UDim2.new(0, 60, 0, 60),
            Position = UDim2.new(0.5, -30, 0, 30)
        }):Play()
    end)
end

function Interactions.SetupSliderDragging(sliderButton, onUpdate)
    local dragging = false
    
    sliderButton.MouseButton1Down:Connect(function()
        dragging = true
    end)
    
    UserInputService.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = false
        end
    end)
    
    UserInputService.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement and dragging then
            local mouseX = UserInputService:GetMouseLocation().X
            local slider = sliderButton.Parent
            local percentage = math.clamp((mouseX - slider.AbsolutePosition.X) / slider.AbsoluteSize.X, 0, 1)
            onUpdate(percentage)
        end
    end)
    
    return function() return dragging end
end

function Interactions.ToggleUI(mainFrame, reopenButton, setDebounce)
    if not setDebounce("UI", 0.8) then return end
    
    if mainFrame.Visible then
        TweenService:Create(mainFrame, TweenPresets.BackIn, {
            Size = UDim2.new(0, 0, 0, 0),
            Position = UDim2.new(0.5, 0, 0.5, 0)
        }):Play()
        task.wait(0.45)
        mainFrame.Visible = false
        reopenButton.Visible = true
        reopenButton.Size = UDim2.new(0, 0, 0, 0)
        reopenButton.Position = UDim2.new(0.5, 0, 0, 30)
        TweenService:Create(reopenButton, TweenPresets.Back, {
            Size = UDim2.new(0, 60, 0, 60),
            Position = UDim2.new(0.5, -30, 0, 30)
        }):Play()
    else
        TweenService:Create(reopenButton, TweenPresets.BackIn, {
            Size = UDim2.new(0, 0, 0, 0),
            Position = UDim2.new(0.5, 0, 0, 30)
        }):Play()
        task.wait(0.35)
        reopenButton.Visible = false
        mainFrame.Visible = true
        mainFrame.Size = UDim2.new(0, 0, 0, 0)
        mainFrame.Position = UDim2.new(0.5, 0, 0.5, 0)
        TweenService:Create(mainFrame, TweenPresets.Back, {
            Size = UDim2.new(0, 650, 0, 500),
            Position = UDim2.new(0.5, -325, 0.5, -250)
        }):Play()
    end
end

function Interactions.AnimateUIOpen(mainFrame)
    mainFrame.Visible = true
    mainFrame.Size = UDim2.new(0, 0, 0, 0)
    mainFrame.Position = UDim2.new(0.5, 0, 0.5, 0)
    
    TweenService:Create(mainFrame, TweenInfo.new(0.8, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
        Size = UDim2.new(0, 650, 0, 500),
        Position = UDim2.new(0.5, -325, 0.5, -250)
    }):Play()
end

return Interactions
