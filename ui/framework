local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local CoreGui = game:GetService("CoreGui")
local MarketplaceService = game:GetService("MarketplaceService")

local LocalPlayer = Players.LocalPlayer
local Config = _G.UniversalUtility.Config

_G.UniversalUtility.UI = {}

local oldGui = CoreGui:FindFirstChild("UniversalUtility") or (gethui and gethui():FindFirstChild("UniversalUtility"))
if oldGui then oldGui:Destroy() end

local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "UniversalUtility"
ScreenGui.ResetOnSpawn = false
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

if syn and syn.protect_gui then
    syn.protect_gui(ScreenGui)
    ScreenGui.Parent = CoreGui
elseif gethui then
    ScreenGui.Parent = gethui()
else
    ScreenGui.Parent = CoreGui
end

_G.UniversalUtility.UI.ScreenGui = ScreenGui
_G.UniversalUtility.UI.TweenPresets = {
    Fast = TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
    Medium = TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
    Slow = TweenInfo.new(0.4, Enum.EasingStyle.Quad, Enum.EasingDirection.In),
    Back = TweenInfo.new(0.6, Enum.EasingStyle.Back, Enum.EasingDirection.Out),
    BackIn = TweenInfo.new(0.4, Enum.EasingStyle.Back, Enum.EasingDirection.In)
}

local MainFrame = Instance.new("Frame", ScreenGui)
MainFrame.Name = "MainFrame"
MainFrame.Size = UDim2.new(0, 0, 0, 0)
MainFrame.Position = UDim2.new(0.5, 0, 0.5, 0)
MainFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 30)
MainFrame.BorderSizePixel = 0
MainFrame.Active = true
MainFrame.Draggable = true
MainFrame.ClipsDescendants = true
MainFrame.Visible = false

local UICorner = Instance.new("UICorner", MainFrame)
UICorner.CornerRadius = UDim.new(0, 16)

local TopBar = Instance.new("Frame", MainFrame)
TopBar.Name = "TopBar"
TopBar.Size = UDim2.new(1, 0, 0, 40)
TopBar.Position = UDim2.new(0, 0, 0, 5)
TopBar.BackgroundColor3 = Color3.fromRGB(35, 35, 42)
TopBar.BackgroundTransparency = 0
TopBar.BorderSizePixel = 0

local TopBarCorner = Instance.new("UICorner", TopBar)
TopBarCorner.CornerRadius = UDim.new(0, 16)

local Title = Instance.new("TextLabel", TopBar)
Title.Size = UDim2.new(1, -80, 1, 0)
Title.Position = UDim2.new(0, 15, 0, 0)
Title.BackgroundTransparency = 1
Title.Text = "⚡ Universal Utility"
Title.Font = Enum.Font.GothamBold
Title.TextSize = 24
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.TextXAlignment = Enum.TextXAlignment.Left

local CloseButton = Instance.new("ImageButton", TopBar)
CloseButton.Size = UDim2.new(0, 30, 0, 30)
CloseButton.Position = UDim2.new(1, -40, 0.48, 0)
CloseButton.AnchorPoint = Vector2.new(0, 0.5)
CloseButton.BackgroundColor3 = Color3.fromRGB(220, 50, 50)
CloseButton.BorderSizePixel = 0
CloseButton.Image = "rbxassetid://3926305904"
CloseButton.ImageRectOffset = Vector2.new(284, 4)
CloseButton.ImageRectSize = Vector2.new(24, 24)
CloseButton.ImageColor3 = Color3.fromRGB(255, 255, 255)

local CloseButtonCorner = Instance.new("UICorner", CloseButton)
CloseButtonCorner.CornerRadius = UDim.new(0, 8)

local SideNav = Instance.new("Frame", MainFrame)
SideNav.Name = "SideNav"
SideNav.Size = UDim2.new(0, 180, 1, -57)
SideNav.Position = UDim2.new(0, 2.5, 0, 50)
SideNav.BackgroundColor3 = Color3.fromRGB(30, 30, 35)
SideNav.BorderSizePixel = 0

local SideNavCorner = Instance.new("UICorner", SideNav)
SideNavCorner.CornerRadius = UDim.new(0, 12)

local ContentFrame = Instance.new("Frame", MainFrame)
ContentFrame.Name = "ContentFrame"
ContentFrame.Size = UDim2.new(1, -180, 1, -40)
ContentFrame.Position = UDim2.new(0, 180, 0, 45)
ContentFrame.BackgroundTransparency = 1
ContentFrame.BorderSizePixel = 0
ContentFrame.ClipsDescendants = true

local ReopenButton = Instance.new("ImageButton", ScreenGui)
ReopenButton.Name = "ReopenButton"
ReopenButton.Size = UDim2.new(0, 0, 0, 0)
ReopenButton.Position = UDim2.new(0.5, 0, 0, 30)
ReopenButton.BackgroundColor3 = Color3.fromRGB(100, 150, 255)
ReopenButton.BorderSizePixel = 0
ReopenButton.Visible = false
ReopenButton.ZIndex = 10

local ReopenCorner = Instance.new("UICorner", ReopenButton)
ReopenCorner.CornerRadius = UDim.new(1, 0)

local ReopenIcon = Instance.new("TextLabel", ReopenButton)
ReopenIcon.Size = UDim2.new(1, 0, 1, 0)
ReopenIcon.BackgroundTransparency = 1
ReopenIcon.Text = "⚡"
ReopenIcon.Font = Enum.Font.GothamBold
ReopenIcon.TextSize = 24
ReopenIcon.TextColor3 = Color3.fromRGB(255, 255, 255)

_G.UniversalUtility.UI.MainFrame = MainFrame
_G.UniversalUtility.UI.ContentFrame = ContentFrame
_G.UniversalUtility.UI.SideNav = SideNav
_G.UniversalUtility.UI.CloseButton = CloseButton
_G.UniversalUtility.UI.ReopenButton = ReopenButton
_G.UniversalUtility.UI.TabButtons = {}
_G.UniversalUtility.UI.TabContents = {}

local executor = (identifyexecutor and identifyexecutor()) or 
                 (getexecutorname and getexecutorname()) or 
                 "Unknown Executor"

function _G.UniversalUtility.UI.LoadPlayerInfo()
    task.spawn(function()
        pcall(function()
            if _G.UniversalUtility.UI.PlayerImage then
                _G.UniversalUtility.UI.PlayerImage.Image = "rbxthumb://type=AvatarHeadShot&id=" .. LocalPlayer.UserId .. "&w=420&h=420"
            end
            if _G.UniversalUtility.UI.GameName and _G.UniversalUtility.UI.GameImage then
                local gameInfo = MarketplaceService:GetProductInfo(game.PlaceId)
                _G.UniversalUtility.UI.GameName.Text = gameInfo.Name
                if gameInfo.IconImageAssetId and gameInfo.IconImageAssetId ~= 0 then
                    _G.UniversalUtility.UI.GameImage.Image = "rbxthumb://type=Asset&id=" .. gameInfo.IconImageAssetId .. "&w=420&h=420"
                end
            end
        end)
    end)
end

print("Framework module loaded successfully")
return _G.UniversalUtility.UI
