local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")

local Config = _G.UniversalUtility.Config
local UI = _G.UniversalUtility.UI
local Helpers = _G.UniversalUtility.Helpers
local Tabs = _G.UniversalUtility.Tabs
local Interactions = _G.UniversalUtility.Interactions
local AntiAFK = _G.UniversalUtility.AntiAFK
local KeySpam = _G.UniversalUtility.KeySpam
local Performance = _G.UniversalUtility.Performance
local ScriptLoader = _G.UniversalUtility.ScriptLoader
local AutoRejoin = _G.UniversalUtility.AutoRejoin
local Debounces = _G.UniversalUtility.Debounces
local KeyCodeMap = _G.UniversalUtility.KeyCodeMap
local KeyCodeNames = _G.UniversalUtility.KeyCodeNames

_G.UniversalUtility.Initiator = {}

local function SetDebounce(key, duration)
    if Debounces[key] then return false end
    Debounces[key] = true
    task.delay(duration or 0.3, function() Debounces[key] = false end)
    return true
end

local AntiAFKElements = Tabs.CreateAntiAFKTab()
local KeySpamElements = Tabs.CreateKeySpamTab()
local PerformanceElements = Tabs.CreatePerformanceTab()
local RejoinElements = Tabs.CreateAutoRejoinTab()
local LoaderElements = Tabs.CreateScriptLoaderTab()
local SettingsElements = Tabs.CreateSettingsTab()

local function UpdateAntiAFKStatus()
    if Config.JumpEnabled and Config.ClickEnabled then
        AntiAFKElements.Status.Text = "Status: Jump & Click Active"
        AntiAFKElements.Status.TextColor3 = Color3.fromRGB(50, 220, 100)
    elseif Config.JumpEnabled then
        AntiAFKElements.Status.Text = "Status: Jump Active"
        AntiAFKElements.Status.TextColor3 = Color3.fromRGB(100, 200, 255)
    elseif Config.ClickEnabled then
        AntiAFKElements.Status.Text = "Status: Click Active"
        AntiAFKElements.Status.TextColor3 = Color3.fromRGB(255, 200, 100)
    else
        AntiAFKElements.Status.Text = "Status: All Inactive"
        AntiAFKElements.Status.TextColor3 = Color3.fromRGB(180, 180, 180)
    end
end

local function UpdateClickTypeButtons()
    local buttons = {
        Current = AntiAFKElements.ClickTypeCurrent,
        Center = AntiAFKElements.ClickTypeCenter,
        Random = AntiAFKElements.ClickTypeRandom
    }
    for type, btn in pairs(buttons) do
        TweenService:Create(btn, UI.TweenPresets.Fast, {
            BackgroundColor3 = (Config.ClickType == type) and Color3.fromRGB(100, 150, 255) or Color3.fromRGB(45, 45, 52)
        }):Play()
    end
end

local dragging = {jump = false, click = false, spam = false, fps = false}

AntiAFKElements.JumpSliderButton.MouseButton1Down:Connect(function()
    dragging.jump = true
end)

AntiAFKElements.ClickSliderButton.MouseButton1Down:Connect(function()
    dragging.click = true
end)

KeySpamElements.SpamSliderButton.MouseButton1Down:Connect(function()
    dragging.spam = true
end)

PerformanceElements.FPSButton.MouseButton1Down:Connect(function()
    dragging.fps = true
end)

UserInputService.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging.jump, dragging.click, dragging.spam, dragging.fps = false, false, false, false
    end
end)

local function UpdateJumpSlider(percentage)
    Config.JumpDelay = 5 + (percentage * 25)
    Helpers.UpdateSlider(AntiAFKElements.JumpSliderFill, AntiAFKElements.JumpDelayBox, nil, Config.JumpDelay, 5, 30, "%.1f")
    _G.UniversalUtility.SaveConfig()
end

local function UpdateClickSlider(percentage)
    Config.ClickDelay = 1 + (percentage * 9)
    Helpers.UpdateSlider(AntiAFKElements.ClickSliderFill, AntiAFKElements.ClickDelayBox, nil, Config.ClickDelay, 1, 10, "%.1f")
    _G.UniversalUtility.SaveConfig()
end

local function UpdateSpamSlider(percentage)
    Config.SpamDelay = 0.05 + (percentage * 4.95)
    Helpers.UpdateSlider(KeySpamElements.SpamSliderFill, KeySpamElements.SpamDelayBox, nil, Config.SpamDelay, 0.05, 5, "%.2f")
    _G.UniversalUtility.SaveConfig()
end

local function UpdateFPSSlider(percentage)
    Config.TargetFPS = math.floor(15 + (percentage * 345))
    Helpers.UpdateSlider(PerformanceElements.FPSFill, PerformanceElements.FPSValueBox, nil, Config.TargetFPS, 15, 360, "%d")
    if Config.FPSUnlockEnabled and Performance.FPS_SUPPORTED then
        Performance.SetTargetFPS(Config.TargetFPS)
        PerformanceElements.FPSUnlockStatus.Text = "Your target: " .. Config.TargetFPS .. " FPS"
    end
    _G.UniversalUtility.SaveConfig()
end

UserInputService.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement then
        local mouseX = UserInputService:GetMouseLocation().X
        if dragging.jump then
            UpdateJumpSlider(math.clamp((mouseX - AntiAFKElements.JumpDelaySlider.AbsolutePosition.X) / AntiAFKElements.JumpDelaySlider.AbsoluteSize.X, 0, 1))
        elseif dragging.click then
            UpdateClickSlider(math.clamp((mouseX - AntiAFKElements.ClickDelaySlider.AbsolutePosition.X) / AntiAFKElements.ClickDelaySlider.AbsoluteSize.X, 0, 1))
        elseif dragging.spam then
            UpdateSpamSlider(math.clamp((mouseX - KeySpamElements.SpamDelaySlider.AbsolutePosition.X) / KeySpamElements.SpamDelaySlider.AbsoluteSize.X, 0, 1))
        elseif dragging.fps then
            UpdateFPSSlider(math.clamp((mouseX - PerformanceElements.FPSSlider.AbsolutePosition.X) / PerformanceElements.FPSSlider.AbsoluteSize.X, 0, 1))
        end
    end
end)

AntiAFKElements.JumpDelayBox.FocusLost:Connect(function()
    local value = math.clamp(tonumber(AntiAFKElements.JumpDelayBox.Text) or Config.JumpDelay, 5, 30)
    Config.JumpDelay = value
    UpdateJumpSlider((value - 5) / 25)
end)

AntiAFKElements.ClickDelayBox.FocusLost:Connect(function()
    local value = math.clamp(tonumber(AntiAFKElements.ClickDelayBox.Text) or Config.ClickDelay, 1, 10)
    Config.ClickDelay = value
    UpdateClickSlider((value - 1) / 9)
end)

KeySpamElements.SpamDelayBox.FocusLost:Connect(function()
    local value = math.clamp(tonumber(KeySpamElements.SpamDelayBox.Text) or Config.SpamDelay, 0.05, 5)
    Config.SpamDelay = value
    UpdateSpamSlider((value - 0.05) / 4.95)
end)

PerformanceElements.FPSValueBox.FocusLost:Connect(function()
    local value = math.clamp(tonumber(PerformanceElements.FPSValueBox.Text) or Config.TargetFPS, 15, 360)
    Config.TargetFPS = value
    UpdateFPSSlider((value - 15) / 345)
end)

KeySpamElements.SpamInput.FocusLost:Connect(function()
    Config.SpamKey = KeySpamElements.SpamInput.Text:upper()
    _G.UniversalUtility.SaveConfig()
end)

AntiAFKElements.ClickTypeCurrent.MouseButton1Click:Connect(function()
    if not SetDebounce("ClickType", 0.2) then return end
    Config.ClickType = "Current"
    UpdateClickTypeButtons()
    _G.UniversalUtility.SaveConfig()
end)

AntiAFKElements.ClickTypeCenter.MouseButton1Click:Connect(function()
    if not SetDebounce("ClickType", 0.2) then return end
    Config.ClickType = "Center"
    UpdateClickTypeButtons()
    _G.UniversalUtility.SaveConfig()
end)

AntiAFKElements.ClickTypeRandom.MouseButton1Click:Connect(function()
    if not SetDebounce("ClickType", 0.2) then return end
    Config.ClickType = "Random"
    UpdateClickTypeButtons()
    _G.UniversalUtility.SaveConfig()
end)

AntiAFKElements.JumpToggle.MouseButton1Click:Connect(function()
    if not SetDebounce("Jump", 0.3) then return end
    Config.JumpEnabled = not Config.JumpEnabled
    TweenService:Create(AntiAFKElements.JumpToggle, UI.TweenPresets.Medium, {
        BackgroundColor3 = Config.JumpEnabled and Color3.fromRGB(50, 220, 100) or Color3.fromRGB(220, 50, 50)
    }):Play()
    
    AntiAFKElements.JumpToggle.Text = "Auto Jump: " .. (Config.JumpEnabled and "ON" or "OFF")
    if Config.JumpEnabled then
        task.wait(0.05)
        AntiAFK.StartJumpThread()
    else
        AntiAFK.StopJumpThread()
    end
    UpdateAntiAFKStatus()
    _G.UniversalUtility.SaveConfig()
end)

AntiAFKElements.ClickToggle.MouseButton1Click:Connect(function()
    if not SetDebounce("Click", 0.3) then return end
    Config.ClickEnabled = not Config.ClickEnabled
    TweenService:Create(AntiAFKElements.ClickToggle, UI.TweenPresets.Medium, {
        BackgroundColor3 = Config.ClickEnabled and Color3.fromRGB(50, 220, 100) or Color3.fromRGB(220, 50, 50)
    }):Play()
    
    AntiAFKElements.ClickToggle.Text = "Auto Click: " .. (Config.ClickEnabled and "ON" or "OFF")
    if Config.ClickEnabled then
        task.wait(0.05)
        AntiAFK.StartClickThread()
    else
        AntiAFK.StopClickThread()
    end
    UpdateAntiAFKStatus()
    _G.UniversalUtility.SaveConfig()
end)

KeySpamElements.AutoSpamToggle.MouseButton1Click:Connect(function()
    if not SetDebounce("Spam", 0.3) then return end
    Config.AutoSpamEnabled = not Config.AutoSpamEnabled
    if Config.AutoSpamEnabled then
        local keyText = KeySpamElements.SpamInput.Text:upper()
        local keyCode = KeyCodeMap[keyText]
        if not keyCode then
            Config.AutoSpamEnabled = false
            KeySpamElements.Status.Text = "Status: Invalid key"
            KeySpamElements.Status.TextColor3 = Color3.fromRGB(220, 50, 50)
            return
        end
        
        if keyCode == Enum.KeyCode.P or keyCode == Enum.KeyCode.G then
            Config.AutoSpamEnabled = false
            KeySpamElements.Status.Text = "Status: Key reserved"
            KeySpamElements.Status.TextColor3 = Color3.fromRGB(220, 50, 50)
            return
        end
        
        Config.SpamKey = keyText
        TweenService:Create(KeySpamElements.AutoSpamToggle, UI.TweenPresets.Medium, {BackgroundColor3 = Color3.fromRGB(50, 220, 100)}):Play()
        KeySpamElements.AutoSpamToggle.Text = "ON"
        KeySpamElements.Status.Text = "Status: Spamming " .. keyText
        KeySpamElements.Status.TextColor3 = Color3.fromRGB(50, 220, 100)
        task.wait(0.05)
        KeySpam.StartSpamThread()
    else
        TweenService:Create(KeySpamElements.AutoSpamToggle, UI.TweenPresets.Medium, {BackgroundColor3 = Color3.fromRGB(220, 50, 50)}):Play()
        KeySpamElements.AutoSpamToggle.Text = "OFF"
        KeySpamElements.Status.Text = "Status: Inactive"
        KeySpamElements.Status.TextColor3 = Color3.fromRGB(180, 180, 180)
        KeySpam.StopSpamThread()
    end
    _G.UniversalUtility.SaveConfig()
end)

PerformanceElements.FPSUnlockToggle.MouseButton1Click:Connect(function()
    if not SetDebounce("FPS", 0.3) then return end
    local success, result = Performance.ToggleFPSUnlock()
    
    if not success then
        PerformanceElements.FPSUnlockStatus.Text = result
        PerformanceElements.FPSUnlockStatus.TextColor3 = Color3.fromRGB(220, 50, 50)
        return
    end
    
    TweenService:Create(PerformanceElements.FPSUnlockToggle, UI.TweenPresets.Medium, {
        BackgroundColor3 = result and Color3.fromRGB(50, 220, 100) or Color3.fromRGB(220, 50, 50)
    }):Play()
    
    PerformanceElements.FPSUnlockToggle.Text = "FPS Unlock: " .. (result and "ON" or "OFF")
    if result then
        PerformanceElements.FPSUnlockStatus.Text = "Your target: " .. Config.TargetFPS .. " FPS"
        PerformanceElements.FPSUnlockStatus.TextColor3 = Color3.fromRGB(50, 220, 100)
    else
        PerformanceElements.FPSUnlockStatus.Text = "Default FPS"
        PerformanceElements.FPSUnlockStatus.TextColor3 = Color3.fromRGB(180, 180, 180)
    end
end)

RejoinElements.AutoRejoinToggle.MouseButton1Click:Connect(function()
    if not SetDebounce("Rejoin", 0.3) then return end
    Config.AutoRejoinEnabled = not Config.AutoRejoinEnabled
    TweenService:Create(RejoinElements.AutoRejoinToggle, UI.TweenPresets.Medium, {
        BackgroundColor3 = Config.AutoRejoinEnabled and Color3.fromRGB(50, 220, 100) or Color3.fromRGB(220, 50, 50)
    }):Play()
    
    RejoinElements.AutoRejoinToggle.Text = "Auto Rejoin: " .. (Config.AutoRejoinEnabled and "ON" or "OFF")
    RejoinElements.Status.Text = "Status: " .. (Config.AutoRejoinEnabled and "Enabled" or "Disabled") .. "\n\nAutomatically rejoins the game when you get disconnected.\nUseful for preventing AFK kicks."
    RejoinElements.Status.TextColor3 = Config.AutoRejoinEnabled and Color3.fromRGB(50, 220, 100) or Color3.fromRGB(180, 180, 180)
    
    if Config.AutoRejoinEnabled then
        AutoRejoin.Setup()
    else
        AutoRejoin.Stop()
    end
    _G.UniversalUtility.SaveConfig()
end)

LoaderElements.ExecuteButton.MouseButton1Click:Connect(function()
    if not SetDebounce("Execute", 0.5) then return end
    local code = LoaderElements.LoadStringBox.Text
    
    LoaderElements.Status.Text = "Status: Executing..."
    LoaderElements.Status.TextColor3 = Color3.fromRGB(255, 200, 100)
    TweenService:Create(LoaderElements.ExecuteButton, UI.TweenPresets.Medium, {BackgroundColor3 = Color3.fromRGB(255, 200, 100)}):Play()
    
    local success, message = ScriptLoader.Execute(code)
    
    if success then
        LoaderElements.Status.Text = "Status: " .. message
        LoaderElements.Status.TextColor3 = Color3.fromRGB(50, 220, 100)
        TweenService:Create(LoaderElements.ExecuteButton, UI.TweenPresets.Medium, {BackgroundColor3 = Color3.fromRGB(50, 220, 100)}):Play()
    else
        LoaderElements.Status.Text = "Status: " .. message
        LoaderElements.Status.TextColor3 = Color3.fromRGB(220, 50, 50)
        TweenService:Create(LoaderElements.ExecuteButton, UI.TweenPresets.Medium, {BackgroundColor3 = Color3.fromRGB(220, 50, 50)}):Play()
    end
    
    task.wait(2)
    if LoaderElements.Status.Text:match("Error") or LoaderElements.Status.Text:match("successfully") then
        LoaderElements.Status.Text = "Status: Ready"
        LoaderElements.Status.TextColor3 = Color3.fromRGB(180, 180, 180)
        TweenService:Create(LoaderElements.ExecuteButton, UI.TweenPresets.Medium, {BackgroundColor3 = Color3.fromRGB(45, 45, 52)}):Play()
    end
end)

local SaveCodeTimer = nil
local SaveCodeDelay = 1.0

LoaderElements.LoadStringBox:GetPropertyChangedSignal("Text"):Connect(function()
    if SaveCodeTimer then
        task.cancel(SaveCodeTimer)
    end
    SaveCodeTimer = task.delay(SaveCodeDelay, function()
        ScriptLoader.SaveCode(LoaderElements.LoadStringBox.Text)
        LoaderElements.Status.Text = "Status: Code auto-saved"
        LoaderElements.Status.TextColor3 = Color3.fromRGB(100, 200, 255)
        task.wait(2)
        if LoaderElements.Status.Text == "Status: Code auto-saved" then
            LoaderElements.Status.Text = "Status: Ready"
            LoaderElements.Status.TextColor3 = Color3.fromRGB(180, 180, 180)
        end
    end)
    Helpers.UpdateLineNumbers(LoaderElements.LoadStringBox, LoaderElements.LineNumbers, LoaderElements.LoadStringScrollFrame, LoaderElements.LineNumbersScrollFrame)
end)

LoaderElements.LoadStringScrollFrame:GetPropertyChangedSignal("CanvasPosition"):Connect(function()
    LoaderElements.LineNumbersScrollFrame.CanvasPosition = Vector2.new(0, LoaderElements.LoadStringScrollFrame.CanvasPosition.Y)
end)

SettingsElements.KeybindButton.MouseButton1Click:Connect(function()
    if not SetDebounce("Keybind", 0.5) or Config.IsChangingKeybind then return end
    Config.IsChangingKeybind = true
    
    SettingsElements.KeybindButton.Text = "Press any key..."
    SettingsElements.Status.Text = "Waiting for input..."
    SettingsElements.Status.TextColor3 = Color3.fromRGB(255, 200, 100)
    
    SettingsElements.KeybindButton.Active = false
    
    local connection
    local timeout = task.delay(5, function()
        if connection then
            connection:Disconnect()
            Config.IsChangingKeybind = false
            SettingsElements.KeybindButton.Active = true
            
            SettingsElements.KeybindButton.Text = "Toggle Keybind: " .. (KeyCodeNames[Config.Keybind] or Config.Keybind.Name)
            SettingsElements.Status.Text = "Timeout - Click again to retry"
            SettingsElements.Status.TextColor3 = Color3.fromRGB(255, 100, 100)
            task.wait(2)
            if SettingsElements.Status.Text:match("Timeout") then
                SettingsElements.Status.Text = "Click the button above to change your Toggle Keybind\n\nPress the keybind at any time to open/close this menu."
                SettingsElements.Status.TextColor3 = Color3.fromRGB(150, 150, 150)
            end
        end
    end)
    
    connection = UserInputService.InputBegan:Connect(function(input, gameProcessed)
        if input.UserInputType == Enum.UserInputType.Keyboard and not gameProcessed then
            task.cancel(timeout)
            
            Config.Keybind = input.KeyCode
            local keyName = KeyCodeNames[input.KeyCode] or input.KeyCode.Name
            SettingsElements.KeybindButton.Text = "Toggle Keybind: " .. keyName
            SettingsElements.Status.Text = "Keybind changed successfully!\n\nPress the keybind at any time to open/close this menu."
            SettingsElements.Status.TextColor3 = Color3.fromRGB(50, 220, 100)
            _G.UniversalUtility.SaveConfig()
            
            SettingsElements.KeybindButton.Active = true
            
            connection:Disconnect()
            
            task.delay(0.1, function()
                Config.IsChangingKeybind = false
            end)
            
            task.wait(1.5)
            if SettingsElements.Status.Text:match("successfully") then
                SettingsElements.Status.Text = "Click the button above to change your Toggle Keybind\n\nPress the keybind at any time to open/close this menu."
                SettingsElements.Status.TextColor3 = Color3.fromRGB(150, 150, 150)
            end
        end
    end)
end)

for _, tab in ipairs({{name="Home"},{name="Anti-AFK"},{name="KeySpam"},{name="Performance Status"},{name="Auto Rejoin"},{name="Script Loader"},{name="Settings"}}) do
    local name = tab.name
    UI.TabButtons[name].Button.MouseButton1Click:Connect(function()
        Interactions.SwitchTab(name)
    end)
end

Interactions.SetupKeybindListener()
Interactions.SetupCloseButton()
Interactions.SetupReopenButton()

Performance.StartMonitoring({
    FPSLabel = Tabs.UIElements.FPSLabel,
    PingLabel = Tabs.UIElements.PingLabel,
    FPSStats = PerformanceElements.FPSStats,
    PingStats = PerformanceElements.PingStats
})

UI.LoadPlayerInfo()

Helpers.UpdateLineNumbers(LoaderElements.LoadStringBox, LoaderElements.LineNumbers, LoaderElements.LoadStringScrollFrame, LoaderElements.LineNumbersScrollFrame)

local configLoaded = _G.UniversalUtility.LoadConfig()

if configLoaded then
    local keyName = KeyCodeNames[Config.Keybind] or Config.Keybind.Name
    SettingsElements.KeybindButton.Text = "Toggle Keybind: " .. keyName
    KeySpamElements.SpamInput.Text = Config.SpamKey
    LoaderElements.LoadStringBox.Text = Config.SavedCode
    
    UpdateJumpSlider((Config.JumpDelay - 5) / 25)
    UpdateClickSlider((Config.ClickDelay - 1) / 9)
    UpdateSpamSlider((Config.SpamDelay - 0.05) / 4.95)
    UpdateFPSSlider((Config.TargetFPS - 15) / 345)
    UpdateClickTypeButtons()
    
    if Config.AutoRejoinEnabled then
        RejoinElements.AutoRejoinToggle.BackgroundColor3 = Color3.fromRGB(50, 220, 100)
        RejoinElements.AutoRejoinToggle.Text = "Auto Rejoin: ON"
        RejoinElements.Status.Text = "Status: Enabled\n\nAutomatically rejoins the game when you get disconnected.\nUseful for preventing AFK kicks."
        RejoinElements.Status.TextColor3 = Color3.fromRGB(50, 220, 100)
        AutoRejoin.Setup()
    end
    
    if Config.FPSUnlockEnabled and Performance.FPS_SUPPORTED then
        PerformanceElements.FPSUnlockToggle.BackgroundColor3 = Color3.fromRGB(50, 220, 100)
        PerformanceElements.FPSUnlockToggle.Text = "FPS Unlock: ON"
        PerformanceElements.FPSUnlockStatus.TextColor3 = Color3.fromRGB(50, 220, 100)
        PerformanceElements.FPSUnlockStatus.Text = "Your target: " .. Config.TargetFPS .. " FPS"
        Performance.SetTargetFPS(Config.TargetFPS)
    end
    
    if Config.JumpEnabled then
        AntiAFKElements.JumpToggle.BackgroundColor3 = Color3.fromRGB(50, 220, 100)
        AntiAFKElements.JumpToggle.Text = "Auto Jump: ON"
        task.wait(0.1)
        AntiAFK.StartJumpThread()
    else
        AntiAFKElements.JumpToggle.BackgroundColor3 = Color3.fromRGB(220, 50, 50)
        AntiAFKElements.JumpToggle.Text = "Auto Jump: OFF"
    end
    
    if Config.ClickEnabled then
        AntiAFKElements.ClickToggle.BackgroundColor3 = Color3.fromRGB(50, 220, 100)
        AntiAFKElements.ClickToggle.Text = "Auto Click: ON"
        task.wait(0.1)
        AntiAFK.StartClickThread()
    else
        AntiAFKElements.ClickToggle.BackgroundColor3 = Color3.fromRGB(220, 50, 50)
        AntiAFKElements.ClickToggle.Text = "Auto Click: OFF"
    end
    
    if Config.AutoSpamEnabled then
        local keyCode = KeyCodeMap[Config.SpamKey]
        if keyCode then
            KeySpamElements.AutoSpamToggle.BackgroundColor3 = Color3.fromRGB(50, 220, 100)
            KeySpamElements.AutoSpamToggle.Text = "ON"
            KeySpamElements.Status.Text = "Status: Spamming " .. Config.SpamKey
            KeySpamElements.Status.TextColor3 = Color3.fromRGB(50, 220, 100)
            task.wait(0.1)
            KeySpam.StartSpamThread()
        else
            Config.AutoSpamEnabled = false
            KeySpamElements.AutoSpamToggle.BackgroundColor3 = Color3.fromRGB(220, 50, 50)
            KeySpamElements.AutoSpamToggle.Text = "OFF"
            KeySpamElements.Status.Text = "Status: Inactive"
            KeySpamElements.Status.TextColor3 = Color3.fromRGB(180, 180, 180)
        end
    else
        KeySpamElements.AutoSpamToggle.BackgroundColor3 = Color3.fromRGB(220, 50, 50)
        KeySpamElements.AutoSpamToggle.Text = "OFF"
        KeySpamElements.Status.Text = "Status: Inactive"
        KeySpamElements.Status.TextColor3 = Color3.fromRGB(180, 180, 180)
    end
    
    UpdateAntiAFKStatus()
else
    UpdateJumpSlider(0.2)
    UpdateClickSlider(0.22)
    UpdateSpamSlider(0.01)
    UpdateFPSSlider(0.13)
    UpdateClickTypeButtons()
    
    AntiAFKElements.JumpToggle.BackgroundColor3 = Color3.fromRGB(220, 50, 50)
    AntiAFKElements.JumpToggle.Text = "Auto Jump: OFF"
    AntiAFKElements.ClickToggle.BackgroundColor3 = Color3.fromRGB(220, 50, 50)
    AntiAFKElements.ClickToggle.Text = "Auto Click: OFF"
    KeySpamElements.AutoSpamToggle.BackgroundColor3 = Color3.fromRGB(220, 50, 50)
    KeySpamElements.AutoSpamToggle.Text = "OFF"
    KeySpamElements.Status.Text = "Status: Inactive"
    KeySpamElements.Status.TextColor3 = Color3.fromRGB(180, 180, 180)
    PerformanceElements.FPSUnlockToggle.BackgroundColor3 = Color3.fromRGB(220, 50, 50)
    PerformanceElements.FPSUnlockToggle.Text = "FPS Unlock: OFF"
    PerformanceElements.FPSUnlockStatus.Text = "Default FPS"
    PerformanceElements.FPSUnlockStatus.TextColor3 = Color3.fromRGB(180, 180, 180)
    UpdateAntiAFKStatus()
end

Interactions.SwitchTab(Config.CurrentTab)

UI.ScreenGui.Destroying:Connect(Helpers.CleanupAllThreads)

task.wait(0.1)

UI.MainFrame.Visible = true
UI.MainFrame.Size = UDim2.new(0, 0, 0, 0)
UI.MainFrame.Position = UDim2.new(0.5, 0, 0.5, 0)
UI.ReopenButton.Visible = false

local openTween = TweenService:Create(UI.MainFrame, TweenInfo.new(0.8, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
    Size = UDim2.new(0, 650, 0, 500),
    Position = UDim2.new(0.5, -325, 0.5, -250)
})
openTween:Play()

return _G.UniversalUtility.Initiator
