local HttpService = game:GetService("HttpService")
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local MarketplaceService = game:GetService("MarketplaceService")

local LocalPlayer = Players.LocalPlayer

local function Initialize(framework, tabs, configModule, helpers)
    local Config = configModule.Config
    local SaveConfig = configModule.Save
    local LoadConfig = configModule.Load

    local configLoaded = LoadConfig()

    local screenGui = framework.CreateScreenGui()
    local mainFrame = framework.CreateMainFrame(screenGui)
    local topBar, titleLabel, closeButton = framework.CreateTopBar(mainFrame)
    local sideNav = tabs.CreateSideNav(mainFrame)
    local contentFrame = tabs.CreateContentFrame(mainFrame)

    local reopenButton = Instance.new("ImageButton", screenGui)
    reopenButton.Name = "ReopenButton"
    reopenButton.Size = UDim2.new(0, 0, 0, 0)
    reopenButton.Position = UDim2.new(0.5, 0, 0, 30)
    reopenButton.BackgroundColor3 = Color3.fromRGB(100, 150, 255)
    reopenButton.BorderSizePixel = 0
    reopenButton.Visible = false
    reopenButton.ZIndex = 10

    local reopenCorner = Instance.new("UICorner", reopenButton)
    reopenCorner.CornerRadius = UDim.new(1, 0)

    local reopenIcon = Instance.new("TextLabel", reopenButton)
    reopenIcon.Size = UDim2.new(1, 0, 1, 0)
    reopenIcon.BackgroundTransparency = 1
    reopenIcon.Text = "‚ö°"
    reopenIcon.Font = Enum.Font.GothamBold
    reopenIcon.TextSize = 24
    reopenIcon.TextColor3 = Color3.fromRGB(255, 255, 255)

    local tabList = {
        {"Home",              "üè†",    UDim2.new(0, 5, 0, 5)},
        {"Anti-AFK",          "üõ°Ô∏è",    UDim2.new(0, 5, 0, 68)},
        {"KeySpam",           "‚å®Ô∏è",    UDim2.new(0, 5, 0, 131)},
        {"Performance Status","üìä",    UDim2.new(0, 5, 0, 194)},
        {"Auto Rejoin",       "üîÑ",    UDim2.new(0, 5, 0, 257)},
        {"Script Loader",     "üíæ",    UDim2.new(0, 5, 0, 320)},
        {"Settings",          "‚öôÔ∏è",    UDim2.new(0, 5, 0, 383)}
    }

    local tabButtons = {}
    local tabContents = {}

    for _, tab in ipairs(tabList) do
        local name, icon, pos = tab[1], tab[2], tab[3]
        local btn, iconLbl, nameLbl = tabs.CreateTabButton(sideNav, name, icon, pos)
        tabButtons[name] = {button = btn, icon = iconLbl, label = nameLbl}

        local content = tabs.CreateTabContent(contentFrame, name)
        tabContents[name] = content
    end

    if configLoaded then
        tabs.SwitchTab(tabButtons, tabContents, Config.CurrentTab, Config)
    else
        tabs.SwitchTab(tabButtons, tabContents, "Home", Config)
    end

    return {
        screenGui = screenGui,
        mainFrame = mainFrame,
        closeButton = closeButton,
        reopenButton = reopenButton,
        tabButtons = tabButtons,
        tabContents = tabContents,
        tabList = tabList,
        Config = Config,
        SaveConfig = SaveConfig
    }
end

return {
    Initialize = Initialize
}
