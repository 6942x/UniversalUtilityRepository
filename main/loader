local REPO_URL = "https://raw.githubusercontent.com/6942x/UniversalUtilityRepository/Branch/"

_G.UniversalUtility = nil
task.wait(0.2)

local modules = {
    "utils/helpers",
    "core/config",
    "features/antiafk",
    "features/autorejoin",
    "features/keyspam",
    "features/performance",
    "features/scriptloader",
    "ui/framework",
    "ui/interactions",
    "ui/tabs/home",
    "ui/tabs/antiafk",
    "ui/tabs/keyspam",
    "ui/tabs/performance",
    "ui/tabs/autorejoin",
    "ui/tabs/scriptloader",
    "ui/tabs/settings",
    "init/initiator"
}

print("[Universal Utility Loader] Starting module loading sequence...")

local function LoadModule(path)
    local url = REPO_URL .. path
    local success, result = pcall(function()
        return game:HttpGet(url)
    end)
    
    if success then
        local loadSuccess, loadError = pcall(function()
            loadstring(result)()
        end)
        
        if loadSuccess then
            print("[Universal Utility Loader] ✓ Loaded: " .. path)
            return true
        else
            warn("[Universal Utility Loader] ✗ Error loading " .. path .. ": " .. tostring(loadError))
            return false
        end
    else
        warn("[Universal Utility Loader] ✗ Failed to fetch " .. path .. ": " .. tostring(result))
        return false
    end
end

local loadedCount = 0
local totalModules = #modules

for _, modulePath in ipairs(modules) do
    if LoadModule(modulePath) then
        loadedCount = loadedCount + 1
    else
        warn("[Universal Utility Loader] Failed to load critical module: " .. modulePath)
    end
    task.wait(0.1)
end

print(string.format("[Universal Utility Loader] Loading complete: %d/%d modules loaded successfully", loadedCount, totalModules))

if loadedCount == totalModules then
    print("[Universal Utility Loader] ✓ All modules loaded successfully - Universal Utility is ready!")
else
    warn("[Universal Utility Loader] ⚠ Some modules failed to load - GUI may not function correctly")
end
