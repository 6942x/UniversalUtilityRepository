local HttpService = game:GetService("HttpService")
local baseUrl = "https://raw.githubusercontent.com/6942x/UniversalUtilityRepository/main/"

local function loadModule(path)
    local success, result = pcall(function()
        return loadstring(game:HttpGet(baseUrl .. path, true))()
    end)
    if not success then
        warn("Failed to load " .. path .. ": " .. tostring(result))
        return nil
    end
    return result
end

local configModule    = loadModule("core/config.lua")
local helpers         = loadModule("utils/helpers.lua")
local antiafk         = loadModule("features/antiafk.lua")
local autorejoin      = loadModule("features/autorejoin.lua")
local keyspam         = loadModule("features/keyspam.lua")
local performance     = loadModule("features/performance.lua")
local scriptloader    = loadModule("features/scriptloader.lua")

local framework       = loadModule("ui/framework.lua")
local interactions    = loadModule("ui/interactions.lua")
local tabsModule      = loadModule("ui/tabs.lua")
local init            = loadModule("init/init.lua")

if not (configModule and helpers and framework and interactions and tabsModule and init) then
    warn("Critical modules failed to load")
    return
end

local uiState = init.Initialize(framework, tabsModule, configModule, helpers)

local Config = uiState.Config
local SaveConfig = uiState.SaveConfig
local mainFrame = uiState.mainFrame
local closeButton = uiState.closeButton
local reopenButton = uiState.reopenButton
local tabButtons = uiState.tabButtons
local tabContents = uiState.tabContents

local interactionHandlers = interactions.SetupInteractions(mainFrame, reopenButton, Config)

local ToggleUI = interactionHandlers.ToggleUI
local SetDebounce = interactionHandlers.SetDebounce

closeButton.MouseButton1Click:Connect(ToggleUI)

for _, tab in ipairs(uiState.tabList) do
    local name = tab[1]
    tabButtons[name].button.MouseButton1Click:Connect(function()
        if not SetDebounce("TabSwitch", 0.15) then return end
        tabsModule.SwitchTab(tabButtons, tabContents, name, Config)
        SaveConfig()
    end)
end

task.spawn(function()
    while true do
        task.wait(60)
        SaveConfig()
    end
end)

mainFrame.Visible = true
game:GetService("TweenService"):Create(mainFrame, TweenInfo.new(0.8, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
    Size = UDim2.new(0, 650, 0, 500),
    Position = UDim2.new(0.5, -325, 0.5, -250)
}):Play()

print("Universal Utility loaded")
