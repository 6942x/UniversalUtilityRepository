local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local CoreGui = game:GetService("CoreGui")
local VirtualInputManager = game:GetService("VirtualInputManager")
local MarketplaceService = game:GetService("MarketplaceService")
local TeleportService = game:GetService("TeleportService")

local FPS_SUPPORTED = typeof(setfpscap) == "function"
local LocalPlayer = Players.LocalPlayer

local oldGui = CoreGui:FindFirstChild("UniversalUtility") or (gethui and gethui():FindFirstChild("UniversalUtility"))
if oldGui then oldGui:Destroy() end

local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "UniversalUtility"
ScreenGui.ResetOnSpawn = false
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

if syn and syn.protect_gui then
    syn.protect_gui(ScreenGui)
    ScreenGui.Parent = CoreGui
elseif gethui then
    ScreenGui.Parent = gethui()
else
    ScreenGui.Parent = CoreGui
end

local KeyCodeNames, KeyCodeMap = {}, {}
for i = 65, 90 do
    local char = string.char(i)
    KeyCodeNames[Enum.KeyCode[char]] = char
    KeyCodeMap[char] = Enum.KeyCode[char]
end

local numNames = {"One","Two","Three","Four","Five","Six","Seven","Eight","Nine"}
for i = 0, 9 do
    local keyName = i == 0 and "Zero" or numNames[i]
    KeyCodeNames[Enum.KeyCode[keyName]] = tostring(i)
    KeyCodeMap[tostring(i)] = Enum.KeyCode[keyName]
end

for i = 1, 12 do
    KeyCodeNames[Enum.KeyCode["F" .. i]] = "F" .. i
    KeyCodeMap["F" .. i] = Enum.KeyCode["F" .. i]
end

local specialKeys = {
    LeftControl = "Left Ctrl",
    RightControl = "Right Ctrl",
    LeftShift = "Left Shift",
    RightShift = "Right Shift",
    LeftAlt = "Left Alt",
    RightAlt = "Right Alt",
    Tab = "Tab",
    CapsLock = "Caps Lock",
    Space = "Space",
    Return = "Enter",
    Backspace = "Backspace",
    Delete = "Delete",
    Insert = "Insert",
    Home = "Home",
    End = "End",
    PageUp = "Page Up",
    PageDown = "Page Down"
}

for k, v in pairs(specialKeys) do
    KeyCodeNames[Enum.KeyCode[k]] = v
end

local Config = {
    Keybind = Enum.KeyCode.G,
    ClickType = "Current",
    JumpEnabled = false,
    ClickEnabled = false,
    AutoSpamEnabled = false,
    IsChangingKeybind = false,
    FPSUnlockEnabled = false,
    AutoRejoinEnabled = false,
    TargetFPS = 60,
    JumpDelay = 10.0,
    ClickDelay = 3.0,
    SpamDelay = 0.1,
    SpamKey = "Q",
    SavedCode = "",
    CurrentTab = "Home"
}

local ActiveThreads = {}
local Debounces = {}
local TabButtons = {}
local TabContents = {}
local ButtonStates = {}

local function SaveConfig()
    if writefile then
        local configData = game:GetService("HttpService"):JSONEncode({
            Keybind = Config.Keybind.Name,
            ClickType = Config.ClickType,
            JumpEnabled = Config.JumpEnabled,
            ClickEnabled = Config.ClickEnabled,
            AutoRejoinEnabled = Config.AutoRejoinEnabled,
            FPSUnlockEnabled = Config.FPSUnlockEnabled,
            AutoSpamEnabled = Config.AutoSpamEnabled,
            TargetFPS = Config.TargetFPS,
            JumpDelay = Config.JumpDelay,
            ClickDelay = Config.ClickDelay,
            SpamDelay = Config.SpamDelay,
            SpamKey = Config.SpamKey,
            SavedCode = Config.SavedCode,
            CurrentTab = Config.CurrentTab
        })
        writefile("UniversalUtilityConfig.json", configData)
    end
end

local function LoadConfig()
    if readfile and isfile and isfile("UniversalUtilityConfig.json") then
        local success, data = pcall(function()
            return game:GetService("HttpService"):JSONDecode(readfile("UniversalUtilityConfig.json"))
        end)
        if success and data then
            Config.Keybind = Enum.KeyCode[data.Keybind] or Enum.KeyCode.G
            Config.ClickType = data.ClickType or "Current"
            Config.JumpEnabled = data.JumpEnabled or false
            Config.ClickEnabled = data.ClickEnabled or false
            Config.AutoRejoinEnabled = data.AutoRejoinEnabled or false
            Config.FPSUnlockEnabled = data.FPSUnlockEnabled or false
            Config.AutoSpamEnabled = data.AutoSpamEnabled or false
            Config.TargetFPS = data.TargetFPS or 60
            Config.JumpDelay = data.JumpDelay or 10.0
            Config.ClickDelay = data.ClickDelay or 3.0
            Config.SpamDelay = data.SpamDelay or 0.1
            Config.SpamKey = data.SpamKey or "Q"
            Config.SavedCode = data.SavedCode or ""
            Config.CurrentTab = data.CurrentTab or "Home"
            return true
        end
    end
    return false
end

local TweenPresets = {
    Fast = TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
    Medium = TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
    Slow = TweenInfo.new(0.4, Enum.EasingStyle.Quad, Enum.EasingDirection.In),
    Back = TweenInfo.new(0.6, Enum.EasingStyle.Back, Enum.EasingDirection.Out),
    BackIn = TweenInfo.new(0.4, Enum.EasingStyle.Back, Enum.EasingDirection.In)
}

local function SetDebounce(key, duration)
    if Debounces[key] then return false end
    Debounces[key] = true
    task.delay(duration or 0.3, function() Debounces[key] = false end)
    return true
end

local MainFrame = Instance.new("Frame", ScreenGui)
MainFrame.Name = "MainFrame"
MainFrame.Size = UDim2.new(0, 0, 0, 0)
MainFrame.Position = UDim2.new(0.5, 0, 0.5, 0)
MainFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 30)
MainFrame.BorderSizePixel = 0
MainFrame.Active = true
MainFrame.Draggable = true
MainFrame.ClipsDescendants = true
MainFrame.Visible = false

local UICorner = Instance.new("UICorner", MainFrame)
UICorner.CornerRadius = UDim.new(0, 16)

local TopBar = Instance.new("Frame", MainFrame)
TopBar.Name = "TopBar"
TopBar.Size = UDim2.new(1, 0, 0, 40)
TopBar.Position = UDim2.new(0, 0, 0, 5)
TopBar.BackgroundColor3 = Color3.fromRGB(35, 35, 42)
TopBar.BackgroundTransparency = 0
TopBar.BorderSizePixel = 0

local TopBarCorner = Instance.new("UICorner", TopBar)
TopBarCorner.CornerRadius = UDim.new(0, 16)

local Title = Instance.new("TextLabel", TopBar)
Title.Size = UDim2.new(1, -80, 1, 0)
Title.Position = UDim2.new(0, 15, 0, 0)
Title.BackgroundTransparency = 1
Title.Text = "‚ö° Universal Utility"
Title.Font = Enum.Font.GothamBold
Title.TextSize = 24
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.TextXAlignment = Enum.TextXAlignment.Left

local CloseButton = Instance.new("ImageButton", TopBar)
CloseButton.Size = UDim2.new(0, 30, 0, 30)
CloseButton.Position = UDim2.new(1, -40, 0.48, 0)
CloseButton.AnchorPoint = Vector2.new(0, 0.5)
CloseButton.BackgroundColor3 = Color3.fromRGB(220, 50, 50)
CloseButton.BorderSizePixel = 0
CloseButton.Image = "rbxassetid://3926305904"
CloseButton.ImageRectOffset = Vector2.new(284, 4)
CloseButton.ImageRectSize = Vector2.new(24, 24)
CloseButton.ImageColor3 = Color3.fromRGB(255, 255, 255)

local CloseButtonCorner = Instance.new("UICorner", CloseButton)
CloseButtonCorner.CornerRadius = UDim.new(0, 8)

local SideNav = Instance.new("Frame", MainFrame)
SideNav.Name = "SideNav"
SideNav.Size = UDim2.new(0, 180, 1, -57)
SideNav.Position = UDim2.new(0, 2.5, 0, 50)
SideNav.BackgroundColor3 = Color3.fromRGB(30, 30, 35)
SideNav.BorderSizePixel = 0

local SideNavCorner = Instance.new("UICorner", SideNav)
SideNavCorner.CornerRadius = UDim.new(0, 12)

local ContentFrame = Instance.new("Frame", MainFrame)
ContentFrame.Name = "ContentFrame"
ContentFrame.Size = UDim2.new(1, -180, 1, -40)
ContentFrame.Position = UDim2.new(0, 180, 0, 45)
ContentFrame.BackgroundTransparency = 1
ContentFrame.BorderSizePixel = 0
ContentFrame.ClipsDescendants = true

local function CreateTabButton(name, icon, position)
    local btn = Instance.new("TextButton", SideNav)
    btn.Name = name .. "Tab"
    btn.Size = UDim2.new(1, -10, 0, 55)
    btn.Position = position
    btn.BackgroundColor3 = Color3.fromRGB(35, 35, 42)
    btn.BorderSizePixel = 0
    btn.Text = ""
    btn.AutoButtonColor = false
    
    local corner = Instance.new("UICorner", btn)
    corner.CornerRadius = UDim.new(0, 8)
    
    local iconLabel = Instance.new("TextLabel", btn)
    iconLabel.Size = UDim2.new(0, 30, 1, 0)
    iconLabel.Position = UDim2.new(0, 10, 0, 0)
    iconLabel.BackgroundTransparency = 1
    iconLabel.Text = icon
    iconLabel.Font = Enum.Font.GothamBold
    iconLabel.TextSize = 24
    iconLabel.TextColor3 = Color3.fromRGB(180, 180, 180)
    iconLabel.TextXAlignment = Enum.TextXAlignment.Left
    
    local nameLabel = Instance.new("TextLabel", btn)
    nameLabel.Size = UDim2.new(1, -50, 1, 0)
    nameLabel.Position = UDim2.new(0, 45, 0, 0)
    nameLabel.BackgroundTransparency = 1
    nameLabel.Text = name
    nameLabel.Font = Enum.Font.GothamBold
    nameLabel.TextSize = 13
    nameLabel.TextColor3 = Color3.fromRGB(180, 180, 180)
    nameLabel.TextXAlignment = Enum.TextXAlignment.Left
    
    TabButtons[name] = {Button = btn, Icon = iconLabel, Label = nameLabel}
    
    btn.MouseEnter:Connect(function()
        if Config.CurrentTab ~= name then
            TweenService:Create(btn, TweenPresets.Fast, {
                BackgroundColor3 = Color3.fromRGB(45, 45, 52)
            }):Play()
            TweenService:Create(iconLabel, TweenPresets.Fast, {
                TextColor3 = Color3.fromRGB(200, 200, 200)
            }):Play()
            TweenService:Create(nameLabel, TweenPresets.Fast, {
                TextColor3 = Color3.fromRGB(200, 200, 200)
            }):Play()
        end
    end)
    
    btn.MouseLeave:Connect(function()
        if Config.CurrentTab ~= name then
            TweenService:Create(btn, TweenPresets.Fast, {
                BackgroundColor3 = Color3.fromRGB(35, 35, 42)
            }):Play()
            TweenService:Create(iconLabel, TweenPresets.Fast, {
                TextColor3 = Color3.fromRGB(180, 180, 180)
            }):Play()
            TweenService:Create(nameLabel, TweenPresets.Fast, {
                TextColor3 = Color3.fromRGB(180, 180, 180)
            }):Play()
        end
    end)
    
    return btn
end

local tabList = {
    {"Home", "üè†", UDim2.new(0, 5, 0, 5)},
    {"Anti-AFK", "üõ°Ô∏è", UDim2.new(0, 5, 0, 68)},
    {"KeySpam", "‚å®Ô∏è", UDim2.new(0, 5, 0, 131)},
    {"Performance Status", "üìä", UDim2.new(0, 5, 0, 194)},
    {"Auto Rejoin", "üîÑ", UDim2.new(0, 5, 0, 257)},
    {"Script Loader", "üíæ", UDim2.new(0, 5, 0, 320)},
    {"Settings", "‚öôÔ∏è", UDim2.new(0, 5, 0, 383)}
}

for _, tab in ipairs(tabList) do
    CreateTabButton(tab[1], tab[2], tab[3])
end

local function CreateTabContent(name)
    local scroll = Instance.new("ScrollingFrame", ContentFrame)
    scroll.Name = name .. "Content"
    scroll.Size = UDim2.new(1, -10, 1, -10)
    scroll.Position = UDim2.new(0, 5, 0, 5)
    scroll.BackgroundTransparency = 1
    scroll.BorderSizePixel = 0
    scroll.ScrollBarThickness = 4
    scroll.ScrollBarImageColor3 = Color3.fromRGB(100, 150, 255)
    scroll.ScrollBarImageTransparency = 0.5
    scroll.CanvasSize = UDim2.new(0, 0, 0, 0)
    scroll.Visible = false
    scroll.AutomaticCanvasSize = Enum.AutomaticSize.Y
    
    local layout = Instance.new("UIListLayout", scroll)
    layout.SortOrder = Enum.SortOrder.LayoutOrder
    layout.Padding = UDim.new(0, 10)
    
    TabContents[name] = scroll
    return scroll
end

for _, tab in ipairs(tabList) do
    CreateTabContent(tab[1])
end

local function CreateButton(parent, size, text)
    local button = Instance.new("TextButton", parent)
    button.Size = size
    button.AnchorPoint = Vector2.new(0.5, 0)
    button.Position = UDim2.new(0.5, 0, 0, 0)
    button.BackgroundColor3 = Color3.fromRGB(45, 45, 52)
    button.Text = text
    button.Font = Enum.Font.GothamBold
    button.TextSize = 13
    button.TextColor3 = Color3.fromRGB(255, 255, 255)
    button.BorderSizePixel = 0

    local corner = Instance.new("UICorner", button)
    corner.CornerRadius = UDim.new(0, 8)

    local originalSize = size
    local isHovering = false
    
    ButtonStates[button] = {
        OriginalSize = originalSize,
        IsHovering = false
    }

    button.MouseEnter:Connect(function()
        isHovering = true
        ButtonStates[button].IsHovering = true
        TweenService:Create(button, TweenPresets.Fast, {
            Size = UDim2.new(originalSize.X.Scale, originalSize.X.Offset + 6, originalSize.Y.Scale, originalSize.Y.Offset + 4)
        }):Play()
    end)

    button.MouseLeave:Connect(function()
        isHovering = false
        ButtonStates[button].IsHovering = false
        local currentColor = button.BackgroundColor3
        TweenService:Create(button, TweenPresets.Fast, {
            Size = originalSize,
            BackgroundColor3 = currentColor
        }):Play()
    end)

    button.MouseButton1Down:Connect(function()
        if isHovering then
            TweenService:Create(button, TweenInfo.new(0.1, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
                Size = UDim2.new(originalSize.X.Scale, originalSize.X.Offset - 4, originalSize.Y.Scale, originalSize.Y.Offset - 3)
            }):Play()
        end
    end)

    button.MouseButton1Up:Connect(function()
        if isHovering then
            TweenService:Create(button, TweenPresets.Fast, {
                Size = UDim2.new(originalSize.X.Scale, originalSize.X.Offset + 6, originalSize.Y.Scale, originalSize.Y.Offset + 4)
            }):Play()
        else
            TweenService:Create(button, TweenPresets.Fast, {
                Size = originalSize
            }):Play()
        end
    end)

    return button
end

CloseButton.MouseEnter:Connect(function()
    TweenService:Create(CloseButton, TweenPresets.Fast, {
        BackgroundColor3 = Color3.fromRGB(240, 70, 70),
        Size = UDim2.new(0, 32, 0, 32)
    }):Play()
end)

CloseButton.MouseLeave:Connect(function()
    TweenService:Create(CloseButton, TweenPresets.Fast, {
        BackgroundColor3 = Color3.fromRGB(220, 50, 50),
        Size = UDim2.new(0, 30, 0, 30)
    }):Play()
end)

CloseButton.MouseButton1Down:Connect(function()
    TweenService:Create(CloseButton, TweenInfo.new(0.1, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
        Size = UDim2.new(0, 28, 0, 28)
    }):Play()
end)

CloseButton.MouseButton1Up:Connect(function()
    TweenService:Create(CloseButton, TweenPresets.Fast, {
        Size = UDim2.new(0, 30, 0, 30)
    }):Play()
end)

local function CreateSlider(parent, size, minValue, maxValue, currentValue, labelText)
    local sliderFrame = Instance.new("Frame", parent)
    sliderFrame.Size = size
    sliderFrame.BackgroundTransparency = 1

    local valueLabel = Instance.new("TextLabel", sliderFrame)
    valueLabel.Size = UDim2.new(1, 0, 0, 18)
    valueLabel.BackgroundTransparency = 1
    valueLabel.Text = labelText
    valueLabel.Font = Enum.Font.Gotham
    valueLabel.TextSize = 12
    valueLabel.TextColor3 = Color3.fromRGB(180, 180, 180)
    valueLabel.TextXAlignment = Enum.TextXAlignment.Left

    local slider = Instance.new("Frame", sliderFrame)
    slider.Size = UDim2.new(1, -60, 0, 6)
    slider.Position = UDim2.new(0, 0, 0, 22)
    slider.BackgroundColor3 = Color3.fromRGB(45, 45, 52)
    slider.BorderSizePixel = 0

    local sliderCorner = Instance.new("UICorner", slider)
    sliderCorner.CornerRadius = UDim.new(0, 3)

    local fill = Instance.new("Frame", slider)
    fill.Size = UDim2.new(0.5, 0, 1, 0)
    fill.BackgroundColor3 = Color3.fromRGB(100, 150, 255)
    fill.BorderSizePixel = 0

    local fillCorner = Instance.new("UICorner", fill)
    fillCorner.CornerRadius = UDim.new(0, 3)

    local button = Instance.new("TextButton", slider)
    button.Size = UDim2.new(1, 0, 1, 0)
    button.BackgroundTransparency = 1
    button.Text = ""

    local valueBox = Instance.new("TextBox", sliderFrame)
    valueBox.Size = UDim2.new(0, 50, 0, 24)
    valueBox.Position = UDim2.new(1, -50, 0, 16)
    valueBox.BackgroundColor3 = Color3.fromRGB(45, 45, 52)
    valueBox.Text = tostring(currentValue)
    valueBox.Font = Enum.Font.Gotham
    valueBox.TextScaled = true
    valueBox.TextColor3 = Color3.fromRGB(255, 255, 255)
    valueBox.ClearTextOnFocus = false

    local valueCorner = Instance.new("UICorner", valueBox)
    valueCorner.CornerRadius = UDim.new(0, 5)

    return sliderFrame, slider, fill, button, valueBox, valueLabel
end

local HomeContent = TabContents["Home"]
local AntiAFKContent = TabContents["Anti-AFK"]
local KeySpamContent = TabContents["KeySpam"]
local FPSContent = TabContents["Performance Status"]
local RejoinContent = TabContents["Auto Rejoin"]
local LoaderContent = TabContents["Script Loader"]
local SettingsContent = TabContents["Settings"]

local PlayerInfoFrame = Instance.new("Frame", HomeContent)
PlayerInfoFrame.Size = UDim2.new(1, 0, 0, 180)
PlayerInfoFrame.BackgroundColor3 = Color3.fromRGB(35, 35, 42)
PlayerInfoFrame.BorderSizePixel = 0
PlayerInfoFrame.LayoutOrder = 1

local PlayerInfoCorner = Instance.new("UICorner", PlayerInfoFrame)
PlayerInfoCorner.CornerRadius = UDim.new(0, 10)

local PlayerImage = Instance.new("ImageLabel", PlayerInfoFrame)
PlayerImage.Size = UDim2.new(0, 120, 0, 140)
PlayerImage.Position = UDim2.new(0, 10, 0, 10)
PlayerImage.BackgroundColor3 = Color3.fromRGB(45, 45, 52)
PlayerImage.BorderSizePixel = 0
PlayerImage.Image = "rbxasset://textures/ui/GuiImagePlaceholder.png"

local PlayerImageCorner = Instance.new("UICorner", PlayerImage)
PlayerImageCorner.CornerRadius = UDim.new(0, 10)

local PlayerName = Instance.new("TextLabel", PlayerInfoFrame)
PlayerName.Size = UDim2.new(1, -145, 0, 22)
PlayerName.Position = UDim2.new(0, 140, 0, 10)
PlayerName.BackgroundTransparency = 1
PlayerName.Text = LocalPlayer.Name
PlayerName.Font = Enum.Font.GothamBold
PlayerName.TextSize = 28
PlayerName.TextColor3 = Color3.fromRGB(255, 255, 255)
PlayerName.TextXAlignment = Enum.TextXAlignment.Left

local FPSLabel = Instance.new("TextLabel", PlayerInfoFrame)
FPSLabel.Size = UDim2.new(1, -145, 0, 18)
FPSLabel.Position = UDim2.new(0, 140, 0, 50)
FPSLabel.BackgroundTransparency = 1
FPSLabel.Text = "FPS: 60"
FPSLabel.Font = Enum.Font.Gotham
FPSLabel.TextSize = 24
FPSLabel.TextColor3 = Color3.fromRGB(180, 180, 180)
FPSLabel.TextXAlignment = Enum.TextXAlignment.Left

local PingLabel = Instance.new("TextLabel", PlayerInfoFrame)
PingLabel.Size = UDim2.new(1, -145, 0, 18)
PingLabel.Position = UDim2.new(0, 140, 0, 90)
PingLabel.BackgroundTransparency = 1
PingLabel.Text = "Ping: 0 ms"
PingLabel.Font = Enum.Font.Gotham
PingLabel.TextSize = 24
PingLabel.TextColor3 = Color3.fromRGB(0, 255, 0)
PingLabel.TextXAlignment = Enum.TextXAlignment.Left

local executor = (identifyexecutor and identifyexecutor()) or 
                 (getexecutorname and getexecutorname()) or 
                 "Unknown Executor"

local ExecutorLabel = Instance.new("TextLabel", PlayerInfoFrame)
ExecutorLabel.Size = UDim2.new(1, -145, 0, 18)
ExecutorLabel.Position = UDim2.new(0, 140, 0, 130)
ExecutorLabel.BackgroundTransparency = 1
ExecutorLabel.Text = "Executor: " .. executor
ExecutorLabel.Font = Enum.Font.Gotham
ExecutorLabel.TextSize = 24
ExecutorLabel.TextColor3 = Color3.fromRGB(255, 0, 125)
ExecutorLabel.TextXAlignment = Enum.TextXAlignment.Left

local GameInfoFrame = Instance.new("Frame", HomeContent)
GameInfoFrame.Size = UDim2.new(1, 0, 0, 220)
GameInfoFrame.BackgroundColor3 = Color3.fromRGB(35, 35, 42)
GameInfoFrame.BorderSizePixel = 0
GameInfoFrame.LayoutOrder = 2

local GameInfoCorner = Instance.new("UICorner", GameInfoFrame)
GameInfoCorner.CornerRadius = UDim.new(0, 10)

local GameImage = Instance.new("ImageLabel", GameInfoFrame)
GameImage.Size = UDim2.new(0, 120, 0, 140)
GameImage.Position = UDim2.new(0, 10, 0, 10)
GameImage.BackgroundColor3 = Color3.fromRGB(45, 45, 52)
GameImage.BorderSizePixel = 0
GameImage.Image = "rbxasset://textures/ui/GuiImagePlaceholder.png"

local GameImageCorner = Instance.new("UICorner", GameImage)
GameImageCorner.CornerRadius = UDim.new(0, 10)

local GameName = Instance.new("TextLabel", GameInfoFrame)
GameName.Size = UDim2.new(1, -20, 0, 24)
GameName.Position = UDim2.new(0, 0, 0, 10)
GameName.BackgroundTransparency = 1
GameName.Text = "Loading..."
GameName.Font = Enum.Font.GothamBold
GameName.TextSize = 24
GameName.TextColor3 = Color3.fromRGB(255, 255, 255)
GameName.TextXAlignment = Enum.TextXAlignment.Center
GameName.TextWrapped = true

local GameId = Instance.new("TextLabel", GameInfoFrame)
GameId.Size = UDim2.new(1, -20, 0, 16)
GameId.Position = UDim2.new(0, 27.5, 0, 50)
GameId.BackgroundTransparency = 1
GameId.Text = "Game ID: " .. game.PlaceId
GameId.Font = Enum.Font.Gotham
GameId.TextSize = 24
GameId.TextColor3 = Color3.fromRGB(180, 180, 255)
GameId.TextXAlignment = Enum.TextXAlignment.Center

local PlayersInServerLabel = Instance.new("TextLabel", GameInfoFrame)
PlayersInServerLabel.Size = UDim2.new(1, -20, 0, 16)
PlayersInServerLabel.Position = UDim2.new(0, 27.5, 0, 90)
PlayersInServerLabel.BackgroundTransparency = 1
PlayersInServerLabel.Text = "Players in the server: " .. #Players:GetPlayers()
PlayersInServerLabel.Font = Enum.Font.Gotham
PlayersInServerLabel.TextSize = 24
PlayersInServerLabel.TextColor3 = Color3.fromRGB(180, 255, 180)
PlayersInServerLabel.TextXAlignment = Enum.TextXAlignment.Center

local serverId = game.JobId

local ServerIdLabel = Instance.new("TextLabel", GameInfoFrame)
ServerIdLabel.Size = UDim2.new(1, 0, 0, 18)
ServerIdLabel.Position = UDim2.new(0, 55, 0, 130)
ServerIdLabel.BackgroundTransparency = 1
ServerIdLabel.Text = "Server ID: " .. serverId
ServerIdLabel.Font = Enum.Font.Gotham
ServerIdLabel.TextSize = 14
ServerIdLabel.TextColor3 = Color3.fromRGB(255, 180, 180)
ServerIdLabel.TextXAlignment = Enum.TextXAlignment.Center

local AntiAFKContainer = Instance.new("Frame", AntiAFKContent)
AntiAFKContainer.Size = UDim2.new(1, 0, 0, 380)
AntiAFKContainer.BackgroundColor3 = Color3.fromRGB(35, 35, 42)
AntiAFKContainer.BorderSizePixel = 0
AntiAFKContainer.LayoutOrder = 1

local AntiAFKCorner = Instance.new("UICorner", AntiAFKContainer)
AntiAFKCorner.CornerRadius = UDim.new(0, 10)

local AntiAFKTitle = Instance.new("TextLabel", AntiAFKContainer)
AntiAFKTitle.Size = UDim2.new(1, -20, 0, 24)
AntiAFKTitle.Position = UDim2.new(0, 10, 0, 10)
AntiAFKTitle.BackgroundTransparency = 1
AntiAFKTitle.Text = "Anti-AFK Methods"
AntiAFKTitle.Font = Enum.Font.GothamBold
AntiAFKTitle.TextSize = 16
AntiAFKTitle.TextColor3 = Color3.fromRGB(255, 255, 255)
AntiAFKTitle.TextXAlignment = Enum.TextXAlignment.Left

local JumpToggle = CreateButton(AntiAFKContainer, UDim2.new(0, 140, 0, 36), "Auto Jump: OFF")
JumpToggle.Position = UDim2.new(0.25, 0, 0, 50)

local ClickToggle = CreateButton(AntiAFKContainer, UDim2.new(0, 140, 0, 36), "Auto Click: OFF")
ClickToggle.Position = UDim2.new(0.75, 0, 0, 50)

local ClickTypeLabel = Instance.new("TextLabel", AntiAFKContainer)
ClickTypeLabel.Size = UDim2.new(1, -20, 0, 20)
ClickTypeLabel.Position = UDim2.new(0, 10, 0, 100)
ClickTypeLabel.BackgroundTransparency = 1
ClickTypeLabel.Text = "Click Type:"
ClickTypeLabel.Font = Enum.Font.Gotham
ClickTypeLabel.TextSize = 13
ClickTypeLabel.TextColor3 = Color3.fromRGB(180, 180, 180)
ClickTypeLabel.TextXAlignment = Enum.TextXAlignment.Left

local ClickTypeCurrent = CreateButton(AntiAFKContainer, UDim2.new(0, 85, 0, 30), "Current")
ClickTypeCurrent.Position = UDim2.new(0.2, 0, 0, 130)

local ClickTypeCenter = CreateButton(AntiAFKContainer, UDim2.new(0, 85, 0, 30), "Center")
ClickTypeCenter.Position = UDim2.new(0.5, 0, 0, 130)

local ClickTypeRandom = CreateButton(AntiAFKContainer, UDim2.new(0, 85, 0, 30), "Random")
ClickTypeRandom.Position = UDim2.new(0.8, 0, 0, 130)

local JumpDelayFrame, JumpDelaySlider, JumpSliderFill, JumpSliderButton, JumpDelayBox, JumpDelayLabel = CreateSlider(AntiAFKContainer, UDim2.new(1, -20, 0, 50), 5, 30, 10, "Jump Delay (seconds):")
JumpDelayFrame.Position = UDim2.new(0, 10, 0, 180)

local ClickDelayFrame, ClickDelaySlider, ClickSliderFill, ClickSliderButton, ClickDelayBox, ClickDelayLabel = CreateSlider(AntiAFKContainer, UDim2.new(1, -20, 0, 50), 1, 10, 3, "Click Delay (seconds):")
ClickDelayFrame.Position = UDim2.new(0, 10, 0, 250)

local AntiAFKStatus = Instance.new("TextLabel", AntiAFKContainer)
AntiAFKStatus.Size = UDim2.new(1, -20, 0, 50)
AntiAFKStatus.Position = UDim2.new(0, 10, 0, 320)
AntiAFKStatus.BackgroundTransparency = 1
AntiAFKStatus.Text = "Status: All Inactive"
AntiAFKStatus.Font = Enum.Font.GothamBold
AntiAFKStatus.TextSize = 16
AntiAFKStatus.TextColor3 = Color3.fromRGB(180, 180, 180)
AntiAFKStatus.TextXAlignment = Enum.TextXAlignment.Center

local KeySpamContainer = Instance.new("Frame", KeySpamContent)
KeySpamContainer.Size = UDim2.new(1, 0, 0, 280)
KeySpamContainer.BackgroundColor3 = Color3.fromRGB(35, 35, 42)
KeySpamContainer.BorderSizePixel = 0
KeySpamContainer.LayoutOrder = 1

local KeySpamCorner = Instance.new("UICorner", KeySpamContainer)
KeySpamCorner.CornerRadius = UDim.new(0, 10)

local KeySpamTitle = Instance.new("TextLabel", KeySpamContainer)
KeySpamTitle.Size = UDim2.new(1, -20, 0, 24)
KeySpamTitle.Position = UDim2.new(0, 10, 0, 10)
KeySpamTitle.BackgroundTransparency = 1
KeySpamTitle.Text = "Key Spam Configuration"
KeySpamTitle.Font = Enum.Font.GothamBold
KeySpamTitle.TextSize = 16
KeySpamTitle.TextColor3 = Color3.fromRGB(255, 255, 255)
KeySpamTitle.TextXAlignment = Enum.TextXAlignment.Left

local SpamInput = Instance.new("TextBox", KeySpamContainer)
SpamInput.Size = UDim2.new(1, -20, 0, 40)
SpamInput.Position = UDim2.new(0, 10, 0, 50)
SpamInput.BackgroundColor3 = Color3.fromRGB(45, 45, 52)
SpamInput.Text = Config.SpamKey
SpamInput.PlaceholderText = "Enter key (A-Z, 0-9, F1-F12)"
SpamInput.Font = Enum.Font.Gotham
SpamInput.TextSize = 14
SpamInput.TextColor3 = Color3.fromRGB(255, 255, 255)
SpamInput.PlaceholderColor3 = Color3.fromRGB(120, 120, 120)
SpamInput.BorderSizePixel = 0
SpamInput.ClearTextOnFocus = false

local SpamInputCorner = Instance.new("UICorner", SpamInput)
SpamInputCorner.CornerRadius = UDim.new(0, 8)

local SpamDelayFrame, SpamDelaySlider, SpamSliderFill, SpamSliderButton, SpamDelayBox, SpamDelayLabel = CreateSlider(KeySpamContainer, UDim2.new(1, -20, 0, 50), 0.05, 5, 0.1, "Spam Delay (seconds):")
SpamDelayFrame.Position = UDim2.new(0, 10, 0, 110)

local AutoSpamToggle = CreateButton(KeySpamContainer, UDim2.new(0, 120, 0, 36), "OFF")
AutoSpamToggle.Position = UDim2.new(0.5, 0, 0, 185)

local AutoSpamStatus = Instance.new("TextLabel", KeySpamContainer)
AutoSpamStatus.Size = UDim2.new(1, -20, 0, 50)
AutoSpamStatus.Position = UDim2.new(0, 10, 0, 225)
AutoSpamStatus.BackgroundTransparency = 1
AutoSpamStatus.Text = "Status: Inactive"
AutoSpamStatus.Font = Enum.Font.GothamBold
AutoSpamStatus.TextSize = 16
AutoSpamStatus.TextColor3 = Color3.fromRGB(180, 180, 180)
AutoSpamStatus.TextXAlignment = Enum.TextXAlignment.Center

local FPSContainer = Instance.new("Frame", FPSContent)
FPSContainer.Size = UDim2.new(1, 0, 0, 520)
FPSContainer.BackgroundColor3 = Color3.fromRGB(35, 35, 42)
FPSContainer.BorderSizePixel = 0
FPSContainer.LayoutOrder = 1

local FPSContainerCorner = Instance.new("UICorner", FPSContainer)
FPSContainerCorner.CornerRadius = UDim.new(0, 10)

local FPSTitle = Instance.new("TextLabel", FPSContainer)
FPSTitle.Size = UDim2.new(1, -20, 0, 24)
FPSTitle.Position = UDim2.new(0, 10, 0, 10)
FPSTitle.BackgroundTransparency = 1
FPSTitle.Text = "Performance Analytics"
FPSTitle.Font = Enum.Font.GothamBold
FPSTitle.TextSize = 16
FPSTitle.TextColor3 = Color3.fromRGB(255, 255, 255)
FPSTitle.TextXAlignment = Enum.TextXAlignment.Left

local FPSUnlockToggle = CreateButton(FPSContainer, UDim2.new(0, 160, 0, 36), "FPS Unlock: OFF")
FPSUnlockToggle.Position = UDim2.new(0.5, 0, 0, 50)

local FPSUnlockStatus = Instance.new("TextLabel", FPSContainer)
FPSUnlockStatus.Size = UDim2.new(1, -20, 0, 24)
FPSUnlockStatus.Position = UDim2.new(0, 10, 0, 96)
FPSUnlockStatus.BackgroundTransparency = 1
FPSUnlockStatus.Text = "Target: 60 FPS"
FPSUnlockStatus.Font = Enum.Font.Gotham
FPSUnlockStatus.TextSize = 16
FPSUnlockStatus.TextColor3 = Color3.fromRGB(180, 180, 180)
FPSUnlockStatus.TextXAlignment = Enum.TextXAlignment.Center

local FPSValueFrame, FPSSlider, FPSFill, FPSButton, FPSValueBox, FPSValueLabel = CreateSlider(FPSContainer, UDim2.new(1, -20, 0, 50), 15, 360, 60, "Target FPS:")
FPSValueFrame.Position = UDim2.new(0, 10, 0, 130)

local FPSStatsFrame = Instance.new("Frame", FPSContainer)
FPSStatsFrame.Size = UDim2.new(1, -20, 0, 45)
FPSStatsFrame.Position = UDim2.new(0, 10, 0, 190)
FPSStatsFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 35)
FPSStatsFrame.BorderSizePixel = 0

local FPSStatsCorner = Instance.new("UICorner", FPSStatsFrame)
FPSStatsCorner.CornerRadius = UDim.new(0, 8)

local CurrentFPSLabel = Instance.new("TextLabel", FPSStatsFrame)
CurrentFPSLabel.Size = UDim2.new(0.33, 0, 1, 0)
CurrentFPSLabel.BackgroundTransparency = 1
CurrentFPSLabel.Text = "Current: 60"
CurrentFPSLabel.Font = Enum.Font.GothamBold
CurrentFPSLabel.TextSize = 12
CurrentFPSLabel.TextColor3 = Color3.fromRGB(100, 200, 255)
CurrentFPSLabel.TextXAlignment = Enum.TextXAlignment.Center

local AvgFPSLabel = Instance.new("TextLabel", FPSStatsFrame)
AvgFPSLabel.Size = UDim2.new(0.33, 0, 1, 0)
AvgFPSLabel.Position = UDim2.new(0.33, 0, 0, 0)
AvgFPSLabel.BackgroundTransparency = 1
AvgFPSLabel.Text = "Average: 60"
AvgFPSLabel.Font = Enum.Font.GothamBold
AvgFPSLabel.TextSize = 12
AvgFPSLabel.TextColor3 = Color3.fromRGB(50, 220, 100)
AvgFPSLabel.TextXAlignment = Enum.TextXAlignment.Center

local MinMaxFPSLabel = Instance.new("TextLabel", FPSStatsFrame)
MinMaxFPSLabel.Size = UDim2.new(0.34, 0, 1, 0)
MinMaxFPSLabel.Position = UDim2.new(0.66, 0, 0, 0)
MinMaxFPSLabel.BackgroundTransparency = 1
MinMaxFPSLabel.Text = "Min: 60 | Max: 60"
MinMaxFPSLabel.Font = Enum.Font.GothamBold
MinMaxFPSLabel.TextSize = 12
MinMaxFPSLabel.TextColor3 = Color3.fromRGB(255, 200, 100)
MinMaxFPSLabel.TextXAlignment = Enum.TextXAlignment.Center

local PingStatsFrame = Instance.new("Frame", FPSContainer)
PingStatsFrame.Size = UDim2.new(1, -20, 0, 45)
PingStatsFrame.Position = UDim2.new(0, 10, 0, 250)
PingStatsFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 35)
PingStatsFrame.BorderSizePixel = 0

local PingStatsCorner = Instance.new("UICorner", PingStatsFrame)
PingStatsCorner.CornerRadius = UDim.new(0, 8)

local CurrentPingLabel = Instance.new("TextLabel", PingStatsFrame)
CurrentPingLabel.Size = UDim2.new(0.33, 0, 1, 0)
CurrentPingLabel.BackgroundTransparency = 1
CurrentPingLabel.Text = "Current: 0ms"
CurrentPingLabel.Font = Enum.Font.GothamBold
CurrentPingLabel.TextSize = 12
CurrentPingLabel.TextColor3 = Color3.fromRGB(100, 200, 255)
CurrentPingLabel.TextXAlignment = Enum.TextXAlignment.Center

local AvgPingLabel = Instance.new("TextLabel", PingStatsFrame)
AvgPingLabel.Size = UDim2.new(0.33, 0, 1, 0)
AvgPingLabel.Position = UDim2.new(0.33, 0, 0, 0)
AvgPingLabel.BackgroundTransparency = 1
AvgPingLabel.Text = "Average: 0ms"
AvgPingLabel.Font = Enum.Font.GothamBold
AvgPingLabel.TextSize = 12
AvgPingLabel.TextColor3 = Color3.fromRGB(50, 220, 100)
AvgPingLabel.TextXAlignment = Enum.TextXAlignment.Center

local MinMaxPingLabel = Instance.new("TextLabel", PingStatsFrame)
MinMaxPingLabel.Size = UDim2.new(0.34, 0, 1, 0)
MinMaxPingLabel.Position = UDim2.new(0.66, 0, 0, 0)
MinMaxPingLabel.BackgroundTransparency = 1
MinMaxPingLabel.Text = "Min: 0ms | Max: 0ms"
MinMaxPingLabel.Font = Enum.Font.GothamBold
MinMaxPingLabel.TextSize = 12
MinMaxPingLabel.TextColor3 = Color3.fromRGB(255, 200, 100)
MinMaxPingLabel.TextXAlignment = Enum.TextXAlignment.Center

local NetworkStatusFrame = Instance.new("Frame", FPSContainer)
NetworkStatusFrame.Size = UDim2.new(1, -20, 0, 45)
NetworkStatusFrame.Position = UDim2.new(0, 10, 0, 310)
NetworkStatusFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 35)
NetworkStatusFrame.BorderSizePixel = 0

local NetworkStatusCorner = Instance.new("UICorner", NetworkStatusFrame)
NetworkStatusCorner.CornerRadius = UDim.new(0, 8)

local NetworkStatusLabel = Instance.new("TextLabel", NetworkStatusFrame)
NetworkStatusLabel.Size = UDim2.new(0.5, 0, 1, 0)
NetworkStatusLabel.BackgroundTransparency = 1
NetworkStatusLabel.Text = "Network Status:"
NetworkStatusLabel.Font = Enum.Font.GothamBold
NetworkStatusLabel.TextSize = 13
NetworkStatusLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
NetworkStatusLabel.TextXAlignment = Enum.TextXAlignment.Center

local NetworkQualityLabel = Instance.new("TextLabel", NetworkStatusFrame)
NetworkQualityLabel.Size = UDim2.new(0.5, 0, 1, 0)
NetworkQualityLabel.Position = UDim2.new(0.5, 0, 0, 0)
NetworkQualityLabel.BackgroundTransparency = 1
NetworkQualityLabel.Text = "Excellent"
NetworkQualityLabel.Font = Enum.Font.GothamBold
NetworkQualityLabel.TextSize = 13
NetworkQualityLabel.TextColor3 = Color3.fromRGB(50, 220, 100)
NetworkQualityLabel.TextXAlignment = Enum.TextXAlignment.Center

local PerformanceInfo = Instance.new("TextLabel", FPSContainer)
PerformanceInfo.Size = UDim2.new(1, -20, 0, 135)
PerformanceInfo.Position = UDim2.new(0, 10, 0, 370)
PerformanceInfo.BackgroundColor3 = Color3.fromRGB(30, 30, 35)
PerformanceInfo.BorderSizePixel = 0
PerformanceInfo.Text = "Performance monitoring provides real-time statistics about your game's FPS and network latency.\n\nUse FPS Unlock to increase the frame rate cap beyond Roblox's default 60 FPS limit.\n\nLocking your FPS into small values may result in a lower memory consumption from Roblox but will also decrease the game quality."
PerformanceInfo.Font = Enum.Font.Gotham
PerformanceInfo.TextScaled = true
PerformanceInfo.TextColor3 = Color3.fromRGB(255, 200, 150)
PerformanceInfo.TextWrapped = true
PerformanceInfo.TextXAlignment = Enum.TextXAlignment.Left
PerformanceInfo.TextYAlignment = Enum.TextYAlignment.Top

local PerformanceInfoCorner = Instance.new("UICorner", PerformanceInfo)
PerformanceInfoCorner.CornerRadius = UDim.new(0, 8)

local PerformanceInfoPadding = Instance.new("UIPadding", PerformanceInfo)
PerformanceInfoPadding.PaddingLeft = UDim.new(0, 10)
PerformanceInfoPadding.PaddingRight = UDim.new(0, 10)
PerformanceInfoPadding.PaddingTop = UDim.new(0, 10)
PerformanceInfoPadding.PaddingBottom = UDim.new(0, 10)

local RejoinContainer = Instance.new("Frame", RejoinContent)
RejoinContainer.Size = UDim2.new(1, 0, 0, 200)
RejoinContainer.BackgroundColor3 = Color3.fromRGB(35, 35, 42)
RejoinContainer.BorderSizePixel = 0
RejoinContainer.LayoutOrder = 1

local RejoinCorner = Instance.new("UICorner", RejoinContainer)
RejoinCorner.CornerRadius = UDim.new(0, 10)

local RejoinTitle = Instance.new("TextLabel", RejoinContainer)
RejoinTitle.Size = UDim2.new(1, -20, 0, 24)
RejoinTitle.Position = UDim2.new(0, 10, 0, 10)
RejoinTitle.BackgroundTransparency = 1
RejoinTitle.Text = "Auto Rejoin"
RejoinTitle.Font = Enum.Font.GothamBold
RejoinTitle.TextSize = 16
RejoinTitle.TextColor3 = Color3.fromRGB(255, 255, 255)
RejoinTitle.TextXAlignment = Enum.TextXAlignment.Left

local AutoRejoinToggle = CreateButton(RejoinContainer, UDim2.new(0, 180, 0, 40), "Auto Rejoin: OFF")
AutoRejoinToggle.Position = UDim2.new(0.5, 0, 0, 60)

local AutoRejoinStatus = Instance.new("TextLabel", RejoinContainer)
AutoRejoinStatus.Size = UDim2.new(1, -20, 0, 70)
AutoRejoinStatus.Position = UDim2.new(0, 10, 0, 120)
AutoRejoinStatus.BackgroundTransparency = 1
AutoRejoinStatus.Text = "Status: Disabled\n\nAutomatically rejoins the game when you get disconnected.\nUseful for preventing AFK kicks."
AutoRejoinStatus.Font = Enum.Font.Gotham
AutoRejoinStatus.TextSize = 16
AutoRejoinStatus.TextColor3 = Color3.fromRGB(180, 180, 180)
AutoRejoinStatus.TextXAlignment = Enum.TextXAlignment.Center
AutoRejoinStatus.TextWrapped = true

local LoaderContainer = Instance.new("Frame", LoaderContent)
LoaderContainer.Size = UDim2.new(1, 0, 0, 350)
LoaderContainer.BackgroundColor3 = Color3.fromRGB(35, 35, 42)
LoaderContainer.BorderSizePixel = 0
LoaderContainer.LayoutOrder = 1

local LoaderCorner = Instance.new("UICorner", LoaderContainer)
LoaderCorner.CornerRadius = UDim.new(0, 10)

local LoaderTitle = Instance.new("TextLabel", LoaderContainer)
LoaderTitle.Size = UDim2.new(1, -20, 0, 24)
LoaderTitle.Position = UDim2.new(0, 10, 0, 10)
LoaderTitle.BackgroundTransparency = 1
LoaderTitle.Text = "Script Loader"
LoaderTitle.Font = Enum.Font.GothamBold
LoaderTitle.TextSize = 16
LoaderTitle.TextColor3 = Color3.fromRGB(255, 255, 255)
LoaderTitle.TextXAlignment = Enum.TextXAlignment.Left

local CodeEditorFrame = Instance.new("Frame", LoaderContainer)
CodeEditorFrame.Size = UDim2.new(1, -20, 0, 200)
CodeEditorFrame.Position = UDim2.new(0, 10, 0, 45)
CodeEditorFrame.BackgroundColor3 = Color3.fromRGB(45, 45, 52)
CodeEditorFrame.BorderSizePixel = 0

local CodeEditorCorner = Instance.new("UICorner", CodeEditorFrame)
CodeEditorCorner.CornerRadius = UDim.new(0, 8)

local LineNumbersScrollFrame = Instance.new("ScrollingFrame", CodeEditorFrame)
LineNumbersScrollFrame.Size = UDim2.new(0, 40, 1, 0)
LineNumbersScrollFrame.BackgroundColor3 = Color3.fromRGB(35, 35, 40)
LineNumbersScrollFrame.BorderSizePixel = 0
LineNumbersScrollFrame.ScrollBarThickness = 0
LineNumbersScrollFrame.ScrollingEnabled = false
LineNumbersScrollFrame.CanvasSize = UDim2.new(0, 0, 0, 200)

local LineNumbersCorner = Instance.new("UICorner", LineNumbersScrollFrame)
LineNumbersCorner.CornerRadius = UDim.new(0, 8)

local LineNumbers = Instance.new("TextLabel", LineNumbersScrollFrame)
LineNumbers.Size = UDim2.new(1, -5, 1, 0)
LineNumbers.BackgroundTransparency = 1
LineNumbers.Text = "1"
LineNumbers.Font = Enum.Font.Code
LineNumbers.TextSize = 12
LineNumbers.TextColor3 = Color3.fromRGB(120, 120, 120)
LineNumbers.TextXAlignment = Enum.TextXAlignment.Right
LineNumbers.TextYAlignment = Enum.TextYAlignment.Top

local Separator = Instance.new("Frame", CodeEditorFrame)
Separator.Size = UDim2.new(0, 1, 1, 0)
Separator.Position = UDim2.new(0, 40, 0, 0)
Separator.BackgroundColor3 = Color3.fromRGB(60, 60, 70)
Separator.BorderSizePixel = 0

local LoadStringScrollFrame = Instance.new("ScrollingFrame", CodeEditorFrame)
LoadStringScrollFrame.Size = UDim2.new(1, -41, 1, 0)
LoadStringScrollFrame.Position = UDim2.new(0, 41, 0, 0)
LoadStringScrollFrame.BackgroundTransparency = 1
LoadStringScrollFrame.BorderSizePixel = 0
LoadStringScrollFrame.ScrollBarThickness = 4
LoadStringScrollFrame.ScrollBarImageColor3 = Color3.fromRGB(100, 150, 255)
LoadStringScrollFrame.ScrollBarImageTransparency = 0.5
LoadStringScrollFrame.CanvasSize = UDim2.new(0, 0, 0, 200)

local LoadStringBox = Instance.new("TextBox", LoadStringScrollFrame)
LoadStringBox.Size = UDim2.new(1, -10, 1, 0)
LoadStringBox.Position = UDim2.new(0, 5, 0, 0)
LoadStringBox.BackgroundTransparency = 1
LoadStringBox.Text = Config.SavedCode
LoadStringBox.PlaceholderText = "Paste your code here..."
LoadStringBox.Font = Enum.Font.Code
LoadStringBox.TextSize = 12
LoadStringBox.TextColor3 = Color3.fromRGB(255, 255, 255)
LoadStringBox.PlaceholderColor3 = Color3.fromRGB(120, 120, 120)
LoadStringBox.BorderSizePixel = 0
LoadStringBox.TextWrapped = true
LoadStringBox.TextXAlignment = Enum.TextXAlignment.Left
LoadStringBox.TextYAlignment = Enum.TextYAlignment.Top
LoadStringBox.MultiLine = true
LoadStringBox.ClearTextOnFocus = false
LoadStringBox.TextEditable = true

local ExecuteButton = CreateButton(LoaderContainer, UDim2.new(0, 200, 0, 40), "Execute Script")
ExecuteButton.Position = UDim2.new(0.5, 0, 0, 265)

local LoadStringStatus = Instance.new("TextLabel", LoaderContainer)
LoadStringStatus.Size = UDim2.new(1, -20, 0, 30)
LoadStringStatus.Position = UDim2.new(0, 10, 0, 310)
LoadStringStatus.BackgroundTransparency = 1
LoadStringStatus.Text = "Status: Ready"
LoadStringStatus.Font = Enum.Font.Gotham
LoadStringStatus.TextSize = 16
LoadStringStatus.TextColor3 = Color3.fromRGB(180, 180, 180)
LoadStringStatus.TextXAlignment = Enum.TextXAlignment.Center

local SettingsContainer = Instance.new("Frame", SettingsContent)
SettingsContainer.Size = UDim2.new(1, 0, 0, 180)
SettingsContainer.BackgroundColor3 = Color3.fromRGB(35, 35, 42)
SettingsContainer.BorderSizePixel = 0
SettingsContainer.LayoutOrder = 1

local SettingsCorner = Instance.new("UICorner", SettingsContainer)
SettingsCorner.CornerRadius = UDim.new(0, 10)

local SettingsTitle = Instance.new("TextLabel", SettingsContainer)
SettingsTitle.Size = UDim2.new(1, -20, 0, 24)
SettingsTitle.Position = UDim2.new(0, 10, 0, 10)
SettingsTitle.BackgroundTransparency = 1
SettingsTitle.Text = "UI Settings"
SettingsTitle.Font = Enum.Font.GothamBold
SettingsTitle.TextSize = 16
SettingsTitle.TextColor3 = Color3.fromRGB(255, 255, 255)
SettingsTitle.TextXAlignment = Enum.TextXAlignment.Left

local KeybindButton = CreateButton(SettingsContainer, UDim2.new(0, 220, 0, 40), "Toggle Keybind: G")
KeybindButton.Position = UDim2.new(0.5, 0, 0, 60)

local KeybindStatus = Instance.new("TextLabel", SettingsContainer)
KeybindStatus.Size = UDim2.new(1, -20, 0, 60)
KeybindStatus.Position = UDim2.new(0, 10, 0, 115)
KeybindStatus.BackgroundTransparency = 1
KeybindStatus.Text = "Click the button above to change your Toggle Keybind\n\nPress the keybind at any time to open / close this menu."
KeybindStatus.Font = Enum.Font.Gotham
KeybindStatus.TextSize = 16
KeybindStatus.TextColor3 = Color3.fromRGB(150, 150, 150)
KeybindStatus.TextXAlignment = Enum.TextXAlignment.Center
KeybindStatus.TextWrapped = true

local ReopenButton = Instance.new("ImageButton", ScreenGui)
ReopenButton.Name = "ReopenButton"
ReopenButton.Size = UDim2.new(0, 0, 0, 0)
ReopenButton.Position = UDim2.new(0.5, 0, 0, 30)
ReopenButton.BackgroundColor3 = Color3.fromRGB(100, 150, 255)
ReopenButton.BorderSizePixel = 0
ReopenButton.Visible = false
ReopenButton.ZIndex = 10

local ReopenCorner = Instance.new("UICorner", ReopenButton)
ReopenCorner.CornerRadius = UDim.new(1, 0)

local ReopenIcon = Instance.new("TextLabel", ReopenButton)
ReopenIcon.Size = UDim2.new(1, 0, 1, 0)
ReopenIcon.BackgroundTransparency = 1
ReopenIcon.Text = "‚ö°"
ReopenIcon.Font = Enum.Font.GothamBold
ReopenIcon.TextSize = 24
ReopenIcon.TextColor3 = Color3.fromRGB(255, 255, 255)

local function UpdateLineNumbers()
    local text = LoadStringBox.Text
    local lineCount = 1
    for _ in text:gmatch("\n") do
        lineCount = lineCount + 1
    end
    
    local lineNumberText = ""
    for i = 1, lineCount do
        lineNumberText = lineNumberText .. i .. "\n"
    end
    LineNumbers.Text = lineNumberText
    
    local textBounds = game:GetService("TextService"):GetTextSize(
        LoadStringBox.Text,
        LoadStringBox.TextSize,
        LoadStringBox.Font,
        Vector2.new(LoadStringBox.AbsoluteSize.X - 10, math.huge)
    )
    local newHeight = math.max(200, textBounds.Y + 20)
    LoadStringBox.Size = UDim2.new(1, -10, 0, newHeight)
    LoadStringScrollFrame.CanvasSize = UDim2.new(0, 0, 0, newHeight)
    LineNumbersScrollFrame.CanvasSize = UDim2.new(0, 0, 0, newHeight)
    LineNumbers.Size = UDim2.new(1, -5, 0, newHeight)
end

LoadStringScrollFrame:GetPropertyChangedSignal("CanvasPosition"):Connect(function()
    LineNumbersScrollFrame.CanvasPosition = Vector2.new(0, LoadStringScrollFrame.CanvasPosition.Y)
end)

LoadStringBox:GetPropertyChangedSignal("Text"):Connect(UpdateLineNumbers)

UpdateLineNumbers()

local function UpdateSlider(fill, valueBox, labelElement, value, min, max, format)
    local percentage = (value - min) / (max - min)
    TweenService:Create(fill, TweenPresets.Fast, {Size = UDim2.new(percentage, 0, 1, 0)}):Play()
    valueBox.Text = string.format(format, value)
end

local function UpdateJumpSlider(percentage)
    Config.JumpDelay = 5 + (percentage * 25)
    UpdateSlider(JumpSliderFill, JumpDelayBox, JumpDelayLabel, Config.JumpDelay, 5, 30, "%.1f")
    SaveConfig()
end

local function UpdateClickSlider(percentage)
    Config.ClickDelay = 1 + (percentage * 9)
    UpdateSlider(ClickSliderFill, ClickDelayBox, ClickDelayLabel, Config.ClickDelay, 1, 10, "%.1f")
    SaveConfig()
end

local function UpdateSpamSlider(percentage)
    Config.SpamDelay = 0.05 + (percentage * 4.95)
    UpdateSlider(SpamSliderFill, SpamDelayBox, SpamDelayLabel, Config.SpamDelay, 0.05, 5, "%.2f")
    SaveConfig()
end

local function UpdateFPSSlider(percentage)
    Config.TargetFPS = math.floor(15 + (percentage * 345))
    UpdateSlider(FPSFill, FPSValueBox, FPSValueLabel, Config.TargetFPS, 15, 360, "%d")
    if Config.FPSUnlockEnabled and FPS_SUPPORTED then
        setfpscap(Config.TargetFPS)
        FPSUnlockStatus.Text = "Your target: " .. Config.TargetFPS .. " FPS"
    end
    SaveConfig()
end

JumpDelayBox.FocusLost:Connect(function()
    local value = math.clamp(tonumber(JumpDelayBox.Text) or Config.JumpDelay, 5, 30)
    Config.JumpDelay = value
    UpdateJumpSlider((value - 5) / 25)
end)

ClickDelayBox.FocusLost:Connect(function()
    local value = math.clamp(tonumber(ClickDelayBox.Text) or Config.ClickDelay, 1, 10)
    Config.ClickDelay = value
    UpdateClickSlider((value - 1) / 9)
end)

SpamDelayBox.FocusLost:Connect(function()
    local value = math.clamp(tonumber(SpamDelayBox.Text) or Config.SpamDelay, 0.05, 5)
    Config.SpamDelay = value
    UpdateSpamSlider((value - 0.05) / 4.95)
end)

FPSValueBox.FocusLost:Connect(function()
    local value = math.clamp(tonumber(FPSValueBox.Text) or Config.TargetFPS, 15, 360)
    Config.TargetFPS = value
    UpdateFPSSlider((value - 15) / 345)
end)

SpamInput.FocusLost:Connect(function()
    Config.SpamKey = SpamInput.Text:upper()
    SaveConfig()
end)

local dragging = {jump = false, click = false, spam = false, fps = false}

JumpSliderButton.MouseButton1Down:Connect(function()
    dragging.jump = true
end)

ClickSliderButton.MouseButton1Down:Connect(function()
    dragging.click = true
end)

SpamSliderButton.MouseButton1Down:Connect(function()
    dragging.spam = true
end)

FPSButton.MouseButton1Down:Connect(function()
    dragging.fps = true
end)

UserInputService.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging.jump, dragging.click, dragging.spam, dragging.fps = false, false, false, false
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement then
        local mouseX = UserInputService:GetMouseLocation().X
        if dragging.jump then
            UpdateJumpSlider(math.clamp((mouseX - JumpDelaySlider.AbsolutePosition.X) / JumpDelaySlider.AbsoluteSize.X, 0, 1))
        elseif dragging.click then
            UpdateClickSlider(math.clamp((mouseX - ClickDelaySlider.AbsolutePosition.X) / ClickDelaySlider.AbsoluteSize.X, 0, 1))
        elseif dragging.spam then
            UpdateSpamSlider(math.clamp((mouseX - SpamDelaySlider.AbsolutePosition.X) / SpamDelaySlider.AbsoluteSize.X, 0, 1))
        elseif dragging.fps then
            UpdateFPSSlider(math.clamp((mouseX - FPSSlider.AbsolutePosition.X) / FPSSlider.AbsoluteSize.X, 0, 1))
        end
    end
end)

local function CleanupAllThreads()
    for threadType, thread in pairs(ActiveThreads) do
        if thread then
            if coroutine.status(thread) ~= "dead" then
                task.cancel(thread)
            end
            ActiveThreads[threadType] = nil
        end
    end
end

local function StopThread(threadType)
    if ActiveThreads[threadType] then
        local thread = ActiveThreads[threadType]
        ActiveThreads[threadType] = nil
        if coroutine.status(thread) ~= "dead" then
            task.cancel(thread)
        end
    end
end

local function StopJumpThread()
    StopThread("Jump")
end

local function StopClickThread()
    StopThread("Click")
end

local function StopSpamThread()
    StopThread("Spam")
end

local function StartJumpThread()
    StopJumpThread()
    ActiveThreads.Jump = task.spawn(function()
        while Config.JumpEnabled do
            task.wait(Config.JumpDelay)
            if Config.JumpEnabled and LocalPlayer.Character then
                local humanoid = LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
                if humanoid then
                    humanoid:ChangeState(Enum.HumanoidStateType.Jumping)
                end
            end
        end
        ActiveThreads.Jump = nil
    end)
end

local function StartClickThread()
    StopClickThread()
    ActiveThreads.Click = task.spawn(function()
        while Config.ClickEnabled do
            task.wait(Config.ClickDelay)
            if Config.ClickEnabled then
                local x, y
                if Config.ClickType == "Current" then
                    local mousePos = UserInputService:GetMouseLocation()
                    x, y = mousePos.X, mousePos.Y
                elseif Config.ClickType == "Center" then
                    local viewport = workspace.CurrentCamera.ViewportSize
                    x, y = viewport.X/2, viewport.Y/2
                else
                    local viewport = workspace.CurrentCamera.ViewportSize
                    x, y = math.random(100, viewport.X - 100), math.random(100, viewport.Y - 100)
                end
                VirtualInputManager:SendMouseButtonEvent(x, y, 0, true, game, 0)
                task.wait(0.05)
                VirtualInputManager:SendMouseButtonEvent(x, y, 0, false, game, 0)
            end
        end
        ActiveThreads.Click = nil
    end)
end

local function StartSpamThread()
    StopSpamThread()
    local keyText = SpamInput.Text:upper()
    local keyCode = KeyCodeMap[keyText]
    if not keyCode then return end
    
    ActiveThreads.Spam = task.spawn(function()
        while Config.AutoSpamEnabled do
            task.wait(Config.SpamDelay)
            if Config.AutoSpamEnabled then
                VirtualInputManager:SendKeyEvent(true, keyCode, false, game)
                task.wait(0.05)
                VirtualInputManager:SendKeyEvent(false, keyCode, false, game)
            end
        end
        ActiveThreads.Spam = nil
    end)
end

local function UpdateAntiAFKStatus()
    if Config.JumpEnabled and Config.ClickEnabled then
        AntiAFKStatus.Text = "Status: Jump & Click Active"
        AntiAFKStatus.TextColor3 = Color3.fromRGB(50, 220, 100)
    elseif Config.JumpEnabled then
        AntiAFKStatus.Text = "Status: Jump Active"
        AntiAFKStatus.TextColor3 = Color3.fromRGB(100, 200, 255)
    elseif Config.ClickEnabled then
        AntiAFKStatus.Text = "Status: Click Active"
        AntiAFKStatus.TextColor3 = Color3.fromRGB(255, 200, 100)
    else
        AntiAFKStatus.Text = "Status: All Inactive"
        AntiAFKStatus.TextColor3 = Color3.fromRGB(180, 180, 180)
    end
end

local function UpdateClickTypeButtons()
    local buttons = {Current = ClickTypeCurrent, Center = ClickTypeCenter, Random = ClickTypeRandom}
    for type, btn in pairs(buttons) do
        TweenService:Create(btn, TweenPresets.Fast, {
            BackgroundColor3 = (Config.ClickType == type) and Color3.fromRGB(100, 150, 255) or Color3.fromRGB(45, 45, 52)
        }):Play()
    end
end

local function ToggleFPSUnlock()
    if not SetDebounce("FPS", 0.3) then return end
    if not FPS_SUPPORTED then
        FPSUnlockStatus.Text = "FPS Unlock not supported"
        FPSUnlockStatus.TextColor3 = Color3.fromRGB(220, 50, 50)
        return
    end
    
    Config.FPSUnlockEnabled = not Config.FPSUnlockEnabled
    TweenService:Create(FPSUnlockToggle, TweenPresets.Medium, {
        BackgroundColor3 = Config.FPSUnlockEnabled and Color3.fromRGB(50, 220, 100) or Color3.fromRGB(220, 50, 50)
    }):Play()
    
    FPSUnlockToggle.Text = "FPS Unlock: " .. (Config.FPSUnlockEnabled and "ON" or "OFF")
    if Config.FPSUnlockEnabled then
        setfpscap(Config.TargetFPS)
        FPSUnlockStatus.Text = "Your target: " .. Config.TargetFPS .. " FPS"
        FPSUnlockStatus.TextColor3 = Color3.fromRGB(50, 220, 100)
    else
        setfpscap(60)
        FPSUnlockStatus.Text = "Default FPS"
        FPSUnlockStatus.TextColor3 = Color3.fromRGB(180, 180, 180)
    end
    SaveConfig()
end

local teleporting = false

local function SetupAutoRejoin()
    if Config.AutoRejoinEnabled then
        local PromptGui = CoreGui:WaitForChild("RobloxPromptGui")
        local PromptOverlay = PromptGui:WaitForChild("promptOverlay")
        PromptOverlay.ChildAdded:Connect(function(child)
            if child.Name == "ErrorPrompt" and Config.AutoRejoinEnabled and not teleporting then
                teleporting = true
                task.spawn(function()
                    while Config.AutoRejoinEnabled and teleporting do
                        TeleportService:Teleport(game.PlaceId, LocalPlayer)
                        task.wait(2)
                    end
                end)
            end
        end)
    end
end

local function ToggleAutoRejoin()
    if not SetDebounce("Rejoin", 0.3) then return end
    Config.AutoRejoinEnabled = not Config.AutoRejoinEnabled
    TweenService:Create(AutoRejoinToggle, TweenPresets.Medium, {
        BackgroundColor3 = Config.AutoRejoinEnabled and Color3.fromRGB(50, 220, 100) or Color3.fromRGB(220, 50, 50)
    }):Play()
    
    AutoRejoinToggle.Text = "Auto Rejoin: " .. (Config.AutoRejoinEnabled and "ON" or "OFF")
    AutoRejoinStatus.Text = "Status: " .. (Config.AutoRejoinEnabled and "Enabled" or "Disabled") .. "\n\nAutomatically rejoins the game when you get disconnected.\nUseful for preventing AFK kicks."
    AutoRejoinStatus.TextColor3 = Config.AutoRejoinEnabled and Color3.fromRGB(50, 220, 100) or Color3.fromRGB(180, 180, 180)
    
    if Config.AutoRejoinEnabled then
        SetupAutoRejoin()
    else
        teleporting = false
    end
    SaveConfig()
end

local function ExecuteLoadString()
    if not SetDebounce("Execute", 0.5) then return end
    local loadstringText = LoadStringBox.Text
    if loadstringText == "" or loadstringText == nil then
        LoadStringStatus.Text = "Status: Empty script"
        LoadStringStatus.TextColor3 = Color3.fromRGB(255, 200, 100)
        return
    end
    
    LoadStringStatus.Text = "Status: Executing..."
    LoadStringStatus.TextColor3 = Color3.fromRGB(255, 200, 100)
    TweenService:Create(ExecuteButton, TweenPresets.Medium, {BackgroundColor3 = Color3.fromRGB(255, 200, 100)}):Play()
    
    local success, errorMessage = pcall(function()
        local func, err = loadstring(loadstringText)
        if not func then
            error(err)
        end
        func()
    end)
    
    if success then
        LoadStringStatus.Text = "Status: Executed successfully!"
        LoadStringStatus.TextColor3 = Color3.fromRGB(50, 220, 100)
        TweenService:Create(ExecuteButton, TweenPresets.Medium, {BackgroundColor3 = Color3.fromRGB(50, 220, 100)}):Play()
    else
        LoadStringStatus.Text = "Status: Error - " .. tostring(errorMessage):sub(1, 50) .. "..."
        LoadStringStatus.TextColor3 = Color3.fromRGB(220, 50, 50)
        TweenService:Create(ExecuteButton, TweenPresets.Medium, {BackgroundColor3 = Color3.fromRGB(220, 50, 50)}):Play()
        warn("Loadstring Error: " .. tostring(errorMessage))
    end
    
    task.wait(2)
    if LoadStringStatus.Text:match("Error") or LoadStringStatus.Text:match("successfully") then
        LoadStringStatus.Text = "Status: Ready"
        LoadStringStatus.TextColor3 = Color3.fromRGB(180, 180, 180)
        TweenService:Create(ExecuteButton, TweenPresets.Medium, {BackgroundColor3 = Color3.fromRGB(45, 45, 52)}):Play()
    end
end

local function ChangeKeybind()
    if not SetDebounce("Keybind", 0.5) or Config.IsChangingKeybind then return end
    Config.IsChangingKeybind = true
    KeybindButton.Text = "Press any key..."
    KeybindStatus.Text = "Waiting for input..."
    KeybindStatus.TextColor3 = Color3.fromRGB(255, 200, 100)
    
    local connection
    connection = UserInputService.InputBegan:Connect(function(input, gameProcessed)
        if input.UserInputType == Enum.UserInputType.Keyboard and not gameProcessed then
            Config.Keybind = input.KeyCode
            local keyName = KeyCodeNames[input.KeyCode] or input.KeyCode.Name
            KeybindButton.Text = "Toggle Keybind: " .. keyName
            KeybindStatus.Text = "Keybind changed successfully!\n\nPress the keybind at any time to open/close this menu."
            KeybindStatus.TextColor3 = Color3.fromRGB(50, 220, 100)
            SaveConfig()
            task.wait(1.5)
            if KeybindStatus.Text:match("successfully") then
                KeybindStatus.Text = "Click the button above to change your Toggle Keybind\n\nPress the keybind at any time to open/close this menu."
                KeybindStatus.TextColor3 = Color3.fromRGB(150, 150, 150)
            end
            Config.IsChangingKeybind = false
            connection:Disconnect()
        end
    end)
end

local function SwitchTab(tabName)
    if not SetDebounce("Tab", 0.1) then return end
    Config.CurrentTab = tabName
    SaveConfig()
    
    for name, content in pairs(TabContents) do
        content.Visible = (name == tabName)
    end
    
    for name, tabData in pairs(TabButtons) do
        local isActive = (name == tabName)
        TweenService:Create(tabData.Button, TweenPresets.Fast, {
            BackgroundColor3 = isActive and Color3.fromRGB(100, 150, 255) or Color3.fromRGB(35, 35, 42)
        }):Play()
        TweenService:Create(tabData.Icon, TweenPresets.Fast, {
            TextColor3 = isActive and Color3.fromRGB(255, 255, 255) or Color3.fromRGB(180, 180, 180)
        }):Play()
        TweenService:Create(tabData.Label, TweenPresets.Fast, {
            TextColor3 = isActive and Color3.fromRGB(255, 255, 255) or Color3.fromRGB(180, 180, 180)
        }):Play()
    end
end

local SaveCodeTimer = nil
local SaveCodeDelay = 1.0

local function SaveCodeAutomatically()
    if SaveCodeTimer then
        task.cancel(SaveCodeTimer)
    end
    SaveCodeTimer = task.delay(SaveCodeDelay, function()
        Config.SavedCode = LoadStringBox.Text
        SaveConfig()
        LoadStringStatus.Text = "Status: Code auto-saved"
        LoadStringStatus.TextColor3 = Color3.fromRGB(100, 200, 255)
        task.wait(2)
        if LoadStringStatus.Text == "Status: Code auto-saved" then
            LoadStringStatus.Text = "Status: Ready"
            LoadStringStatus.TextColor3 = Color3.fromRGB(180, 180, 180)
        end
    end)
end

LoadStringBox:GetPropertyChangedSignal("Text"):Connect(SaveCodeAutomatically)

CleanupAllThreads()

KeybindButton.MouseButton1Click:Connect(ChangeKeybind)
AutoRejoinToggle.MouseButton1Click:Connect(ToggleAutoRejoin)
FPSUnlockToggle.MouseButton1Click:Connect(ToggleFPSUnlock)
ExecuteButton.MouseButton1Click:Connect(ExecuteLoadString)

local tabConnections = {}
for _, tab in ipairs(tabList) do
    local name = tab[1]
    tabConnections[name] = TabButtons[name].Button.MouseButton1Click:Connect(function()
        SwitchTab(name)
    end)
end

ClickTypeCurrent.MouseButton1Click:Connect(function()
    if not SetDebounce("ClickType", 0.2) then return end
    Config.ClickType = "Current"
    UpdateClickTypeButtons()
    SaveConfig()
end)

ClickTypeCenter.MouseButton1Click:Connect(function()
    if not SetDebounce("ClickType", 0.2) then return end
    Config.ClickType = "Center"
    UpdateClickTypeButtons()
    SaveConfig()
end)

ClickTypeRandom.MouseButton1Click:Connect(function()
    if not SetDebounce("ClickType", 0.2) then return end
    Config.ClickType = "Random"
    UpdateClickTypeButtons()
    SaveConfig()
end)

JumpToggle.MouseButton1Click:Connect(function()
    if not SetDebounce("Jump", 0.3) then return end
    Config.JumpEnabled = not Config.JumpEnabled
    TweenService:Create(JumpToggle, TweenPresets.Medium, {
        BackgroundColor3 = Config.JumpEnabled and Color3.fromRGB(50, 220, 100) or Color3.fromRGB(220, 50, 50)
    }):Play()
    
    JumpToggle.Text = "Auto Jump: " .. (Config.JumpEnabled and "ON" or "OFF")
    if Config.JumpEnabled then
        task.wait(0.05)
        StartJumpThread()
    else
        StopJumpThread()
    end
    UpdateAntiAFKStatus()
    SaveConfig()
end)

ClickToggle.MouseButton1Click:Connect(function()
    if not SetDebounce("Click", 0.3) then return end
    Config.ClickEnabled = not Config.ClickEnabled
    TweenService:Create(ClickToggle, TweenPresets.Medium, {
        BackgroundColor3 = Config.ClickEnabled and Color3.fromRGB(50, 220, 100) or Color3.fromRGB(220, 50, 50)
    }):Play()
    
    ClickToggle.Text = "Auto Click: " .. (Config.ClickEnabled and "ON" or "OFF")
    if Config.ClickEnabled then
        task.wait(0.05)
        StartClickThread()
    else
        StopClickThread()
    end
    UpdateAntiAFKStatus()
    SaveConfig()
end)

AutoSpamToggle.MouseButton1Click:Connect(function()
    if not SetDebounce("Spam", 0.3) then return end
    Config.AutoSpamEnabled = not Config.AutoSpamEnabled
    if Config.AutoSpamEnabled then
        local keyText = SpamInput.Text:upper()
        local keyCode = KeyCodeMap[keyText]
        if not keyCode then
            Config.AutoSpamEnabled = false
            AutoSpamStatus.Text = "Status: Invalid key"
            AutoSpamStatus.TextColor3 = Color3.fromRGB(220, 50, 50)
            return
        end
        
        if keyCode == Enum.KeyCode.P or keyCode == Enum.KeyCode.G then
            Config.AutoSpamEnabled = false
            AutoSpamStatus.Text = "Status: Key reserved"
            AutoSpamStatus.TextColor3 = Color3.fromRGB(220, 50, 50)
            return
        end
        
        Config.SpamKey = keyText
        TweenService:Create(AutoSpamToggle, TweenPresets.Medium, {BackgroundColor3 = Color3.fromRGB(50, 220, 100)}):Play()
        AutoSpamToggle.Text = "ON"
        AutoSpamStatus.Text = "Status: Spamming " .. keyText
        AutoSpamStatus.TextColor3 = Color3.fromRGB(50, 220, 100)
        task.wait(0.05)
        StartSpamThread()
    else
        TweenService:Create(AutoSpamToggle, TweenPresets.Medium, {BackgroundColor3 = Color3.fromRGB(220, 50, 50)}):Play()
        AutoSpamToggle.Text = "OFF"
        AutoSpamStatus.Text = "Status: Inactive"
        AutoSpamStatus.TextColor3 = Color3.fromRGB(180, 180, 180)
        StopSpamThread()
    end
    SaveConfig()
end)

local function ToggleUI()
    if not SetDebounce("UI", 0.8) then return end
    if MainFrame.Visible then
        TweenService:Create(MainFrame, TweenPresets.BackIn, {
            Size = UDim2.new(0, 0, 0, 0),
            Position = UDim2.new(0.5, 0, 0.5, 0)
        }):Play()
        task.wait(0.45)
        MainFrame.Visible = false
        ReopenButton.Visible = true
        ReopenButton.Size = UDim2.new(0, 0, 0, 0)
        ReopenButton.Position = UDim2.new(0.5, 0, 0, 30)
        TweenService:Create(ReopenButton, TweenPresets.Back, {
            Size = UDim2.new(0, 60, 0, 60),
            Position = UDim2.new(0.5, -30, 0, 30)
        }):Play()
    else
        TweenService:Create(ReopenButton, TweenPresets.BackIn, {
            Size = UDim2.new(0, 0, 0, 0),
            Position = UDim2.new(0.5, 0, 0, 30)
        }):Play()
        task.wait(0.35)
        ReopenButton.Visible = false
        MainFrame.Visible = true
        MainFrame.Size = UDim2.new(0, 0, 0, 0)
        MainFrame.Position = UDim2.new(0.5, 0, 0.5, 0)
        TweenService:Create(MainFrame, TweenPresets.Back, {
            Size = UDim2.new(0, 650, 0, 500),
            Position = UDim2.new(0.5, -325, 0.5, -250)
        }):Play()
    end
end

CloseButton.MouseButton1Click:Connect(ToggleUI)
ReopenButton.MouseButton1Click:Connect(ToggleUI)

ReopenButton.MouseEnter:Connect(function()
    TweenService:Create(ReopenButton, TweenPresets.Medium, {
        Size = UDim2.new(0, 70, 0, 70),
        Position = UDim2.new(0.5, -35, 0, 25)
    }):Play()
end)

ReopenButton.MouseLeave:Connect(function()
    TweenService:Create(ReopenButton, TweenPresets.Medium, {
        Size = UDim2.new(0, 60, 0, 60),
        Position = UDim2.new(0.5, -30, 0, 30)
    }):Play()
end)

UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if not gameProcessed and input.KeyCode == Config.Keybind and not Config.IsChangingKeybind then
        ToggleUI()
    end
end)

local lastTime, frameCount, currentFPS = tick(), 0, 60
local updateInterval = 1

local FPSHistory = {}
local PingHistory = {}
local MAX_POINTS = 60
for i = 1, MAX_POINTS do
    table.insert(FPSHistory, 60)
    table.insert(PingHistory, 0)
end

local function UpdateFPSStats(fps)
    table.remove(FPSHistory, 1)
    table.insert(FPSHistory, fps)
    local minFPS, maxFPS, totalFPS = math.huge, 0, 0
    for _, fpsVal in ipairs(FPSHistory) do
        minFPS = math.min(minFPS, fpsVal)
        maxFPS = math.max(maxFPS, fpsVal)
        totalFPS = totalFPS + fpsVal
    end
    local avgFPS = math.floor(totalFPS / #FPSHistory)
    CurrentFPSLabel.Text = "Current: " .. fps
    AvgFPSLabel.Text = "Average: " .. avgFPS
    MinMaxFPSLabel.Text = string.format("Min: %d | Max: %d", minFPS, maxFPS)
end

local function UpdatePingStats(ping)
    table.remove(PingHistory, 1)
    table.insert(PingHistory, ping)
    local minPing, maxPing, totalPing = math.huge, 0, 0
    for _, pingVal in ipairs(PingHistory) do
        minPing = math.min(minPing, pingVal)
        maxPing = math.max(maxPing, pingVal)
        totalPing = totalPing + pingVal
    end
    local avgPing = math.floor(totalPing / #PingHistory)
    CurrentPingLabel.Text = "Current: " .. ping .. "ms"
    AvgPingLabel.Text = "Average: " .. avgPing .. "ms"
    MinMaxPingLabel.Text = string.format("Min: %dms | Max: %dms", minPing, maxPing)
    
    local qualityText, qualityColor
    if ping < 50 then
        qualityText, qualityColor = "Excellent", Color3.fromRGB(50, 220, 100)
    elseif ping < 100 then
        qualityText, qualityColor = "Good", Color3.fromRGB(100, 200, 255)
    elseif ping < 200 then
        qualityText, qualityColor = "Fair", Color3.fromRGB(255, 200, 100)
    elseif ping < 300 then
        qualityText, qualityColor = "Poor", Color3.fromRGB(255, 150, 50)
    else
        qualityText, qualityColor = "Very Poor", Color3.fromRGB(220, 50, 50)
    end
    NetworkQualityLabel.Text = qualityText
    NetworkQualityLabel.TextColor3 = qualityColor
end

RunService.RenderStepped:Connect(function()
    frameCount = frameCount + 1
    local currentTime = tick()
    if currentTime - lastTime >= updateInterval then
        currentFPS = math.floor(frameCount / (currentTime - lastTime))
        frameCount = 0
        lastTime = currentTime
        FPSLabel.Text = "FPS: " .. currentFPS
        UpdateFPSStats(currentFPS)
    end
    
    if frameCount % 30 == 0 then
        local ping = math.floor(LocalPlayer:GetNetworkPing() * 1000)
        PingLabel.Text = "Ping: " .. ping .. " ms"
        UpdatePingStats(ping)
        if ping < 100 then
            PingLabel.TextColor3 = Color3.fromRGB(0, 255, 0)
        elseif ping < 200 then
            PingLabel.TextColor3 = Color3.fromRGB(255, 255, 0)
        else
            PingLabel.TextColor3 = Color3.fromRGB(255, 0, 0)
        end
    end
end)

task.spawn(function()
    pcall(function()
        PlayerImage.Image = "rbxthumb://type=AvatarHeadShot&id=" .. LocalPlayer.UserId .. "&w=420&h=420"
        local gameInfo = MarketplaceService:GetProductInfo(game.PlaceId)
        GameName.Text = gameInfo.Name
        if gameInfo.IconImageAssetId and gameInfo.IconImageAssetId ~= 0 then
            GameImage.Image = "rbxthumb://type=Asset&id=" .. gameInfo.IconImageAssetId .. "&w=420&h=420"
        end
    end)
end)

ScreenGui.Destroying:Connect(CleanupAllThreads)

local configLoaded = LoadConfig()

if configLoaded then
    local keyName = KeyCodeNames[Config.Keybind] or Config.Keybind.Name
    KeybindButton.Text = "Toggle Keybind: " .. keyName
    SpamInput.Text = Config.SpamKey
    LoadStringBox.Text = Config.SavedCode
    
    UpdateJumpSlider((Config.JumpDelay - 5) / 25)
    UpdateClickSlider((Config.ClickDelay - 1) / 9)
    UpdateSpamSlider((Config.SpamDelay - 0.05) / 4.95)
    UpdateFPSSlider((Config.TargetFPS - 15) / 345)
    UpdateClickTypeButtons()
    
    if Config.AutoRejoinEnabled then
        AutoRejoinToggle.BackgroundColor3 = Color3.fromRGB(50, 220, 100)
        AutoRejoinToggle.Text = "Auto Rejoin: ON"
        AutoRejoinStatus.Text = "Status: Enabled\n\nAutomatically rejoins the game when you get disconnected.\nUseful for preventing AFK kicks."
        AutoRejoinStatus.TextColor3 = Color3.fromRGB(50, 220, 100)
        SetupAutoRejoin()
    else
        AutoRejoinToggle.BackgroundColor3 = Color3.fromRGB(220, 50, 50)
        AutoRejoinToggle.Text = "Auto Rejoin: OFF"
        AutoRejoinStatus.Text = "Status: Disabled\n\nAutomatically rejoins the game when you get disconnected.\nUseful for preventing AFK kicks."
        AutoRejoinStatus.TextColor3 = Color3.fromRGB(180, 180, 180)
    end
    
    if Config.FPSUnlockEnabled and FPS_SUPPORTED then
        FPSUnlockToggle.BackgroundColor3 = Color3.fromRGB(50, 220, 100)
        FPSUnlockToggle.Text = "FPS Unlock: ON"
        FPSUnlockStatus.TextColor3 = Color3.fromRGB(50, 220, 100)
        FPSUnlockStatus.Text = "Your target: " .. Config.TargetFPS .. " FPS"
        setfpscap(Config.TargetFPS)
    else
        FPSUnlockToggle.BackgroundColor3 = Color3.fromRGB(220, 50, 50)
        FPSUnlockToggle.Text = "FPS Unlock: OFF"
        FPSUnlockStatus.TextColor3 = Color3.fromRGB(180, 180, 180)
        FPSUnlockStatus.Text = "Default FPS"
    end
    
    StopJumpThread()
    StopClickThread()
    StopSpamThread()
    
    if Config.JumpEnabled then
        task.wait(0.1)
        JumpToggle.BackgroundColor3 = Color3.fromRGB(50, 220, 100)
        JumpToggle.Text = "Auto Jump: ON"
        StartJumpThread()
    else
        JumpToggle.BackgroundColor3 = Color3.fromRGB(220, 50, 50)
        JumpToggle.Text = "Auto Jump: OFF"
    end
    
    if Config.ClickEnabled then
        task.wait(0.1)
        ClickToggle.BackgroundColor3 = Color3.fromRGB(50, 220, 100)
        ClickToggle.Text = "Auto Click: ON"
        StartClickThread()
    else
        ClickToggle.BackgroundColor3 = Color3.fromRGB(220, 50, 50)
        ClickToggle.Text = "Auto Click: OFF"
    end
    
    if Config.AutoSpamEnabled then
        local keyCode = KeyCodeMap[Config.SpamKey]
        if keyCode then
            task.wait(0.1)
            AutoSpamToggle.BackgroundColor3 = Color3.fromRGB(50, 220, 100)
            AutoSpamToggle.Text = "ON"
            AutoSpamStatus.Text = "Status: Spamming " .. Config.SpamKey
            AutoSpamStatus.TextColor3 = Color3.fromRGB(50, 220, 100)
            StartSpamThread()
        else
            Config.AutoSpamEnabled = false
            AutoSpamToggle.BackgroundColor3 = Color3.fromRGB(220, 50, 50)
            AutoSpamToggle.Text = "OFF"
            AutoSpamStatus.Text = "Status: Inactive"
            AutoSpamStatus.TextColor3 = Color3.fromRGB(180, 180, 180)
        end
    else
        AutoSpamToggle.BackgroundColor3 = Color3.fromRGB(220, 50, 50)
        AutoSpamToggle.Text = "OFF"
        AutoSpamStatus.Text = "Status: Inactive"
        AutoSpamStatus.TextColor3 = Color3.fromRGB(180, 180, 180)
    end
    
    UpdateAntiAFKStatus()
else
    UpdateJumpSlider(0.2)
    UpdateClickSlider(0.22)
    UpdateSpamSlider(0.01)
    UpdateFPSSlider(0.13)
    UpdateClickTypeButtons()
    
    JumpToggle.BackgroundColor3 = Color3.fromRGB(220, 50, 50)
    JumpToggle.Text = "Auto Jump: OFF"
    
    ClickToggle.BackgroundColor3 = Color3.fromRGB(220, 50, 50)
    ClickToggle.Text = "Auto Click: OFF"
    
    AutoSpamToggle.BackgroundColor3 = Color3.fromRGB(220, 50, 50)
    AutoSpamToggle.Text = "OFF"
    AutoSpamStatus.Text = "Status: Inactive"
    AutoSpamStatus.TextColor3 = Color3.fromRGB(180, 180, 180)
    
    FPSUnlockToggle.BackgroundColor3 = Color3.fromRGB(220, 50, 50)
    FPSUnlockToggle.Text = "FPS Unlock: OFF"
    FPSUnlockStatus.TextColor3 = Color3.fromRGB(180, 180, 180)
    FPSUnlockStatus.Text = "Default FPS"
    
    AutoRejoinToggle.BackgroundColor3 = Color3.fromRGB(220, 50, 50)
    AutoRejoinToggle.Text = "Auto Rejoin: OFF"
    AutoRejoinStatus.TextColor3 = Color3.fromRGB(180, 180, 180)
end

SwitchTab(Config.CurrentTab)

MainFrame.Visible = true
MainFrame.Size = UDim2.new(0, 0, 0, 0)
MainFrame.Position = UDim2.new(0.5, 0, 0.5, 0)
ReopenButton.Visible = false

TweenService:Create(MainFrame, TweenInfo.new(0.8, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
    Size = UDim2.new(0, 650, 0, 500),
    Position = UDim2.new(0.5, -325, 0.5, -250)
}):Play()
